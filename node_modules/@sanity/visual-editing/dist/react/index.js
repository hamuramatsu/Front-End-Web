import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{c as r}from"react-compiler-runtime";import{i as o,a as i,b as a}from"../_chunks-es/create-data-attribute.js";import{c as s}from"../_chunks-es/create-data-attribute.js";import{createNode as c,createNodeMachine as l}from"@sanity/comlink";import{useEffect as d,createContext as u,useContext as p,useState as m,memo as h,useRef as f,isValidElement as v,useSyncExternalStore as y,useMemo as g,useReducer as b}from"react";import{setup as w,emit as x,assertEvent as k,assign as S,stopChild as _,fromPromise as E,enqueueActions as M,createActor as I}from"xstate";import{SanityEncoder as P,at as $,remove as D,insert as T}from"@sanity/mutate";import{createSharedListener as z,documentMutatorMachine as R}from"@sanity/mutate/_unstable_machine";import{a as L,b as A,d as j,c as C,e as F,f as N,h as W,j as G,u as O,k as U,g as B,s as q}from"../_chunks-es/mutations.js";import{ReplaySubject as V,Subject as K,merge as Y}from"rxjs";import{a as H,b as X,g as Z,C as J,R as Q,S as ee,c as te,e as ne,f as re,U as oe,h as ie,M as ae,i as se,j as ce,T as le,k as de,l as ue,F as pe,m as me,n as he,o as fe,p as ve,d as ye,q as ge,P as be,D as we,r as xe,u as ke,s as Se,H as _e,E as Ee,L as Me,t as Ie,v as Pe,w as $e,x as De,y as Te}from"../_chunks-es/PointerEvents.js";import{S as ze,c as Re,s as Le}from"../_chunks-es/SharedStateContext.js";import{createEditUrl as Ae,studioPath as je}from"@sanity/client/csm";import{p as Ce,D as Fe}from"../_chunks-es/transformSanityNodeData.js";import Ne from"scroll-into-view-if-needed";const We=w({types:{},actions:{"emit sync event":x((({event:e})=>(k(e,"sync"),e))),"emit mutation event":x((({event:e})=>(k(e,"mutation"),e))),"emit rebased event":x((({event:e})=>(k(e,["rebased.local","rebased.remote"]),e))),"emit pristine event":x((({event:e})=>(k(e,["pristine"]),e))),"add document actor":S({documents:({context:e,event:t,spawn:n})=>{k(t,"observe");const r=t.documentId;return e.documents[r]?e.documents:{...e.documents,[r]:n("documentMutatorMachine",{input:{id:r,client:e.client,sharedListener:e.sharedListener||z(e.client)},id:r})}}}),"stop remote snapshot":_((({context:e,event:t})=>(k(t,"unobserve"),e.documents[t.documentId]))),"remove remote snapshot from context":S({documents:({context:e,event:t})=>{if(k(t,"unobserve"),!e.documents[t.documentId])return e.documents;const{[t.documentId]:n,...r}=e.documents;return r}})},actors:{documentMutatorMachine:R}}).createMachine({id:"dataset-mutator",context:({input:e})=>({documents:{},client:e.client,sharedListener:e.sharedListener}),on:{sync:{actions:["emit sync event"]},mutation:{actions:["emit mutation event"]},"rebased.*":{actions:["emit rebased event"]},pristine:{actions:["emit pristine event"]},observe:{actions:["add document actor"]},unobserve:{actions:["stop remote snapshot","remove remote snapshot from context"]}},initial:"pristine",states:{pristine:{}}}),Ge=e=>{const t=E((async({input:t,signal:n})=>{const{id:r}=t,{snapshot:o}=await e.fetch("visual-editing/fetch-snapshot",{documentId:r},{signal:n});return o})),n=E((async({input:t})=>{const{transactions:n}=t;for(const t of n){const n=P.encodeTransaction(t);return e.post("visual-editing/mutate",n)}}));return R.provide({actions:{"send sync event to parent":M((({enqueue:e})=>{e.sendParent((({context:e})=>({type:"sync",id:e.id,document:e.remote}))),e.emit((({context:e})=>({type:"ready",snapshot:e.local})))}))},actors:{"fetch remote snapshot":t,"submit mutations as transactions":n}})},Oe=e=>{const t=r(8),{comlink:n,history:o}=e;let i,a,s,c;return t[0]!==n||t[1]!==o?(i=()=>n?.on("presentation/navigate",(e=>{o?.update(e)})),a=[n,o],t[0]=n,t[1]=o,t[2]=i,t[3]=a):(i=t[2],a=t[3]),d(i,a),t[4]!==n||t[5]!==o?(s=()=>{if(o)return o.subscribe((e=>{e.title=e.title||document.title,n?.post("visual-editing/navigate",e)}))},c=[n,o],t[4]=n,t[5]=o,t[6]=s,t[7]=c):(s=t[6],c=t[7]),d(s,c),null},Ue=e=>{const t=r(3),{comlink:n}=e;let o,i;return t[0]!==n?(o=()=>{const e=()=>{n.post("visual-editing/meta",{title:document.title})},t=new MutationObserver((t=>{const[n]=t;"TITLE"===n.target.nodeName&&e()}));return t.observe(document.head,{subtree:!0,characterData:!0,childList:!0}),e(),()=>t.disconnect()},i=[n],t[0]=n,t[1]=o,t[2]=i):(o=t[1],i=t[2]),d(o,i),null};function Be(e){const t=new CustomEvent("sanity/dragEnd",{detail:e,cancelable:!0});window.dispatchEvent(t)}const qe=u(null);function Ve(){const e=p(qe);if(!e)throw new Error("Schema context is missing");return e}function Ke(e,t){if(!e.type)throw new Error("Node type is missing");return()=>t.patch((async({getSnapshot:t})=>N(e,await t())))}function Ye(e,t,n,r){if(!e.type)throw new Error("Node type is missing");return()=>t.patch((()=>C(e,n,r)))}function He(e,t){if(!e.type)throw new Error("Node type is missing");return()=>t.patch((async({getSnapshot:t})=>W(e,await t())))}function Xe(t){const{node:n,field:r,parent:o,doc:i}=t;return"arrayItem"===r?.type?async function(e){const{node:t,field:n,doc:r}=e,o=[];return o.push(...Ze(e)),o.push(...Je(e)),o.push(...await Qe(e)),o.push({type:"action",label:"Insert before",icon:H,action:Ye(t,r,n.name,"before")}),o.push({type:"action",label:"Insert after",icon:X,action:Ye(t,r,n.name,"after")}),o}({node:n,field:r,doc:i}):"union"===o?.type?async function(t){const{doc:n,node:r,parent:o}=t,i=[];if(i.push(...Ze(t)),i.push(...Je(t)),i.push(...await Qe(t)),o.options?.insertMenu){const t=(o.options.insertMenu||{}).views?.some((e=>"grid"===e.name))?0:void 0;i.push({type:"custom",component:({boundaryElement:i})=>e(et,{label:"Insert before",onSelect:e=>{Ye(r,n,e.name,"before")()},parent:o,width:t,boundaryElement:i})}),i.push({type:"custom",component:({boundaryElement:i})=>e(et,{label:"Insert after",onSelect:e=>{Ye(r,n,e.name,"after")()},parent:o,width:t,boundaryElement:i})})}else i.push({type:"group",label:"Insert before",icon:H,items:o.of.filter((e=>"unionOption"===e.type)).map((e=>({type:"action",icon:Z(e),label:"block"===e.name?"Paragraph":e.title||e.name,action:Ye(r,n,e.name,"before")})))}),i.push({type:"group",label:"Insert after",icon:X,items:o.of.filter((e=>"unionOption"===e.type)).map((e=>({type:"action",label:"block"===e.name?"Paragraph":e.title||e.name,icon:Z(e),action:Ye(r,n,e.name,"after")})))});return i}({node:n,parent:o,doc:i}):Promise.resolve([])}function Ze(e){const{node:t,doc:n}=e;return n?[{type:"action",label:"Duplicate",icon:J,action:He(t,n)}]:[]}function Je(e){const{node:t,doc:n}=e;return n?[{type:"action",label:"Remove",icon:Q,action:Ke(t,n)}]:[]}async function Qe(e,t=!0){const{node:n,doc:r}=e;if(!r)return[];const o=[],i=[],[a,s,c,l]=await Promise.all([F(n,r,"previous"),F(n,r,"next"),F(n,r,"first"),F(n,r,"last")]);return c.length&&i.push({type:"action",label:"To top",icon:te,action:()=>r.patch(c)}),a.length&&i.push({type:"action",label:"Up",icon:ne,action:()=>r.patch(a)}),s.length&&i.push({type:"action",label:"Down",icon:re,action:()=>r.patch(s)}),l.length&&i.push({type:"action",label:"To bottom",icon:oe,action:()=>r.patch(l)}),i.length&&(o.push({type:"group",label:"Move",icon:ee,items:i}),t&&o.push({type:"divider"})),o}const et=t=>{const n=r(12),{label:o,parent:i,width:a,onSelect:s,boundaryElement:c}=t;let l,d,u,p,m;return n[0]===Symbol.for("react.memo_cache_sentinel")?(l=["left-start","right","left","right-end","left-end","bottom","top"],n[0]=l):l=n[0],n[1]===Symbol.for("react.memo_cache_sentinel")?(d=[4,4,4,4],n[1]=d):d=n[1],n[2]!==c||n[3]!==a?(u={arrow:!1,constrainSize:!0,floatingBoundary:c,padding:0,placement:"right-start",fallbackPlacements:l,preventOverflow:!0,width:a,__unstable_margins:d},n[2]=c,n[3]=a,n[4]=u):u=n[4],n[5]!==s||n[6]!==i?(p=e(ie,{node:i,onSelect:s}),n[5]=s,n[6]=i,n[7]=p):p=n[7],n[8]!==o||n[9]!==u||n[10]!==p?(m=e(ae,{fontSize:1,icon:X,padding:2,popover:u,space:2,text:o,children:p}),n[8]=o,n[9]=u,n[10]=p,n[11]=m):m=n[11],m};const tt=[-4,4,-4,4];function nt(t){const n=r(25),{node:o,onDismiss:i,boundaryElement:a}=t;let s;n[0]!==o||n[1]!==i?(s=()=>{"action"===o.type&&(o.action?.(),i?.())},n[0]=o,n[1]=i,n[2]=s):s=n[2];const c=s;if("divider"===o.type){let t;return n[3]===Symbol.for("react.memo_cache_sentinel")?(t=e(se,{}),n[3]=t):t=n[3],t}if("action"===o.type){const t=!o.action;let r;return n[4]!==o.hotkeys||n[5]!==o.icon||n[6]!==o.label||n[7]!==c||n[8]!==t?(r=e(ve,{fontSize:1,hotkeys:o.hotkeys,icon:o.icon,padding:2,space:2,text:o.label,disabled:t,onClick:c}),n[4]=o.hotkeys,n[5]=o.icon,n[6]=o.label,n[7]=c,n[8]=t,n[9]=r):r=n[9],r}if("group"===o.type){const t=o.icon;let r;n[10]===Symbol.for("react.memo_cache_sentinel")?(r={arrow:!1,constrainSize:!0,placement:"right-start",fallbackPlacements:["left-start","right","left","right-end","left-end","bottom","top"],preventOverflow:!0,__unstable_margins:tt},n[10]=r):r=n[10];const s=o.label;let c,l;if(n[11]!==a||n[12]!==o.items||n[13]!==i){let t;n[15]!==a||n[16]!==i?(t=(t,n)=>e(nt,{node:t,onDismiss:i,boundaryElement:a},n),n[15]=a,n[16]=i,n[17]=t):t=n[17],c=o.items.map(t),n[11]=a,n[12]=o.items,n[13]=i,n[14]=c}else c=n[14];return n[18]!==o.icon||n[19]!==o.label||n[20]!==c?(l=e(ae,{fontSize:1,icon:t,padding:2,popover:r,space:2,text:s,children:c}),n[18]=o.icon,n[19]=o.label,n[20]=c,n[21]=l):l=n[21],l}if("custom"===o.type){const{component:t}=o;let r;return n[22]!==t||n[23]!==a?(r=e(t,{boundaryElement:a}),n[22]=t,n[23]=a,n[24]=r):r=n[24],r}return null}const rt=o=>{const i=r(43),{node:a,onDismiss:s,position:c}=o,{x:l,y:u}=c,[p,h]=m(null),{getField:f}=Ve(),{getDocument:v}=L();let y;i[0]!==f||i[1]!==a?(y=f(a),i[0]=f,i[1]=a,i[2]=y):y=i[2];const{field:g,parent:b}=y;let w;w=g?.title||g?.name||"Unknown type";const x=w,[k,S]=m(void 0);let _,E,M,I;i[3]!==g||i[4]!==v||i[5]!==a||i[6]!==b?(_=()=>{(async()=>{const e=v(a.id);if(!e)return;const t=await Xe({node:a,field:g,parent:b,doc:e});S(t)})()},E=[g,a,b,v],i[3]=g,i[4]=v,i[5]=a,i[6]=b,i[7]=_,i[8]=E):(_=i[7],E=i[8]),d(_,E),i[9]!==l||i[10]!==u?(I={getBoundingClientRect:()=>({bottom:u,left:l,right:l,top:u,width:0,height:0})},i[9]=l,i[10]=u,i[11]=I):I=i[11],M=I;const P=M;let $,D;i[12]!==g?(D=Z(g),i[12]=g,i[13]=D):D=i[13],$=D;const T=$;let z,R;i[14]===Symbol.for("react.memo_cache_sentinel")?(z={minWidth:120,maxWidth:160},i[14]=z):z=i[14],i[15]!==T||i[16]!==k?(R=e(ce,{flex:"none",children:k?e(le,{size:1,children:T}):e(de,{size:1})}),i[15]=T,i[16]=k,i[17]=R):R=i[17];const A=k?x:"Loading...";let j,C,F,N;i[18]!==A?(j=e(ue,{flex:1,space:2,children:e(le,{size:1,weight:"semibold",children:A})}),i[18]=A,i[19]=j):j=i[19],i[20]!==R||i[21]!==j?(C=t(pe,{gap:2,padding:2,children:[R,j]}),i[20]=R,i[21]=j,i[22]=C):C=i[22],i[23]!==p||i[24]!==k||i[25]!==s?(F=k&&t(n,{children:[e(se,{}),k.map(((t,n)=>e(nt,{node:t,onDismiss:s,boundaryElement:p},n)))]}),i[23]=p,i[24]=k,i[25]=s,i[26]=F):F=i[26],i[27]!==C||i[28]!==F?(N=t(me,{style:z,children:[C,F]}),i[27]=C,i[28]=F,i[29]=N):N=i[29];const W=`${l}-${u}`;let G,O,U,B;return i[30]!==l||i[31]!==u?(G={position:"absolute",left:l,top:u},i[30]=l,i[31]=u,i[32]=G):G=i[32],i[33]!==W||i[34]!==G?(O=e("div",{style:G},W),i[33]=W,i[34]=G,i[35]=O):O=i[35],i[36]!==P||i[37]!==N||i[38]!==O?(U=e(he,{__unstable_margins:tt,arrow:!1,open:!0,placement:"right-start",referenceElement:P,content:N,children:O}),i[36]=P,i[37]=N,i[38]=O,i[39]=U):U=i[39],i[40]!==s||i[41]!==U?(B=e(fe,{setBoundaryElement:h,onDismiss:s,children:U}),i[40]=s,i[41]=U,i[42]=B):B=i[42],B},ot=u(null);const it=ye(ge)`
  background-color: var(--overlay-bg);
  border-radius: 3px;
  pointer-events: none;
  position: absolute;
  will-change: transform;
  box-shadow: var(--overlay-box-shadow);
  transition: none;

  --overlay-bg: transparent;
  --overlay-box-shadow: inset 0 0 0 1px transparent;

  [data-overlays] & {
    --overlay-bg: color-mix(in srgb, transparent 95%, var(--card-focus-ring-color));
    --overlay-box-shadow: inset 0 0 0 2px
      color-mix(in srgb, transparent 50%, var(--card-focus-ring-color));
  }

  [data-fading-out] & {
    transition:
      box-shadow 1550ms,
      background-color 1550ms;

    --overlay-bg: rgba(0, 0, 255, 0);
    --overlay-box-shadow: inset 0 0 0 1px transparent;
  }

  &[data-focused] {
    --overlay-box-shadow: inset 0 0 0 1px var(--card-focus-ring-color);
  }

  &[data-hovered]:not([data-focused]) {
    transition: none;
    --overlay-box-shadow: inset 0 0 0 2px var(--card-focus-ring-color);
  }

  /* [data-unmounted] & {
    --overlay-box-shadow: inset 0 0 0 1px var(--card-focus-ring-color);
  } */

  :link {
    text-decoration: none;
  }
`,at=ye(pe)`
  bottom: 100%;
  cursor: pointer;
  pointer-events: none;
  position: absolute;
  right: 0;

  [data-hovered] & {
    pointer-events: all;
  }
`,st=ye(ge)`
  background-color: var(--card-focus-ring-color);
  right: 0;
  border-radius: 3px;

  & [data-ui='Text'] {
    color: #fff;
    white-space: nowrap;
  }
`,ct=ye(pe)`
  bottom: 100%;
  cursor: pointer;
  pointer-events: none;
  position: absolute;
  left: 0;
`,lt=ye(pe)`
  display: flex;
  align-items: center;
  background-color: var(--card-focus-ring-color);
  right: 0;
  border-radius: 3px;
  & [data-ui='Text'],
  & [data-sanity-icon] {
    color: #fff;
    white-space: nowrap;
  }
`;const dt=o=>{const i=r(35),{element:a,focused:s,componentResolver:c,node:l,showActions:d,draggable:u}=o,{getField:m,getType:h}=Ve();let f;i[0]!==h||i[1]!==l?(f=h(l),i[0]=h,i[1]=l,i[2]=f):f=i[2];const y=f;let g;i[3]!==m||i[4]!==l?(g=m(l),i[3]=m,i[4]=l,i[5]=g):g=i[5];const{field:b,parent:w}=g;let x;i[6]!==l?(x="path"in l?function(e){const{id:t,type:n,path:r,baseUrl:o,tool:i,workspace:a}=e;return Ae({baseUrl:o,workspace:a,tool:i,type:n,id:t,path:Ce(je.fromString(r))})}(l):l.href,i[6]=l,i[7]=x):x=i[7];const k=x,S=function(){const e=p(ot);if(!e)throw new Error("Preview Snapshots context is missing");return e}();let _;e:{if(!("path"in l)){_=void 0;break e}let e;i[8]!==l.id||i[9]!==S?(e=S.find((e=>e._id===l.id))?.title,i[8]=l.id,i[9]=S,i[10]=e):e=i[10],_=e}const E=_;let M;e:{if(!("path"in l)){M=void 0;break e}if(!b||!y){M=void 0;break e}const e=b.value.type,t=!!s;let n;i[11]!==a||i[12]!==b||i[13]!==l||i[14]!==w||i[15]!==y||i[16]!==t||i[17]!==e?(n={document:y,element:a,field:b,focused:t,node:l,parent:w,type:e},i[11]=a,i[12]=b,i[13]=l,i[14]=w,i[15]=y,i[16]=t,i[17]=e,i[18]=n):n=i[18],M=n}const I=M,P=function(e,t){const n=r(4);let o;e:{if(!e){o=void 0;break e}let r;if(n[0]!==e||n[1]!==t){const i=t?.(e);if(!i){o=void 0;break e}if(v(i)){o=i;break e}r=(Array.isArray(i)?i:[i]).map(pt),n[0]=e,n[1]=t,n[2]=r,n[3]=o}else r=n[2],o=n[3];o=r}return o}(I,c);let $;i[19]!==y?($=y?.icon?e("div",{dangerouslySetInnerHTML:{__html:y.icon}}):e(we,{}),i[19]=y,i[20]=$):$=i[20];const D=$;let T,z,R,L;return i[21]!==k||i[22]!==d?(T=d?e(at,{gap:1,paddingBottom:1,"data-sanity-overlay-element":!0,children:e(mt,{href:k})}):null,i[21]=k,i[22]=d,i[23]=T):T=i[23],i[24]!==u||i[25]!==D||i[26]!==E?(z=E&&e(ct,{gap:1,paddingBottom:1,children:t(lt,{gap:2,padding:2,children:[u&&e(ce,{marginRight:1,children:e(le,{className:"drag-handle",size:0,children:e(xe,{})})}),e(le,{size:0,children:D}),e(le,{size:1,weight:"medium",children:E})]})}),i[24]=u,i[25]=D,i[26]=E,i[27]=z):z=i[27],i[28]!==I||i[29]!==P?(R=Array.isArray(P)?P.map(((t,n)=>{const{component:r,props:o}=t;return e(r,{PointerEvents:be,...I,...o},n)})):P,i[28]=I,i[29]=P,i[30]=R):R=i[30],i[31]!==T||i[32]!==z||i[33]!==R?(L=t(n,{children:[T,z,R]}),i[31]=T,i[32]=z,i[33]=R,i[34]=L):L=i[34],L},ut=h((function(t){const n=r(17),{focused:o,hovered:i,rect:a,wasMaybeCollapsed:s,enableScrollIntoView:c}=t,l=f(null),u=f(!1);let p;const m=`${a.w}px`,h=`${a.h}px`,v=`translate(${a.x}px, ${a.y}px)`;let y;n[0]!==m||n[1]!==h||n[2]!==v?(y={width:m,height:h,transform:v},n[0]=m,n[1]=h,n[2]=v,n[3]=y):y=n[3],p=y;const g=p;let b,w;n[4]!==c||n[5]!==o||n[6]!==s?(b=()=>{if(!u.current&&!s&&!0===o&&l.current&&c){const e=l.current;Ne(l.current,{behavior:t=>{0!==t.length&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},scrollMode:"if-needed",block:"center",inline:"nearest"})}u.current=!0===o},w=[o,s,c],n[4]=c,n[5]=o,n[6]=s,n[7]=b,n[8]=w):(b=n[7],w=n[8]),d(b,w);const x=o?"":void 0,k=i?"":void 0;let S,_;return n[9]!==i||n[10]!==t?(S=i&&e(dt,{...t}),n[9]=i,n[10]=t,n[11]=S):S=n[11],n[12]!==g||n[13]!==x||n[14]!==k||n[15]!==S?(_=e(it,{"data-focused":x,"data-hovered":k,ref:l,style:g,children:S}),n[12]=g,n[13]=x,n[14]=k,n[15]=S,n[16]=_):_=n[16],_}));function pt(e){return"object"==typeof e&&"component"in e?e:{component:e,props:{}}}const mt=h((function(t){const n=r(3),o=y(ht,ft),i=function(e,t){return g((()=>{try{const n=new URL(e,typeof location>"u"?void 0:location.origin);return n.searchParams.set("preview",t),n.toString()}catch{return e}}),[e,t])}(t.href,o);let a,s;return n[0]===Symbol.for("react.memo_cache_sentinel")?(a=e(st,{padding:2,children:e(le,{size:1,weight:"medium",children:"Open in Studio"})}),n[0]=a):a=n[0],n[1]!==i?(s=e(ce,{as:"a",href:i,target:"_blank",rel:"noopener noreferrer",children:a}),n[1]=i,n[2]=s):s=n[2],s}));function ht(e){const t=()=>e();return window.addEventListener("popstate",t),()=>window.removeEventListener("popstate",t)}function ft(){return window.location.href}const vt=t=>{const n=r(5),{dragGroupRect:o}=t,i=`${o.y}px`,a=`${o.x}px`,s=o.w-1+"px",c=o.h-1+"px";let l;return n[0]!==i||n[1]!==a||n[2]!==s||n[3]!==c?(l=e("div",{style:{position:"absolute",top:i,left:a,width:s,height:c,border:"1px dashed #f0709b",pointerEvents:"none"}}),n[0]=i,n[1]=a,n[2]=s,n[3]=c,n[4]=l):l=n[4],l};function yt(e,t,n){return e*(1-n)+t*n}const gt=({dragInsertPosition:t})=>{if(null===t)return;let n=0,r=0,o=0,i=0;const a=.0125;if("horizontal"===(t?.left||t?.right?"horizontal":"vertical")){const{left:e,right:s}=t;if(o=6,s&&e){const t=e.rect.x+e.rect.w,o=s.rect.x,c=Math.min(s.rect.h,e.rect.h)*a;n=yt(t,o,.5)-3,r=e.rect.y+c,i=Math.min(s.rect.h,e.rect.h)-2*c}else if(s&&!e){const e=s.rect.h*a;n=s.rect.x-3,r=s.rect.y+e,i=s.rect.h-2*e}else if(e&&!s){const t=e.rect.h*a;n=e.rect.x+e.rect.w-3,r=e.rect.y+t,i=e.rect.h-2*t}}else{const{bottom:e,top:s}=t;if(e&&s){const t=Math.min(s.rect.x,e.rect.x),c=s.rect.y+s.rect.h,l=e.rect.y,d=Math.min(e.rect.w,s.rect.w)*a;i=6,n=t+d,r=yt(c,l,.5)-3,o=Math.max(e.rect.w,s.rect.w)-2*d}else if(e&&!s){const t=e.rect.w*a;n=e.rect.x+t,r=e.rect.y-3,o=e.rect.w-2*t,i=6}else if(s&&!e){const e=s.rect.w*a;n=s.rect.x+e,r=s.rect.y+s.rect.h-3,o=s.rect.w-2*e,i=6}}return e("div",{style:{position:"absolute",width:`${o}px`,height:`${i}px`,transform:`translate(${n}px, ${r}px)`,background:"#556bfc",border:"2px solid white",borderRadius:"999px",zIndex:"999999"}})},bt=ye.div`
  --drag-preview-opacity: 0.98;
  --drag-preview-skeleton-stroke: #ffffff;

  @media (prefers-color-scheme: dark) {
    --drag-preview-skeleton-stroke: #383d51;
  }

  position: fixed;
  display: grid;
  transform: ${({$scaleFactor:e,$width:t,$height:n})=>`translate(calc(var(--drag-preview-x) - ${t/2}px), calc(var(--drag-preview-y) - ${n/2}px)) scale(${e})`};
  width: ${({$width:e})=>`${e}px`};
  height: ${({$height:e})=>`${e}px`};
  z-index: 9999999;
  opacity: var(--drag-preview-opacity);
  cursor: move;

  .drag-preview-content-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    container-type: inline-size;
  }

  [data-ui='card'] {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .drag-preview-skeleton {
    position: absolute;
    inset: 0;

    rect {
      stroke: var(--drag-preview-skeleton-stroke);
    }
  }

  .drag-preview-handle {
    position: absolute;
    top: 4cqmin;
    left: 4cqmin;
    width: 6cqmin;
    fill: var(--drag-preview-handle-fill);
  }
`;const wt=t=>{const n=r(24),{skeleton:o}=t,i=Math.min(o.maxWidth,window.innerWidth/2),a=o.w>i?i/o.w:1,s=o.offsetX*a,c=o.offsetY*a,l=ke(),d=Se(),u=d.radius[(p=o.w,m=0,h=1920,f=1,v=d.radius.length-2,~~function(e,t,n){return e<t?t:e>n?n:e}((p-m)*(v-f)/(h-m)+f,f,v))];var p,m,h,f,v;let y;n[0]!==o.childRects?(y=o.childRects.filter(xt),n[0]=o.childRects,n[1]=y):y=n[1];const g=y;let b;n[2]!==o.childRects?(b=o.childRects.filter(kt),n[2]=o.childRects,n[3]=b):b=n[3];const w=b,x=o.w,k=o.h,S=l?"dark":"light",_=`0 0 ${o.w} ${o.h}`;let E,M,I,P,$;return n[4]!==g||n[5]!==w?(E=[...g,...w],n[4]=g,n[5]=w,n[6]=E):E=n[6],n[7]!==E||n[8]!==d.color.skeleton.from?(M=E.map(((t,n)=>e("rect",{x:t.x,y:t.y,width:t.w,height:t.h,fill:d.color.skeleton.from},n))),n[7]=E,n[8]=d.color.skeleton.from,n[9]=M):M=n[9],n[10]!==_||n[11]!==M?(I=e("div",{className:"drag-preview-content-wrapper",children:e("svg",{className:"drag-preview-skeleton",viewBox:_,children:M})}),n[10]=_,n[11]=M,n[12]=I):I=n[12],n[13]!==u||n[14]!==S||n[15]!==I?(P=e(ge,{radius:u,shadow:4,overflow:"hidden",tone:"transparent",scheme:S,children:I}),n[13]=u,n[14]=S,n[15]=I,n[16]=P):P=n[16],n[17]!==s||n[18]!==c||n[19]!==a||n[20]!==o.h||n[21]!==o.w||n[22]!==P?($=e(bt,{$width:x,$height:k,$offsetX:s,$offsetY:c,$scaleFactor:a,children:P}),n[17]=s,n[18]=c,n[19]=a,n[20]=o.h,n[21]=o.w,n[22]=P,n[23]=$):$=n[23],$};function xt(e){return"IMG"===e.tagName}function kt(e){return"IMG"!==e.tagName}const St=ye(ge)`
  position: fixed;
  bottom: 2rem;
  left: 2rem;
`,_t=()=>{const n=r(2);let o,i;return n[0]===Symbol.for("react.memo_cache_sentinel")?(o={zIndex:"999999"},n[0]=o):o=n[0],n[1]===Symbol.for("react.memo_cache_sentinel")?(i=e(St,{padding:2,shadow:2,radius:2,style:o,children:t(pe,{align:"center",gap:2,children:[e(_e,{keys:["Shift"]}),e(le,{size:1,children:"Zoom Out"}),e(Ee,{})]})}),n[1]=i):i=n[1],i},Et=(e,t)=>{const{type:n}=t;switch(n){case"element/register":return e.find((e=>e.id===t.id))?e:[...e,{id:t.id,activated:!1,element:t.element,focused:!1,hovered:!1,rect:t.rect,sanity:t.sanity,dragDisabled:t.dragDisabled}];case"element/activate":return e.map((e=>e.id===t.id?{...e,activated:!0}:e));case"element/update":return e.map((e=>e.id===t.id?{...e,sanity:t.sanity,rect:t.rect}:e));case"element/unregister":return e.filter((e=>e.id!==t.id));case"element/deactivate":return e.map((e=>e.id===t.id?{...e,activated:!1,hovered:!1}:e));case"element/mouseenter":return e.map((e=>e.id===t.id?{...e,rect:t.rect,hovered:!0}:{...e,hovered:!1}));case"element/mouseleave":return e.map((e=>e.id===t.id?{...e,hovered:!1}:e));case"element/updateRect":return e.map((e=>e.id===t.id?{...e,rect:t.rect}:e));case"element/click":return e.map((e=>({...e,focused:e.id===t.id&&"clicked"})));case"overlay/blur":case"presentation/blur":return e.map((e=>({...e,focused:!1})));case"presentation/focus":{const n=e.find((e=>"clicked"===e.focused));return e.map((e=>{const r="path"in e.sanity&&e.sanity.id===t.data.id&&e.sanity.path===t.data.path;return n&&e===n&&r?e:{...e,focused:r&&n?"duplicate":r}}))}default:return e}};function Mt(e,t){const{type:n}=t;let{contextMenu:r,focusPath:o,perspective:i,isDragging:a,dragInsertPosition:s,dragShowMinimap:c,dragShowMinimapPrompt:l,dragSkeleton:d,dragMinimapTransition:u,dragGroupRect:p}=e,m=!1;if("presentation/focus"===n){const n=e.focusPath;o=t.data.path,n!==o&&(m=n.slice(o.length).startsWith("["))}return"presentation/perspective"===n&&(i=t.data.perspective),"element/contextmenu"===n&&(r="sanity"in t?{node:t.sanity,position:t.position}:null),("element/click"===n||"element/mouseleave"===n||"overlay/blur"===n||"presentation/blur"===n||"presentation/focus"===n)&&(r=null),"overlay/dragUpdateInsertPosition"===n&&(s=t.insertPosition),"overlay/dragStart"===n&&(a=!0),"overlay/dragUpdateSkeleton"===t.type&&(d=t.skeleton),"overlay/dragEnd"===n&&(a=!1),"overlay/dragToggleMinimapPrompt"===t.type&&(l=t.display),"overlay/dragStartMinimapTransition"===n&&(u=!0),"overlay/dragEndMinimapTransition"===n&&(u=!1),"overlay/dragUpdateGroupRect"===n&&(p=t.groupRect),"overlay/dragToggleMinimap"===n&&(c=t.display),{...e,contextMenu:r,elements:Et(e.elements,t),dragInsertPosition:s,dragSkeleton:d,dragGroupRect:p,isDragging:a,focusPath:o,perspective:i,wasMaybeCollapsed:m,dragShowMinimap:c,dragShowMinimapPrompt:l,dragMinimapTransition:u}}const It=function(t){const n=r(7),{comlink:o,children:i}=t;let a;n[0]===Symbol.for("react.memo_cache_sentinel")?(a=[],n[0]=a):a=n[0];const[s,c]=m(a);let l,u,p;n[1]!==o?(l=()=>o?.on("presentation/preview-snapshots",(e=>{c(e.snapshots)})),u=[o],n[1]=o,n[2]=l,n[3]=u):(l=n[2],u=n[3]),d(l,u),p=s;const h=p;let f;return n[4]!==i||n[5]!==h?(f=e(ot.Provider,{value:h,children:i}),n[4]=i,n[5]=h,n[6]=f):f=n[6],f};function Pt(e){return"path"in e}function $t(e){return"document"===e.type}function Dt(e){return"type"===e.type}const Tt=function(t){const n=r(26),{comlink:o,children:i,elements:a}=t;let s;n[0]===Symbol.for("react.memo_cache_sentinel")?(s=new Map,n[0]=s):s=n[0];const[c,l]=m(s),[u,p]=m(null);let h;n[1]!==o?(h=async e=>{if(o)try{const t=await o.fetch("visual-editing/schema",void 0,{signal:e,suppressWarnings:!0});p(t.schema)}catch{}},n[1]=o,n[2]=h):h=n[2];const v=h;let y,g,b;n[3]!==v?(y=()=>{const e=new AbortController;return v(e.signal),()=>e.abort()},g=[v],n[3]=v,n[4]=y,n[5]=g):(y=n[4],g=n[5]),d(y,g),n[6]===Symbol.for("react.memo_cache_sentinel")?(b=[],n[6]=b):b=n[6];const w=f(b);let x,k,S;n[7]!==o||n[8]!==a?(x=()=>{const e=new AbortController,t=function(e){return e.reduce(((e,t)=>{const{sanity:n}=t;if(!("id"in n)||!n.path.includes("[_key=="))return e;const r=function(e){return e.split(".").toReversed().reduce(((e,t)=>e.length?[t,...e]:t.includes("[_key==")?[t]:[]),[]).join(".")}(n.path);return e.find((e=>e.id===n.id&&e.path===r))||e.push({id:n.id,path:r}),e}),[])}(a);return t.some((e=>!w.current.find((t=>{const{id:n,path:r}=t;return n===e.id&&r===e.path}))))&&(async(e,t)=>{if(e.length&&o)try{const n=await o.fetch("visual-editing/schema-union-types",{paths:e},{signal:t,suppressWarnings:!0});l(n.types),w.current=e}catch{}})(t,e.signal),()=>e.abort()},k=[o,a],n[7]=o,n[8]=a,n[9]=x,n[10]=k):(x=n[9],k=n[10]),d(x,k),n[11]!==u?(S=(e,t)=>{const n=t||"document";if(!u||"string"!=typeof e&&(!Pt(e)||!Array.isArray(u)))return;const r="string"==typeof e?e:e.type,o="document"===n?$t:Dt;return u.filter(o).find((e=>e.name===r))},n[11]=u,n[12]=S):S=n[12];const _=S;let E;n[13]!==_||n[14]!==c?(E=e=>{if(!Pt(e))return{field:void 0,parent:void 0};const t=_(e);if(!t)return{field:void 0,parent:void 0};const n=e.path.split(".").flatMap(zt);try{return function t(n,r,o,i){const a=void 0===i?[]:i;if(!n)return{field:void 0,parent:void 0};const[s,...l]=r;if("fields"in n){const e=n.fields[s];if(!e&&"rest"in n)return t(n.rest,r,n,a);if(!l.length)return{field:e,parent:o};if(!e)throw new Error(`[@sanity/visual-editing] No field could be resolved at path: "${[...a,...r].join(".")}"`);return t(e.value,l,n,[...a,s])}if("array"===n.type)return t(n.of,r,n,a);if("arrayItem"===n.type)return l.length?t(n.value,l,n,[...a,s]):{field:n,parent:o};if("union"===n.type){const r=s.startsWith("[_key==")?c?.get(e.id)?.get([a.join("."),s].filter(Boolean).join("")):s;return t(n.of.find((e=>"unionOption"===e.type?e.name===r:e)),l,n,[...a,s])}if("unionOption"===n.type)return s?t(n.value,r,n,a):{field:n,parent:o};if("inline"===n.type)return t(_(n.name,"type").value,r,n,a);throw new Error(`[@sanity/visual-editing] No field could be resolved at path: "${[...a,...r].join(".")}"`)}(t,n,void 0)}catch(e){const t=e;return t instanceof Error&&console.warn(t.message),{field:void 0,parent:void 0}}},n[13]=_,n[14]=c,n[15]=E):E=n[15];const M=E;let I,P,$;n[16]!==u?(P=u||[],n[16]=u,n[17]=P):P=n[17],n[18]!==M||n[19]!==_||n[20]!==c||n[21]!==P?($={getField:M,getType:_,resolvedTypes:c,schema:P},n[18]=M,n[19]=_,n[20]=c,n[21]=P,n[22]=$):$=n[22],I=$;const D=I;let T;return n[23]!==i||n[24]!==D?(T=e(qe.Provider,{value:D,children:i}),n[23]=i,n[24]=D,n[25]=T):T=n[25],T};function zt(e){return e.includes("[")?e.split(/(\[.+\])/,2):[e]}const Rt=(e=>{let t=e;const n=new Set;return{getState:()=>t,setState:e=>{t=e(t),n.forEach((e=>e()))},subscribe:e=>(n.add(e),()=>n.delete(e))}})({}),Lt=t=>{const n=r(11),{comlink:o,children:i}=t;let a,s,c,l,u,p;n[0]!==o?(a=()=>o?.on("presentation/shared-state",At),s=[o],n[0]=o,n[1]=a,n[2]=s):(a=n[1],s=n[2]),d(a,s),n[3]!==o?(c=()=>{(async function(){const e=await(o?.fetch("visual-editing/shared-state",void 0,{suppressWarnings:!0}));e&&Rt.setState((()=>e.state))})().catch(jt)},l=[o],n[3]=o,n[4]=c,n[5]=l):(c=n[4],l=n[5]),d(c,l),n[6]!==o?(p={comlink:o,store:Rt},n[6]=o,n[7]=p):p=n[7],u=p;const m=u;let h;return n[8]!==i||n[9]!==m?(h=e(ze.Provider,{value:m,children:i}),n[8]=i,n[9]=m,n[10]=h):h=n[10],h};function At(e){"value"in e?Rt.setState((t=>({...t,[e.key]:e.value}))):Rt.setState((t=>Object.fromEntries(Object.entries(t).filter((t=>{const[n]=t;return n!==e.key})))))}function jt(e){console.debug(e),console.warn("[@sanity/visual-editing]: Failed to fetch shared state. Check your version of `@sanity/presentation` is up-to-date")}function Ct(){}function Ft(e){return e.id}function Nt(e){return!!e}function Wt(e){const{sanity:t}=e;return"id"in t?{...t,id:"isDraft"in t?`${Fe}${t.id}`:t.id}:null}const Gt=ye.div`
  background-color: transparent;
  direction: ltr;
  inset: 0;
  pointer-events: none;
  position: absolute;
  width: 100%;
  height: 100%;
  z-index: ${({$zIndex:e})=>e??"9999999"};
`;function Ot(e){let t,n;return t=requestAnimationFrame((()=>{n=requestAnimationFrame(e)})),()=>{void 0!==t&&cancelAnimationFrame(t),void 0!==n&&cancelAnimationFrame(n)}}const Ut=e=>{const t=r(8),{documentIds:n}=e;let o;t[0]===Symbol.for("react.memo_cache_sentinel")?(o=[],t[0]=o):o=t[0];const[i,a]=m(o);let s,c;t[1]!==n?(s=()=>{a((e=>{const t=Array.from(new Set(n));return e.length===t.length&&0===e.reduce(Vt,t)?.length?e:t}))},c=[n],t[1]=n,t[2]=s,t[3]=c):(s=t[2],c=t[3]),d(s,c);const l=O();let u,p;return t[4]!==l||t[5]!==i?(u=()=>{for(const e of i)l.send({type:"observe",documentId:U(e)}),l.send({type:"observe",documentId:B(e)});return()=>{for(const e of i)l.send({type:"unobserve",documentId:U(e)}),l.send({type:"unobserve",documentId:B(e)})}},p=[l,i],t[4]=l,t[5]=i,t[6]=u,t[7]=p):(u=t[6],p=t[7]),d(u,p),null},Bt=e=>{const t=r(11),{comlink:n,dispatch:o,inFrame:i,onDrag:a,overlayEnabled:s,rootElement:c}=e,{dispatchDragEndEvent:l}=function(){const e=r(4),{getDocument:t}=L();let n,o;e[0]!==t?(n=()=>{const e=e=>{const{insertPosition:n,target:r,preventInsertDefault:o}=e.detail;if(o)return;const i=function(e){if(e){const{top:t,right:n,bottom:r,left:o}=e;if(o||t)return{node:(o??t).sanity,position:"after"};if(n||r)return{node:(n??r).sanity,position:"before"}}}(n);if(i){const e=t(r.id),{node:n,position:o}=i,{key:a,hasExplicitKey:s}=A(r),{path:c,key:l}=A(n);c&&l&&l!==a&&e.patch((async e=>{const{getSnapshot:t}=e,n=await t(),i=j(n,r.path);return s?[$(c,D({_key:a})),$(c,T(i,o,{_key:l}))]:[$(c,D(~~a)),$(c,T(i,o,l>a?~~l-1:~~l))]}))}};return window.addEventListener("sanity/dragEnd",e),()=>{window.removeEventListener("sanity/dragEnd",e)}},o=[t],e[0]=t,e[1]=n,e[2]=o):(n=e[1],o=e[2]),d(n,o);const i=Be;let a;return e[3]===Symbol.for("react.memo_cache_sentinel")?(a={dispatchDragEndEvent:i},e[3]=a):a=e[3],a}();let u;t[0]!==n||t[1]!==o||t[2]!==l||t[3]!==a?(u=e=>{if("element/click"===e.type){const{sanity:t}=e;n?.post("visual-editing/focus",t)}else if("overlay/activate"===e.type)n?.post("visual-editing/toggle",{enabled:!0});else if("overlay/deactivate"===e.type)n?.post("visual-editing/toggle",{enabled:!1});else if("overlay/dragEnd"===e.type){const{insertPosition:t,target:n,dragGroup:r,flow:o,preventInsertDefault:i}=e;l({insertPosition:t,target:n,dragGroup:r,flow:o,preventInsertDefault:i})}else{if("overlay/dragUpdateCursorPosition"===e.type)return void a(e.x,e.y);if("overlay/setCursor"===e.type){const{element:t,cursor:n}=e;n?t.style.cursor=n:t.style.removeProperty("cursor")}}o(e)},t[0]=n,t[1]=o,t[2]=l,t[3]=a,t[4]=u):u=t[4];const p=function(e,t,n){const o=r(6),i=f(),a=G();let s,c;return o[0]!==e||o[1]!==t||o[2]!==n||o[3]!==a?(s=()=>{if(e)return i.current=Re({handler:t,overlayElement:e,inFrame:n,optimisticActorReady:a}),()=>{i.current?.destroy(),i.current=void 0}},c=[e,t,n,a],o[0]=e,o[1]=t,o[2]=n,o[3]=a,o[4]=s,o[5]=c):(s=o[4],c=o[5]),d(s,c),i}(c,u,i);let m,h;return t[5]!==p.current||t[6]!==s?(m=()=>{s?p.current?.activate():p.current?.deactivate()},t[5]=p.current,t[6]=s,t[7]=m):m=t[7],t[8]!==p||t[9]!==s?(h=[p,s],t[8]=p,t[9]=s,t[10]=h):h=t[10],d(m,h),null},qt=a=>{const s=r(70),{comlink:c,componentResolver:l,inFrame:u,zIndex:p}=a,[h,v]=m(),y=ke();let g;s[0]===Symbol.for("react.memo_cache_sentinel")?(g={contextMenu:null,dragInsertPosition:null,dragShowMinimap:!1,dragShowMinimapPrompt:!1,dragSkeleton:null,elements:[],focusPath:"",isDragging:!1,perspective:"published",wasMaybeCollapsed:!1,dragMinimapTransition:!1,dragGroupRect:null},s[0]=g):g=s[0];const[w,x]=b(Mt,g),{contextMenu:k,dragInsertPosition:S,dragShowMinimap:_,dragShowMinimapPrompt:E,dragSkeleton:M,elements:I,isDragging:P,perspective:$,wasMaybeCollapsed:D,dragMinimapTransition:T,dragGroupRect:z}=w,[R,L]=m(null),[A,j]=m(!0);let C,F,N;s[1]!==c?(C=()=>{const e=[c?.on("presentation/focus",(e=>{x({type:"presentation/focus",data:e})})),c?.on("presentation/blur",(e=>{x({type:"presentation/blur",data:e})})),c?.on("presentation/toggle-overlay",(()=>{j(Kt)})),c?.onStatus((e=>{v(e)}))].filter(Boolean);return()=>e.forEach(Yt)},F=[c],s[1]=c,s[2]=C,s[3]=F):(C=s[2],F=s[3]),d(C,F),function(e,t){const n=r(4);let o,i;n[0]!==e||n[1]!==t?(o=()=>{const n=new AbortController;e?.fetch("visual-editing/fetch-perspective",void 0,{signal:n.signal,suppressWarnings:!0}).then((e=>{t({type:"presentation/perspective",data:e})})).catch(Ct);const r=e?.on("presentation/perspective",(e=>{t({type:"presentation/perspective",data:e})}));return()=>{r?.(),n.abort()}},i=[e,t],n[0]=e,n[1]=t,n[2]=o,n[3]=i):(o=n[2],i=n[3]),d(o,i)}(c,x),function(e,t,n){const o=r(7),i=f(void 0);let a;o[0]!==e?(a=(t,n)=>{e?.post("visual-editing/documents",{documents:t,perspective:n})},o[0]=e,o[1]=a):a=o[1];const s=a;let c,l;o[2]!==t||o[3]!==n||o[4]!==s?(c=()=>{const e=t.map(Wt).filter(Nt),r=new Set(e.map(Ft));if(!i.current||!function(e,t){if(e===t)return!0;if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}(r,i.current.nodeIds)||n!==i.current.perspective){const t=Array.from(r).map((t=>{const n=e.find((e=>e.id===t)),{type:r,projectId:o,dataset:i}=n;return o&&i?{_id:t,_type:r,_projectId:o,_dataset:i}:{_id:t,_type:r}}));i.current={nodeIds:r,perspective:n},s(t,n)}},l=[t,n,s],o[2]=t,o[3]=n,o[4]=s,o[5]=c,o[6]=l):(c=o[5],l=o[6]),d(c,l)}(c,I,$),s[4]!==R?(N=(e,t)=>{R&&(R.style.setProperty("--drag-preview-x",`${e}px`),R.style.setProperty("--drag-preview-y",t-window.scrollY+"px"))},s[4]=R,s[5]=N):N=s[5];const W=N;let O,U;s[6]===Symbol.for("react.memo_cache_sentinel")?(O=()=>{const e=Ht,t=e=>{o(e)&&j(Xt)},n=e=>{o(e)&&j(Zt),i(["mod","\\"],e)&&j(Jt)};return window.addEventListener("click",e),window.addEventListener("keydown",n),window.addEventListener("keyup",t),()=>{window.removeEventListener("click",e),window.removeEventListener("keydown",n),window.removeEventListener("keyup",t)}},U=[j],s[6]=O,s[7]=U):(O=s[6],U=s[7]),d(O,U);const[B,q]=m(!1),[V,K]=m(!1),Y=f(void 0);let H,X,Z,J;s[8]!==A?(H=()=>{if(A)return Ot((()=>{q(!0),Ot((()=>{K(!0),Y.current=setTimeout((()=>{K(!1),q(!1)}),1500)}))}));Y.current&&(clearTimeout(Y.current),q(!1),K(!1))},X=[A],s[8]=A,s[9]=H,s[10]=X):(H=s[9],X=s[10]),d(H,X),s[11]!==I?(J=I.flatMap(Qt),s[11]=I,s[12]=J):J=s[12],Z=J;const Q=Z;let ee;s[13]===Symbol.for("react.memo_cache_sentinel")?(ee=()=>{x({type:"overlay/blur"})},s[13]=ee):ee=s[13];const te=ee,ne=G();let re;re=ne?l:void 0;const oe=re;let ie;e:{if(u&&"connected"!==h||P){let e;s[14]===Symbol.for("react.memo_cache_sentinel")?(e=[],s[14]=e):e=s[14],ie=e;break e}let t;s[15]!==oe||s[16]!==T||s[17]!==_||s[18]!==I||s[19]!==u||s[20]!==P||s[21]!==ne||s[22]!==D?(t=I.filter(en).map((t=>{const{id:n,element:r,focused:o,hovered:i,rect:a,sanity:s,dragDisabled:c}=t,l=!c&&!!r.getAttribute("data-sanity")&&ne&&I.some((e=>"id"in e.sanity&&"id"in s&&(Le(e.sanity,s)&&e.sanity.path!==s.path)));return e(ut,{componentResolver:oe,element:r,enableScrollIntoView:!P&&!T&&!_,focused:o,hovered:i,node:s,rect:a,showActions:!u,draggable:l,isDragging:P||T,wasMaybeCollapsed:o&&D},n)})),s[15]=oe,s[16]=T,s[17]=_,s[18]=I,s[19]=u,s[20]=P,s[21]=ne,s[22]=D,s[23]=t):t=s[23],ie=t}const ae=ie,se=y?"dark":"light",ce=V?"":void 0,le=B?"":void 0;let de,ue,pe,me,he,fe,ve,ye,ge,be,we;return s[24]!==Q||s[25]!==$?(de=e(Ut,{documentIds:Q,perspective:$}),s[24]=Q,s[25]=$,s[26]=de):de=s[26],s[27]!==c||s[28]!==u||s[29]!==A||s[30]!==R||s[31]!==W?(ue=e(Bt,{comlink:c,dispatch:x,inFrame:u,onDrag:W,overlayEnabled:A,rootElement:R}),s[27]=c,s[28]=u,s[29]=A,s[30]=R,s[31]=W,s[32]=ue):ue=s[32],s[33]!==k?(pe=k&&e(rt,{...k,onDismiss:te}),s[33]=k,s[34]=pe):pe=s[34],s[35]!==z||s[36]!==S||s[37]!==T||s[38]!==E||s[39]!==P?(me=P&&!T&&t(n,{children:[S&&e(gt,{dragInsertPosition:S}),E&&e(_t,{}),z&&e(vt,{dragGroupRect:z})]}),s[35]=z,s[36]=S,s[37]=T,s[38]=E,s[39]=P,s[40]=me):me=s[40],s[41]!==M||s[42]!==P?(he=P&&M&&e(wt,{skeleton:M}),s[41]=M,s[42]=P,s[43]=he):he=s[43],s[44]!==ae||s[45]!==ce||s[46]!==le||s[47]!==de||s[48]!==ue||s[49]!==pe||s[50]!==me||s[51]!==he||s[52]!==p?(fe=t(Gt,{"data-fading-out":ce,"data-overlays":le,ref:L,$zIndex:p,children:[de,ue,pe,ae,me,he]}),s[44]=ae,s[45]=ce,s[46]=le,s[47]=de,s[48]=ue,s[49]=pe,s[50]=me,s[51]=he,s[52]=p,s[53]=fe):fe=s[53],s[54]!==c||s[55]!==fe?(ve=e(Lt,{comlink:c,children:fe}),s[54]=c,s[55]=fe,s[56]=ve):ve=s[56],s[57]!==c||s[58]!==ve?(ye=e(It,{comlink:c,children:ve}),s[57]=c,s[58]=ve,s[59]=ye):ye=s[59],s[60]!==c||s[61]!==I||s[62]!==ye?(ge=e(Tt,{comlink:c,elements:I,children:ye}),s[60]=c,s[61]=I,s[62]=ye,s[63]=ge):ge=s[63],s[64]!==R||s[65]!==ge?(be=e(Me,{children:e(Ie,{element:R,children:ge})}),s[64]=R,s[65]=ge,s[66]=be):be=s[66],s[67]!==se||s[68]!==be?(we=e(Pe,{scheme:se,theme:$e,tone:"transparent",children:be}),s[67]=se,s[68]=be,s[69]=we):we=s[69],we};function Vt(e,t){return e.filter((e=>e!==t))}function Kt(e){return!e}function Yt(e){return e()}function Ht(e){const t=e.target;if((De(t)||Te(t)&&t.closest("a"))&&e.altKey){e.preventDefault(),e.stopPropagation();const t=new MouseEvent(e.type,{...e,altKey:!1,bubbles:!0,cancelable:!0});e.target?.dispatchEvent(t)}}function Xt(e){return!e}function Zt(e){return!e}function Jt(e){return!e}function Qt(e){return"id"in e.sanity?[e.sanity.id]:[]}function en(e){return e.activated||e.focused}const tn=e=>{const t=r(4),{comlink:n,refresh:o}=e,i=f(0),a=f(0);let s,c;return t[0]!==n||t[1]!==o?(s=()=>n.on("presentation/refresh",(e=>{if("manual"===e.source){clearTimeout(i.current);const t=o(e);if(!1===t)return;let r;n.post("visual-editing/refreshing",e),r=!1,i.current=window.setTimeout((()=>{n.post("visual-editing/refreshed",e),r=!0}),3e3),t?.finally?.((()=>{r||(clearTimeout(i.current),n.post("visual-editing/refreshed",e))}))}else if("mutation"===e.source){clearTimeout(a.current);const t=o(e);if(!1===t)return;n.post("visual-editing/refreshing",e),a.current=window.setTimeout((()=>{const t=o(e);!1!==t&&(n.post("visual-editing/refreshing",e),t?.finally?.((()=>{n.post("visual-editing/refreshed",e)}))||n.post("visual-editing/refreshed",e))}),1e3),t?.finally?.((()=>{n.post("visual-editing/refreshed",e)}))||n.post("visual-editing/refreshed",e)}})),c=[n,o],t[0]=n,t[1]=o,t[2]=s,t[3]=c):(s=t[2],c=t[3]),d(s,c),null},nn=o=>{const i=r(13),{components:s,history:u,refresh:p,zIndex:h}=o,f=window.self!==window.top||window.opener,[v,y]=m(void 0);let g,b,w,x,k;return i[0]===Symbol.for("react.memo_cache_sentinel")?(g=()=>{if(!f)return;const e=c({name:"visual-editing",connectTo:"presentation"},l().provide({actors:a()}));y(e);const t=function(e){const t=new V(1),n=new K;return e.fetch("visual-editing/snapshot-welcome",void 0,{suppressWarnings:!0}).then((e=>{t.next(e.event)})).catch((()=>{})),e.on("presentation/snapshot-event",(e=>{"reconnect"===e.event.type&&t.next(e.event),"mutation"===e.event.type&&n.next(e.event)})),Y(t,n)}(e),n=(e=>We.provide({actors:{documentMutatorMachine:Ge(e)}}))(e),r=I(n,{input:{client:{withConfig:rn},sharedListener:t}}),o=new AbortController;return e.fetch("visual-editing/features",void 0,{signal:o.signal,suppressWarnings:!0}).then((e=>{e.features.optimistic&&q(r)})).catch(on),r.start(),e.start(),()=>{o.abort(),r.stop(),e.stop()}},b=[f],i[0]=g,i[1]=b):(g=i[0],b=i[1]),d(g,b),i[2]!==v||i[3]!==s||i[4]!==h?(w=e(qt,{comlink:v,componentResolver:s,inFrame:f,zIndex:h}),i[2]=v,i[3]=s,i[4]=h,i[5]=w):w=i[5],i[6]!==v||i[7]!==u||i[8]!==p?(x=v&&t(n,{children:[e(Oe,{comlink:v,history:u}),e(Ue,{comlink:v}),p&&e(tn,{comlink:v,refresh:p})]}),i[6]=v,i[7]=u,i[8]=p,i[9]=x):x=i[9],i[10]!==w||i[11]!==x?(k=t(n,{children:[w,x]}),i[10]=w,i[11]=x,i[12]=k):k=i[12],k};function rn(){}function on(){console.warn("[@sanity/visual-editing] Package version mismatch detected: Please update your Sanity studio to prevent potential compatibility issues.")}nn.displayName="VisualEditing";export{nn as VisualEditing,s as createDataAttribute};//# sourceMappingURL=index.js.map
