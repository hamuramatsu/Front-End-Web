{"version":3,"file":"index.js","sources":["../../src/ui/optimistic-state/machines/datasetMutatorMachine.ts","../../src/ui/comlink/index.ts","../../src/ui/History.tsx","../../src/ui/Meta.ts","../../src/util/useDragEvents.ts","../../src/ui/schema/SchemaContext.tsx","../../src/ui/schema/useSchema.ts","../../src/ui/context-menu/contextMenuItems.tsx","../../src/ui/context-menu/ContextMenu.tsx","../../src/ui/preview/PreviewSnapshotsContext.tsx","../../src/ui/ElementOverlay.tsx","../../src/ui/preview/usePreviewSnapshots.ts","../../src/ui/OverlayDragGroupRect.tsx","../../src/ui/OverlayDragInsertMarker.tsx","../../src/ui/OverlayDragPreview.tsx","../../src/ui/OverlayMinimapPrompt.tsx","../../src/ui/elementsReducer.ts","../../src/ui/overlayStateReducer.ts","../../src/ui/preview/PreviewSnapshotsProvider.tsx","../../src/ui/schema/SchemaProvider.tsx","../../src/ui/shared-state/SharedStateProvider.tsx","../../src/ui/usePerspectiveSync.tsx","../../src/ui/useReportDocuments.ts","../../src/ui/Overlays.tsx","../../src/ui/useController.tsx","../../src/ui/Refresh.tsx","../../src/ui/VisualEditing.tsx","../../src/ui/optimistic-state/machines/createSharedListener.ts"],"sourcesContent":["/**\n * The logic here is intended to live inside a preview iframe, and listen to events from the parent frame.\n * It also supports running in a \"detached\" mode, where it has to setup authenticated EventSource conenctions and perform data fetching itself.\n */\n\nimport {type SanityClient} from '@sanity/client'\nimport {\n  createSharedListener,\n  documentMutatorMachine,\n  type DocumentMutatorMachineInput,\n  type DocumentMutatorMachineParentEvent,\n} from '@sanity/mutate/_unstable_machine'\nimport {assertEvent, assign, emit, setup, stopChild, type ActorRefFrom} from 'xstate'\nimport type {createDocumentMutator} from '../../comlink'\n\nexport interface DatasetMutatorMachineInput extends Omit<DocumentMutatorMachineInput, 'id'> {\n  client: SanityClient\n  /** A shared listener can be provided, if not it'll be created using `client.listen()` */\n  sharedListener?: ReturnType<typeof createSharedListener>\n}\n\nexport const datasetMutatorMachine = setup({\n  types: {} as {\n    context: {\n      client: SanityClient\n      /** A shared listener can be provided, if not it'll be created using `client.listen()` */\n      sharedListener?: ReturnType<typeof createSharedListener>\n      documents: Record<string, ActorRefFrom<ReturnType<typeof createDocumentMutator>>>\n    }\n    events:\n      | {type: 'observe'; documentId: string}\n      | {type: 'unobserve'; documentId: string}\n      | {type: 'add document actor'; documentId: string}\n      | {type: 'stop document actor'; documentId: string}\n      | DocumentMutatorMachineParentEvent\n    input: DatasetMutatorMachineInput\n    emitted: DocumentMutatorMachineParentEvent\n  },\n  actions: {\n    'emit sync event': emit(({event}) => {\n      assertEvent(event, 'sync')\n      return event\n    }),\n    'emit mutation event': emit(({event}) => {\n      assertEvent(event, 'mutation')\n      return event\n    }),\n    'emit rebased event': emit(({event}) => {\n      assertEvent(event, ['rebased.local', 'rebased.remote'])\n      return event\n    }),\n    'emit pristine event': emit(({event}) => {\n      assertEvent(event, ['pristine'])\n      return event\n    }),\n    'add document actor': assign({\n      documents: ({context, event, spawn}) => {\n        assertEvent(event, 'observe')\n        const id = event.documentId\n        // Adding the same documentId multiple times is a no-op\n        if (context.documents[id]) return context.documents\n        return {\n          ...context.documents,\n          [id]: spawn('documentMutatorMachine', {\n            input: {\n              id,\n              client: context.client,\n              sharedListener: context.sharedListener || createSharedListener(context.client),\n            },\n            id,\n          }),\n        }\n      },\n    }),\n    'stop remote snapshot': stopChild(({context, event}) => {\n      assertEvent(event, 'unobserve')\n      return context.documents[event.documentId]!\n    }),\n    'remove remote snapshot from context': assign({\n      documents: ({context, event}) => {\n        assertEvent(event, 'unobserve')\n        // Removing a non-existing documentId is a no-op\n        if (!context.documents[event.documentId]) return context.documents\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const {[event.documentId]: _, ...documents} = context.documents\n        return documents\n      },\n    }),\n  },\n  actors: {\n    documentMutatorMachine,\n  },\n}).createMachine({\n  /** @xstate-layout N4IgpgJg5mDOIC5QBsD2BjAhsgIhgrgLZgB2ALgMTICWsZpA2gAwC6ioADqrNWdaiXYgAHogC0ADgBMAOgkA2ACyKArBICcTdfKXSANCACeiFQHYZpgMxWV800yYqp6gIyn5AXw8G0WXAWJyCnwSGjpGViEuHj4BIVEEKUt5OSlFU1smFwkFW0sDY0T1GRUXRXkXKVN7HSYJJkUvHwxsPHQiUjIZDgAnWj4SMApCfDJMemY2JBBo3n5BaYSXeVlbKRUsiXdFSxcXfKNERSqZTbr1zVMJNyaQX1aAzpkIah6yQwp0VEJCXkmo7hzOKLRDLFwyFxaSzXKTOKQudSKCQFRDOczqCSWJjwjbHCQqRFebwgEioCBwIT3fztQJkAExebxcQuFEIZaWGRIrF7dSXKTyFSNYlUtodcjdPp0aiDelAhagBLpVmWAmc46mNwSZTyLQuFS3EWPcUvN6FTiA2LykSoq6c6wbCqVUzparKioyRFVfkq1zqNSWIkeIA */\n  id: 'dataset-mutator',\n  context: ({input}) => ({\n    documents: {},\n    client: input.client,\n    sharedListener: input.sharedListener,\n  }),\n\n  on: {\n    'sync': {actions: ['emit sync event']},\n    'mutation': {actions: ['emit mutation event']},\n    'rebased.*': {actions: ['emit rebased event']},\n    'pristine': {actions: ['emit pristine event']},\n    'observe': {\n      actions: ['add document actor'],\n    },\n    'unobserve': {\n      actions: ['stop remote snapshot', 'remove remote snapshot from context'],\n    },\n  },\n\n  initial: 'pristine',\n\n  states: {\n    pristine: {},\n  },\n})\n","import type {SanityClient} from '@sanity/client'\nimport {SanityEncoder, type Transaction} from '@sanity/mutate'\nimport {\n  documentMutatorMachine,\n  type DocumentMutatorMachineParentEvent,\n} from '@sanity/mutate/_unstable_machine'\nimport {enqueueActions, fromPromise} from 'xstate'\nimport type {VisualEditingNode} from '../../types'\nimport {datasetMutatorMachine} from '../optimistic-state/machines/datasetMutatorMachine'\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport const createDocumentMutator = (comlink: VisualEditingNode) => {\n  const fetchSnapshot = fromPromise(\n    async ({input, signal}: {input: {id: string; client: SanityClient}; signal: AbortSignal}) => {\n      const {id} = input\n      const {snapshot} = await comlink.fetch(\n        'visual-editing/fetch-snapshot',\n        {documentId: id},\n        {\n          signal,\n        },\n      )\n      return snapshot\n    },\n  )\n\n  const submitMutations = fromPromise(\n    async ({input}: {input: {client: SanityClient; transactions: Transaction[]}}) => {\n      const {transactions} = input\n      for (const transaction of transactions) {\n        const data = SanityEncoder.encodeTransaction(transaction)\n        return comlink.post('visual-editing/mutate', data)\n      }\n    },\n  )\n\n  return documentMutatorMachine.provide({\n    actions: {\n      'send sync event to parent': enqueueActions(({enqueue}) => {\n        // Original action provided by the `documentMutatorMachine`\n        enqueue.sendParent(\n          ({context}) =>\n            ({\n              type: 'sync',\n              id: context.id,\n              document: context.remote!,\n            }) satisfies DocumentMutatorMachineParentEvent,\n        )\n        // Additional action so that we can determine when the snapshot is ready\n        enqueue.emit(({context}) => ({type: 'ready', snapshot: context.local}))\n      }),\n    },\n    actors: {\n      'fetch remote snapshot': fetchSnapshot,\n      'submit mutations as transactions': submitMutations,\n    },\n  })\n}\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport const createDatasetMutator = (comlink: VisualEditingNode) => {\n  return datasetMutatorMachine.provide({\n    actors: {\n      documentMutatorMachine: createDocumentMutator(comlink),\n    },\n  })\n}\n","import {useEffect, type FunctionComponent} from 'react'\nimport type {HistoryAdapter, VisualEditingNode} from '../types'\n\n/**\n * @internal\n */\nexport const History: FunctionComponent<{\n  comlink: VisualEditingNode\n  history?: HistoryAdapter\n}> = (props) => {\n  const {comlink, history} = props\n\n  useEffect(() => {\n    return comlink?.on('presentation/navigate', (data) => {\n      history?.update(data)\n    })\n  }, [comlink, history])\n\n  useEffect(() => {\n    if (history) {\n      return history.subscribe((update) => {\n        update.title = update.title || document.title\n        comlink?.post('visual-editing/navigate', update)\n      })\n    }\n    return\n  }, [comlink, history])\n\n  return null\n}\n","import {useEffect, type FunctionComponent} from 'react'\nimport type {VisualEditingNode} from '../types'\n\n/**\n * @internal\n */\nexport const Meta: FunctionComponent<{\n  comlink: VisualEditingNode\n}> = (props) => {\n  const {comlink} = props\n\n  useEffect(() => {\n    const sendMeta = () => {\n      comlink.post('visual-editing/meta', {title: document.title})\n    }\n\n    const observer = new MutationObserver(([mutation]) => {\n      if (mutation.target.nodeName === 'TITLE') {\n        sendMeta()\n      }\n    })\n\n    observer.observe(document.head, {\n      subtree: true,\n      characterData: true,\n      childList: true,\n    })\n\n    sendMeta()\n\n    return () => observer.disconnect()\n  }, [comlink])\n\n  return null\n}\n","import {at, insert, remove} from '@sanity/mutate'\nimport {get as getFromPath} from '@sanity/util/paths'\nimport {useCallback, useEffect} from 'react'\nimport type {DragEndEvent, DragInsertPosition} from '../types'\nimport {useDocuments} from '../ui/optimistic-state/useDocuments'\nimport {getArrayItemKeyAndParentPath} from './mutations'\n\n// Finds the node that the drag end event was relative to, and the relative\n// position the new element should be inserted in. If the reference node was\n// \"top\" or \"left\", we insert \"after\". If it was \"bottom\" or \"right\", we insert\n// \"before\".\nfunction getReferenceNodeAndInsertPosition(position: DragInsertPosition) {\n  if (position) {\n    const {top, right, bottom, left} = position\n    if (left || top) {\n      return {node: (left ?? top)!.sanity, position: 'after' as const}\n    } else if (right || bottom) {\n      return {node: (right ?? bottom)!.sanity, position: 'before' as const}\n    }\n  }\n  return undefined\n}\n\nexport function useDragEndEvents(): {\n  dispatchDragEndEvent: (event: DragEndEvent) => void\n} {\n  const {getDocument} = useDocuments()\n\n  useEffect(() => {\n    const handler = (e: CustomEvent<DragEndEvent>) => {\n      const {insertPosition, target, preventInsertDefault} = e.detail\n\n      if (preventInsertDefault) return\n\n      const reference = getReferenceNodeAndInsertPosition(insertPosition)\n      if (reference) {\n        const doc = getDocument(target.id)\n        // We must have access to the document actor in order to perform the\n        // necessary mutations. If this is undefined, something went wrong when\n        // resolving the currently in use documents\n        const {node, position} = reference\n        // Get the key of the element that was dragged\n        const {key: targetKey, hasExplicitKey} = getArrayItemKeyAndParentPath(target)\n        // Get the key of the reference element, and path to the parent array\n        const {path: arrayPath, key: referenceItemKey} = getArrayItemKeyAndParentPath(node)\n        // Don't patch if the keys match, as this means the item was only\n        // dragged to its existing position, i.e. not moved\n        if (arrayPath && referenceItemKey && referenceItemKey !== targetKey) {\n          doc.patch(async ({getSnapshot}) => {\n            const snapshot = await getSnapshot()\n            // Get the current value of the element we dragged, as we will need\n            // to clone this into the new position\n            const elementValue = getFromPath(snapshot, target.path)\n\n            if (hasExplicitKey) {\n              return [\n                // Remove the original dragged item\n                at(arrayPath, remove({_key: targetKey})),\n                // Insert the cloned dragged item into its new position\n                at(arrayPath, insert(elementValue, position, {_key: referenceItemKey})),\n              ]\n            } else {\n              // handle reordering for primitives\n              return [\n                // Remove the original dragged item\n                at(arrayPath, remove(~~targetKey)),\n                // Insert the cloned dragged item into its new position\n                at(\n                  arrayPath,\n                  insert(\n                    elementValue,\n                    position,\n                    // if target key is < reference, each item in the array's index will be one less due to the previous removal\n                    referenceItemKey > targetKey ? ~~referenceItemKey - 1 : ~~referenceItemKey,\n                  ),\n                ),\n              ]\n            }\n          })\n        }\n      }\n    }\n    window.addEventListener('sanity/dragEnd', handler as EventListener)\n    return () => {\n      window.removeEventListener('sanity/dragEnd', handler as EventListener)\n    }\n  }, [getDocument])\n\n  const dispatchDragEndEvent = useCallback((event: DragEndEvent) => {\n    const customEvent = new CustomEvent<DragEndEvent>('sanity/dragEnd', {\n      detail: event,\n      cancelable: true,\n    })\n    window.dispatchEvent(customEvent)\n  }, [])\n\n  return {dispatchDragEndEvent}\n}\n","import type {\n  DocumentSchema,\n  ResolvedSchemaTypeMap,\n  SanityNode,\n  SanityStegaNode,\n  SchemaType,\n  TypeSchema,\n} from '@repo/visual-editing-helpers'\nimport {createContext} from 'react'\nimport type {OverlayElementField, OverlayElementParent} from '../../types'\n\nexport interface SchemaContextValue {\n  getField: (node: SanityNode | SanityStegaNode) => {\n    field: OverlayElementField\n    parent: OverlayElementParent\n  }\n  getType: <T extends 'document' | 'type' = 'document'>(\n    node: SanityNode | SanityStegaNode | string,\n    type?: T,\n  ) => T extends 'document' ? DocumentSchema | undefined : TypeSchema | undefined\n  resolvedTypes: ResolvedSchemaTypeMap\n  schema: SchemaType[]\n}\n\nexport const SchemaContext = createContext<SchemaContextValue | null>(null)\n","import {useContext} from 'react'\nimport {SchemaContext, type SchemaContextValue} from './SchemaContext'\n\nexport function useSchema(): SchemaContextValue {\n  const context = useContext(SchemaContext)\n\n  if (!context) {\n    throw new Error('Schema context is missing')\n  }\n\n  return context\n}\n","import type {\n  SanityNode,\n  SchemaArrayItem,\n  SchemaNode,\n  SchemaUnionNode,\n  SchemaUnionOption,\n} from '@repo/visual-editing-helpers'\nimport {\n  ArrowDownIcon,\n  ArrowUpIcon,\n  CopyIcon,\n  InsertAboveIcon,\n  InsertBelowIcon,\n  PublishIcon,\n  RemoveIcon,\n  SortIcon,\n  UnpublishIcon,\n} from '@sanity/icons'\nimport type {SchemaType} from '@sanity/types'\nimport {MenuGroup} from '@sanity/ui'\nimport {type FunctionComponent} from 'react'\nimport {InsertMenu} from '../../overlay-components/components/InsertMenu'\nimport type {ContextMenuNode, OverlayElementField, OverlayElementParent} from '../../types'\nimport {getNodeIcon} from '../../util/getNodeIcon'\nimport {\n  getArrayDuplicatePatches,\n  getArrayInsertPatches,\n  getArrayMovePatches,\n  getArrayRemovePatches,\n} from '../../util/mutations'\nimport type {OptimisticDocument} from '../optimistic-state/useDocuments'\n\nexport function getArrayRemoveAction(node: SanityNode, doc: OptimisticDocument): () => void {\n  if (!node.type) throw new Error('Node type is missing')\n  return () =>\n    doc.patch(async ({getSnapshot}) => getArrayRemovePatches(node, (await getSnapshot())!))\n}\n\nfunction getArrayInsertAction(\n  node: SanityNode,\n  doc: OptimisticDocument,\n  insertType: string,\n  position: 'before' | 'after',\n): () => void {\n  if (!node.type) throw new Error('Node type is missing')\n  return () => doc.patch(() => getArrayInsertPatches(node, insertType, position))\n}\n\nfunction getDuplicateAction(node: SanityNode, doc: OptimisticDocument): () => void {\n  if (!node.type) throw new Error('Node type is missing')\n  return () =>\n    doc.patch(async ({getSnapshot}) => getArrayDuplicatePatches(node, (await getSnapshot())!))\n}\n\nexport function getContextMenuItems(context: {\n  doc: OptimisticDocument\n  field: OverlayElementField\n  node: SanityNode\n  parent: OverlayElementParent\n}): Promise<ContextMenuNode[]> {\n  const {node, field, parent, doc} = context\n  if (field?.type === 'arrayItem') {\n    return getContextMenuArrayItems({node, field, doc})\n  }\n  if (parent?.type === 'union') {\n    return getContextMenuUnionItems({node, parent, doc})\n  }\n\n  return Promise.resolve([])\n}\n\nfunction getDuplicateItem(context: {doc: OptimisticDocument; node: SanityNode}) {\n  const {node, doc} = context\n  if (!doc) return []\n  return [\n    {\n      type: 'action' as const,\n      label: 'Duplicate',\n      icon: CopyIcon,\n      action: getDuplicateAction(node, doc),\n    },\n  ]\n}\n\nfunction getRemoveItems(context: {doc: OptimisticDocument; node: SanityNode}) {\n  const {node, doc} = context\n  if (!doc) return []\n  return [\n    {\n      type: 'action' as const,\n      label: 'Remove',\n      icon: RemoveIcon,\n      action: getArrayRemoveAction(node, doc),\n    },\n  ]\n}\n\nasync function getMoveItems(\n  context: {\n    doc: OptimisticDocument\n    node: SanityNode\n  },\n  withDivider = true,\n) {\n  const {node, doc} = context\n  if (!doc) return []\n\n  const items: ContextMenuNode[] = []\n  const groupItems: ContextMenuNode[] = []\n\n  const [moveUpPatches, moveDownPatches, moveFirstPatches, moveLastPatches] = await Promise.all([\n    getArrayMovePatches(node, doc, 'previous'),\n    getArrayMovePatches(node, doc, 'next'),\n    getArrayMovePatches(node, doc, 'first'),\n    getArrayMovePatches(node, doc, 'last'),\n  ])\n\n  if (moveFirstPatches.length) {\n    groupItems.push({\n      type: 'action',\n      label: 'To top',\n      icon: PublishIcon,\n      action: () => doc.patch(moveFirstPatches),\n    })\n  }\n  if (moveUpPatches.length) {\n    groupItems.push({\n      type: 'action',\n      label: 'Up',\n      icon: ArrowUpIcon,\n      action: () => doc.patch(moveUpPatches),\n    })\n  }\n  if (moveDownPatches.length) {\n    groupItems.push({\n      type: 'action',\n      label: 'Down',\n      icon: ArrowDownIcon,\n      action: () => doc.patch(moveDownPatches),\n    })\n  }\n  if (moveLastPatches.length) {\n    groupItems.push({\n      type: 'action',\n      label: 'To bottom',\n      icon: UnpublishIcon,\n      action: () => doc.patch(moveLastPatches),\n    })\n  }\n\n  if (groupItems.length) {\n    items.push({\n      type: 'group',\n      label: 'Move',\n      icon: SortIcon,\n      items: groupItems,\n    })\n    if (withDivider) {\n      items.push({type: 'divider'})\n    }\n  }\n\n  return items\n}\n\nasync function getContextMenuArrayItems(context: {\n  doc: OptimisticDocument\n  field: SchemaArrayItem\n  node: SanityNode\n}): Promise<ContextMenuNode[]> {\n  const {node, field, doc} = context\n  const items: ContextMenuNode[] = []\n  items.push(...getDuplicateItem(context))\n  items.push(...getRemoveItems(context))\n  items.push(...(await getMoveItems(context)))\n\n  items.push({\n    type: 'action',\n    label: 'Insert before',\n    icon: InsertAboveIcon,\n    action: getArrayInsertAction(node, doc, field.name, 'before'),\n  })\n  items.push({\n    type: 'action',\n    label: 'Insert after',\n    icon: InsertBelowIcon,\n    action: getArrayInsertAction(node, doc, field.name, 'after'),\n  })\n\n  return items\n}\n\nconst InsertMenuWrapper: FunctionComponent<{\n  label: string\n  onSelect: (schemaType: SchemaType) => void\n  parent: SchemaUnionNode<SchemaNode>\n  width: number | undefined\n  boundaryElement: HTMLDivElement | null\n}> = (props) => {\n  const {label, parent, width, onSelect, boundaryElement} = props\n\n  return (\n    <MenuGroup\n      fontSize={1}\n      icon={InsertBelowIcon}\n      padding={2}\n      popover={{\n        arrow: false,\n        constrainSize: true,\n        floatingBoundary: boundaryElement,\n        padding: 0,\n        placement: 'right-start',\n        fallbackPlacements: [\n          'left-start',\n          'right',\n          'left',\n          'right-end',\n          'left-end',\n          'bottom',\n          'top',\n        ],\n        preventOverflow: true,\n        width,\n        __unstable_margins: [4, 4, 4, 4],\n      }}\n      space={2}\n      text={label}\n    >\n      <InsertMenu node={parent} onSelect={onSelect} />\n    </MenuGroup>\n  )\n}\n\nasync function getContextMenuUnionItems(context: {\n  doc: OptimisticDocument\n  node: SanityNode\n  parent: SchemaUnionNode<SchemaNode>\n}): Promise<ContextMenuNode[]> {\n  const {doc, node, parent} = context\n  const items: ContextMenuNode[] = []\n  items.push(...getDuplicateItem(context))\n  items.push(...getRemoveItems(context))\n  items.push(...(await getMoveItems(context)))\n\n  if (parent.options?.insertMenu) {\n    const insertMenuOptions = parent.options.insertMenu || {}\n    const width = insertMenuOptions.views?.some((view) => view.name === 'grid') ? 0 : undefined\n\n    items.push({\n      type: 'custom',\n      component: ({boundaryElement}) => {\n        const onSelect = (schemaType: SchemaType) => {\n          const action = getArrayInsertAction(node, doc, schemaType.name, 'before')\n          action()\n        }\n        return (\n          <InsertMenuWrapper\n            label=\"Insert before\"\n            onSelect={onSelect}\n            parent={parent}\n            width={width}\n            boundaryElement={boundaryElement}\n          />\n        )\n      },\n    })\n\n    items.push({\n      type: 'custom',\n      component: ({boundaryElement}) => {\n        const onSelect = (schemaType: SchemaType) => {\n          const action = getArrayInsertAction(node, doc, schemaType.name, 'after')\n          action()\n        }\n        return (\n          <InsertMenuWrapper\n            label=\"Insert after\"\n            onSelect={onSelect}\n            parent={parent}\n            width={width}\n            boundaryElement={boundaryElement}\n          />\n        )\n      },\n    })\n  } else {\n    items.push({\n      type: 'group',\n      label: 'Insert before',\n      icon: InsertAboveIcon,\n      items: (\n        parent.of.filter((item) => item.type === 'unionOption') as SchemaUnionOption<SchemaNode>[]\n      ).map((t) => {\n        return {\n          type: 'action' as const,\n          icon: getNodeIcon(t),\n          label: t.name === 'block' ? 'Paragraph' : t.title || t.name,\n          action: getArrayInsertAction(node, doc, t.name, 'before'),\n        }\n      }),\n    })\n    items.push({\n      type: 'group',\n      label: 'Insert after',\n      icon: InsertBelowIcon,\n      items: (\n        parent.of.filter((item) => item.type === 'unionOption') as SchemaUnionOption<SchemaNode>[]\n      ).map((t) => {\n        return {\n          type: 'action' as const,\n          label: t.name === 'block' ? 'Paragraph' : t.title || t.name,\n          icon: getNodeIcon(t),\n          action: getArrayInsertAction(node, doc, t.name, 'after'),\n        }\n      }),\n    })\n  }\n\n  return items\n}\n","import {\n  Box,\n  Flex,\n  Menu,\n  MenuDivider,\n  MenuGroup,\n  MenuItem,\n  Popover,\n  Spinner,\n  Stack,\n  Text,\n  type PopoverMargins,\n} from '@sanity/ui'\nimport {useCallback, useEffect, useMemo, useState, type FunctionComponent} from 'react'\nimport type {ContextMenuNode, ContextMenuProps} from '../../types'\nimport {getNodeIcon} from '../../util/getNodeIcon'\nimport {useDocuments} from '../optimistic-state/useDocuments'\nimport {PopoverPortal} from '../PopoverPortal'\nimport {useSchema} from '../schema/useSchema'\nimport {getContextMenuItems} from './contextMenuItems'\n\nconst POPOVER_MARGINS: PopoverMargins = [-4, 4, -4, 4]\n\nfunction ContextMenuItem(props: {\n  node: ContextMenuNode\n  onDismiss?: () => void\n  boundaryElement: HTMLDivElement | null\n}) {\n  const {node, onDismiss, boundaryElement} = props\n\n  const onClick = useCallback(() => {\n    if (node.type === 'action') {\n      node.action?.()\n      onDismiss?.()\n    }\n  }, [node, onDismiss])\n\n  if (node.type === 'divider') {\n    return <MenuDivider />\n  }\n\n  if (node.type === 'action') {\n    return (\n      <MenuItem\n        fontSize={1}\n        hotkeys={node.hotkeys}\n        icon={node.icon}\n        padding={2}\n        space={2}\n        text={node.label}\n        disabled={!node.action}\n        onClick={onClick}\n      />\n    )\n  }\n\n  if (node.type === 'group') {\n    return (\n      <MenuGroup\n        fontSize={1}\n        icon={node.icon}\n        padding={2}\n        // @todo when this PR lands https://github.com/sanity-io/ui/pull/1454\n        // menu={{\n        //   padding: 0,\n        // }}\n        popover={{\n          arrow: false,\n          constrainSize: true,\n          placement: 'right-start',\n          fallbackPlacements: [\n            'left-start',\n            'right',\n            'left',\n            'right-end',\n            'left-end',\n            'bottom',\n            'top',\n          ],\n          preventOverflow: true,\n          __unstable_margins: POPOVER_MARGINS,\n        }}\n        space={2}\n        text={node.label}\n      >\n        {node.items.map((item, itemIndex) => (\n          <ContextMenuItem\n            key={itemIndex}\n            node={item}\n            onDismiss={onDismiss}\n            boundaryElement={boundaryElement}\n          />\n        ))}\n      </MenuGroup>\n    )\n  }\n\n  if (node.type === 'custom') {\n    const {component: Component} = node\n    return <Component boundaryElement={boundaryElement} />\n  }\n\n  return null\n}\n\nexport const ContextMenu: FunctionComponent<ContextMenuProps> = (props) => {\n  const {\n    node,\n    onDismiss,\n    position: {x, y},\n  } = props\n\n  const [boundaryElement, setBoundaryElement] = useState<HTMLDivElement | null>(null)\n\n  const {getField} = useSchema()\n  const {getDocument} = useDocuments()\n\n  const {field, parent} = getField(node)\n\n  const title = useMemo(() => {\n    return field?.title || field?.name || 'Unknown type'\n  }, [field])\n\n  const [items, setItems] = useState<ContextMenuNode[] | undefined>(undefined)\n\n  useEffect(() => {\n    const fetchContextMenuItems = async () => {\n      const doc = getDocument(node.id)\n      if (!doc) return\n      const items = await getContextMenuItems({node, field, parent, doc})\n      setItems(items)\n    }\n    fetchContextMenuItems()\n  }, [field, node, parent, getDocument])\n\n  const contextMenuReferenceElement = useMemo(() => {\n    return {\n      getBoundingClientRect: () => ({\n        bottom: y,\n        left: x,\n        right: x,\n        top: y,\n        width: 0,\n        height: 0,\n      }),\n    } as HTMLElement\n  }, [x, y])\n\n  const icon = useMemo(() => {\n    return getNodeIcon(field)\n  }, [field])\n\n  return (\n    <PopoverPortal setBoundaryElement={setBoundaryElement} onDismiss={onDismiss}>\n      <Popover\n        __unstable_margins={POPOVER_MARGINS}\n        arrow={false}\n        open\n        placement=\"right-start\"\n        referenceElement={contextMenuReferenceElement}\n        content={\n          <Menu style={{minWidth: 120, maxWidth: 160}}>\n            <Flex gap={2} padding={2}>\n              <Box flex=\"none\">{items ? <Text size={1}>{icon}</Text> : <Spinner size={1} />}</Box>\n\n              <Stack flex={1} space={2}>\n                <Text size={1} weight=\"semibold\">\n                  {items ? title : 'Loading...'}\n                </Text>\n              </Stack>\n            </Flex>\n\n            {items && (\n              <>\n                <MenuDivider />\n                {items.map((item, i) => (\n                  <ContextMenuItem\n                    key={i}\n                    node={item}\n                    onDismiss={onDismiss}\n                    boundaryElement={boundaryElement}\n                  />\n                ))}\n              </>\n            )}\n          </Menu>\n        }\n      >\n        <div\n          key={`${x}-${y}`}\n          style={{\n            position: 'absolute',\n            left: x,\n            top: y,\n          }}\n        />\n      </Popover>\n    </PopoverPortal>\n  )\n}\n","import type {PreviewSnapshot} from '@repo/visual-editing-helpers'\nimport {createContext} from 'react'\n\nexport type PreviewSnapshotsContextValue = PreviewSnapshot[]\n\nexport const PreviewSnapshotsContext = createContext<PreviewSnapshotsContextValue | null>(null)\n","import {pathToUrlString} from '@repo/visual-editing-helpers'\nimport {createEditUrl, studioPath} from '@sanity/client/csm'\nimport {DocumentIcon, DragHandleIcon} from '@sanity/icons'\nimport {Box, Card, Flex, Text} from '@sanity/ui'\nimport {\n  isValidElement,\n  memo,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useSyncExternalStore,\n  type CSSProperties,\n  type FunctionComponent,\n  type ReactElement,\n} from 'react'\nimport scrollIntoView from 'scroll-into-view-if-needed'\nimport {styled} from 'styled-components'\nimport {PointerEvents} from '../overlay-components/components/PointerEvents'\nimport type {\n  ElementFocusedState,\n  ElementNode,\n  OverlayComponent,\n  OverlayComponentResolver,\n  OverlayComponentResolverContext,\n  OverlayRect,\n  SanityNode,\n  SanityStegaNode,\n} from '../types'\nimport {usePreviewSnapshots} from './preview/usePreviewSnapshots'\nimport {useSchema} from './schema/useSchema'\n\nconst isReactElementOverlayComponent = (\n  component:\n    | OverlayComponent\n    | {component: OverlayComponent; props?: Record<string, unknown>}\n    | Array<OverlayComponent | {component: OverlayComponent; props?: Record<string, unknown>}>\n    | ReactElement,\n): component is ReactElement => {\n  return isValidElement(component)\n}\n\nexport interface ElementOverlayProps {\n  componentResolver?: OverlayComponentResolver\n  draggable: boolean\n  element: ElementNode\n  focused: ElementFocusedState\n  hovered: boolean\n  isDragging: boolean\n  node: SanityNode | SanityStegaNode\n  rect: OverlayRect\n  showActions: boolean\n  wasMaybeCollapsed: boolean\n  enableScrollIntoView: boolean\n}\n\nconst Root = styled(Card)`\n  background-color: var(--overlay-bg);\n  border-radius: 3px;\n  pointer-events: none;\n  position: absolute;\n  will-change: transform;\n  box-shadow: var(--overlay-box-shadow);\n  transition: none;\n\n  --overlay-bg: transparent;\n  --overlay-box-shadow: inset 0 0 0 1px transparent;\n\n  [data-overlays] & {\n    --overlay-bg: color-mix(in srgb, transparent 95%, var(--card-focus-ring-color));\n    --overlay-box-shadow: inset 0 0 0 2px\n      color-mix(in srgb, transparent 50%, var(--card-focus-ring-color));\n  }\n\n  [data-fading-out] & {\n    transition:\n      box-shadow 1550ms,\n      background-color 1550ms;\n\n    --overlay-bg: rgba(0, 0, 255, 0);\n    --overlay-box-shadow: inset 0 0 0 1px transparent;\n  }\n\n  &[data-focused] {\n    --overlay-box-shadow: inset 0 0 0 1px var(--card-focus-ring-color);\n  }\n\n  &[data-hovered]:not([data-focused]) {\n    transition: none;\n    --overlay-box-shadow: inset 0 0 0 2px var(--card-focus-ring-color);\n  }\n\n  /* [data-unmounted] & {\n    --overlay-box-shadow: inset 0 0 0 1px var(--card-focus-ring-color);\n  } */\n\n  :link {\n    text-decoration: none;\n  }\n`\n\nconst Actions = styled(Flex)`\n  bottom: 100%;\n  cursor: pointer;\n  pointer-events: none;\n  position: absolute;\n  right: 0;\n\n  [data-hovered] & {\n    pointer-events: all;\n  }\n`\n\nconst ActionOpen = styled(Card)`\n  background-color: var(--card-focus-ring-color);\n  right: 0;\n  border-radius: 3px;\n\n  & [data-ui='Text'] {\n    color: #fff;\n    white-space: nowrap;\n  }\n`\n\nconst Tab = styled(Flex)`\n  bottom: 100%;\n  cursor: pointer;\n  pointer-events: none;\n  position: absolute;\n  left: 0;\n`\n\nconst Labels = styled(Flex)`\n  display: flex;\n  align-items: center;\n  background-color: var(--card-focus-ring-color);\n  right: 0;\n  border-radius: 3px;\n  & [data-ui='Text'],\n  & [data-sanity-icon] {\n    color: #fff;\n    white-space: nowrap;\n  }\n`\n\nfunction createIntentLink(node: SanityNode) {\n  const {id, type, path, baseUrl, tool, workspace} = node\n\n  return createEditUrl({\n    baseUrl,\n    workspace,\n    tool,\n    type: type!,\n    id,\n    path: pathToUrlString(studioPath.fromString(path)),\n  })\n}\n\nconst ElementOverlayInner: FunctionComponent<ElementOverlayProps> = (props) => {\n  const {element, focused, componentResolver, node, showActions, draggable} = props\n\n  const {getField, getType} = useSchema()\n  const schemaType = getType(node)\n  const {field, parent} = getField(node)\n\n  const href = 'path' in node ? createIntentLink(node) : node.href\n\n  const previewSnapshots = usePreviewSnapshots()\n\n  const title = useMemo(() => {\n    if (!('path' in node)) return undefined\n    return previewSnapshots.find((snapshot) => snapshot._id === node.id)?.title\n  }, [node, previewSnapshots])\n\n  const componentContext = useMemo<OverlayComponentResolverContext | undefined>(() => {\n    if (!('path' in node)) return undefined\n    if (!field || !schemaType) return undefined\n    const type = field.value.type\n\n    return {\n      document: schemaType,\n      element,\n      field,\n      focused: !!focused,\n      node,\n      parent,\n      type,\n    }\n  }, [schemaType, element, field, focused, node, parent])\n\n  const customComponents = useCustomComponents(componentContext, componentResolver)\n\n  const icon = schemaType?.icon ? (\n    <div dangerouslySetInnerHTML={{__html: schemaType.icon}} />\n  ) : (\n    <DocumentIcon />\n  )\n\n  return (\n    <>\n      {showActions ? (\n        <Actions gap={1} paddingBottom={1} data-sanity-overlay-element>\n          <Link href={href} />\n        </Actions>\n      ) : null}\n\n      {title && (\n        <Tab gap={1} paddingBottom={1}>\n          <Labels gap={2} padding={2}>\n            {draggable && (\n              <Box marginRight={1}>\n                <Text className=\"drag-handle\" size={0}>\n                  <DragHandleIcon />\n                </Text>\n              </Box>\n            )}\n            <Text size={0}>{icon}</Text>\n            <Text size={1} weight=\"medium\">\n              {title}\n            </Text>\n          </Labels>\n        </Tab>\n      )}\n\n      {Array.isArray(customComponents)\n        ? customComponents.map(({component: Component, props}, i) => {\n            return (\n              <Component key={i} PointerEvents={PointerEvents} {...componentContext!} {...props} />\n            )\n          })\n        : customComponents}\n    </>\n  )\n}\n\nexport const ElementOverlay = memo(function ElementOverlay(props: ElementOverlayProps) {\n  const {focused, hovered, rect, wasMaybeCollapsed, enableScrollIntoView} = props\n\n  const ref = useRef<HTMLDivElement>(null)\n\n  const scrolledIntoViewRef = useRef(false)\n\n  const style = useMemo<CSSProperties>(\n    () => ({\n      width: `${rect.w}px`,\n      height: `${rect.h}px`,\n      transform: `translate(${rect.x}px, ${rect.y}px)`,\n    }),\n    [rect],\n  )\n\n  useEffect(() => {\n    if (\n      !scrolledIntoViewRef.current &&\n      !wasMaybeCollapsed &&\n      focused === true &&\n      ref.current &&\n      enableScrollIntoView\n    ) {\n      const target = ref.current\n      scrollIntoView(ref.current, {\n        // Workaround issue with scroll-into-view-if-needed struggling with iframes\n        behavior: (actions) => {\n          if (actions.length === 0) {\n            // An empty actions list equals scrolling isn't needed\n            return\n          }\n          // Uses native scrollIntoView to ensure iframes behave correctly\n          target.scrollIntoView({\n            behavior: 'smooth',\n            block: 'center',\n            inline: 'nearest',\n          })\n        },\n        scrollMode: 'if-needed',\n        block: 'center',\n        inline: 'nearest',\n      })\n    }\n\n    scrolledIntoViewRef.current = focused === true\n  }, [focused, wasMaybeCollapsed, enableScrollIntoView])\n\n  return (\n    <Root\n      data-focused={focused ? '' : undefined}\n      data-hovered={hovered ? '' : undefined}\n      ref={ref}\n      style={style}\n    >\n      {hovered && <ElementOverlayInner {...props} />}\n    </Root>\n  )\n})\n\nfunction useCustomComponents(\n  componentContext: OverlayComponentResolverContext | undefined,\n  componentResolver: OverlayComponentResolver | undefined,\n) {\n  return useMemo(() => {\n    if (!componentContext) return undefined\n    const resolved = componentResolver?.(componentContext)\n    if (!resolved) return undefined\n\n    if (isReactElementOverlayComponent(resolved)) {\n      return resolved\n    }\n\n    return (Array.isArray(resolved) ? resolved : [resolved]).map((component) => {\n      if (typeof component === 'object' && 'component' in component) {\n        return component\n      }\n      return {component, props: {}}\n    })\n  }, [componentResolver, componentContext])\n}\n\nconst Link = memo(function Link(props: {href: string}) {\n  const referer = useSyncExternalStore(\n    useCallback((onStoreChange) => {\n      const handlePopState = () => onStoreChange()\n      window.addEventListener('popstate', handlePopState)\n      return () => window.removeEventListener('popstate', handlePopState)\n    }, []),\n    () => window.location.href,\n  )\n  const href = useLinkHref(props.href, referer)\n\n  return (\n    <Box as=\"a\" href={href} target=\"_blank\" rel=\"noopener noreferrer\">\n      <ActionOpen padding={2}>\n        <Text size={1} weight=\"medium\">\n          Open in Studio\n        </Text>\n      </ActionOpen>\n    </Box>\n  )\n})\n\nfunction useLinkHref(href: string, referer: string) {\n  return useMemo(() => {\n    try {\n      const parsed = new URL(href, typeof location === 'undefined' ? undefined : location.origin)\n      parsed.searchParams.set('preview', referer)\n      return parsed.toString()\n    } catch {\n      return href\n    }\n  }, [href, referer])\n}\n","import {useContext} from 'react'\nimport {PreviewSnapshotsContext, type PreviewSnapshotsContextValue} from './PreviewSnapshotsContext'\n\nexport function usePreviewSnapshots(): PreviewSnapshotsContextValue {\n  const context = useContext(PreviewSnapshotsContext)\n\n  if (!context) {\n    throw new Error('Preview Snapshots context is missing')\n  }\n\n  return context\n}\n","import type {FunctionComponent} from 'react'\nimport type {OverlayRect} from '../types'\n\nexport const OverlayDragGroupRect: FunctionComponent<{\n  dragGroupRect: OverlayRect\n}> = ({dragGroupRect}) => {\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        top: `${dragGroupRect.y}px`,\n        left: `${dragGroupRect.x}px`,\n        width: `${dragGroupRect.w - 1}px`,\n        height: `${dragGroupRect.h - 1}px`,\n        border: '1px dashed #f0709b',\n        pointerEvents: 'none',\n      }}\n    ></div>\n  )\n}\n","import type {FunctionComponent} from 'react'\nimport type {DragInsertPosition} from '../types'\n\nconst markerThickness = 6\n\nfunction lerp(v0: number, v1: number, t: number) {\n  return v0 * (1 - t) + v1 * t\n}\n\nexport const OverlayDragInsertMarker: FunctionComponent<{\n  dragInsertPosition: DragInsertPosition\n}> = ({dragInsertPosition}) => {\n  if (dragInsertPosition === null) return\n\n  const flow = dragInsertPosition?.left || dragInsertPosition?.right ? 'horizontal' : 'vertical'\n\n  let x = 0\n  let y = 0\n  let width = 0\n  let height = 0\n  const offsetMultiplier = 0.0125\n\n  if (flow === 'horizontal') {\n    const {left, right} = dragInsertPosition\n\n    width = markerThickness\n\n    if (right && left) {\n      const startX = left.rect.x + left.rect.w\n      const endX = right.rect.x\n      const targetHeight = Math.min(right.rect.h, left.rect.h)\n      const offset = targetHeight * offsetMultiplier\n\n      x = lerp(startX, endX, 0.5) - markerThickness / 2\n      y = left.rect.y + offset\n\n      height = Math.min(right.rect.h, left.rect.h) - offset * 2\n    } else if (right && !left) {\n      const targetHeight = right.rect.h\n      const offset = targetHeight * offsetMultiplier\n\n      x = right.rect.x - markerThickness / 2\n      y = right.rect.y + offset\n      height = right.rect.h - offset * 2\n    } else if (left && !right) {\n      const targetHeight = left.rect.h\n      const offset = targetHeight * offsetMultiplier\n\n      x = left.rect.x + left.rect.w - markerThickness / 2\n      y = left.rect.y + offset\n      height = left.rect.h - offset * 2\n    }\n  } else {\n    const {bottom, top} = dragInsertPosition\n\n    if (bottom && top) {\n      const startX = Math.min(top.rect.x, bottom.rect.x)\n      const startY = top.rect.y + top.rect.h\n      const endY = bottom.rect.y\n      const targetWidth = Math.min(bottom.rect.w, top.rect.w)\n      const offset = targetWidth * offsetMultiplier\n\n      height = markerThickness\n\n      x = startX + offset\n      y = lerp(startY, endY, 0.5) - markerThickness / 2\n      width = Math.max(bottom.rect.w, top.rect.w) - offset * 2\n    } else if (bottom && !top) {\n      const targetWidth = bottom.rect.w\n      const offset = targetWidth * offsetMultiplier\n\n      x = bottom.rect.x + offset\n      y = bottom.rect.y - markerThickness / 2\n      width = bottom.rect.w - offset * 2\n      height = markerThickness\n    } else if (top && !bottom) {\n      const targetWidth = top.rect.w\n      const offset = targetWidth * offsetMultiplier\n\n      x = top.rect.x + offset\n      y = top.rect.y + top.rect.h - markerThickness / 2\n      width = top.rect.w - offset * 2\n      height = markerThickness\n    }\n  }\n\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        width: `${width}px`,\n        height: `${height}px`,\n        transform: `translate(${x}px, ${y}px)`,\n        background: '#556bfc',\n        border: '2px solid white',\n        borderRadius: '999px',\n        zIndex: '999999',\n      }}\n    ></div>\n  )\n}\n","import {Card, usePrefersDark, useTheme_v2} from '@sanity/ui'\nimport type {FunctionComponent} from 'react'\nimport {styled} from 'styled-components'\nimport type {DragSkeleton} from '../types'\n\nconst Root = styled.div<{\n  $width: number\n  $height: number\n  $offsetX: number\n  $offsetY: number\n  $scaleFactor: number\n}>`\n  --drag-preview-opacity: 0.98;\n  --drag-preview-skeleton-stroke: #ffffff;\n\n  @media (prefers-color-scheme: dark) {\n    --drag-preview-skeleton-stroke: #383d51;\n  }\n\n  position: fixed;\n  display: grid;\n  transform: ${({$scaleFactor, $width, $height}) =>\n    `translate(calc(var(--drag-preview-x) - ${$width / 2}px), calc(var(--drag-preview-y) - ${$height / 2}px)) scale(${$scaleFactor})`};\n  width: ${({$width}) => `${$width}px`};\n  height: ${({$height}) => `${$height}px`};\n  z-index: 9999999;\n  opacity: var(--drag-preview-opacity);\n  cursor: move;\n\n  .drag-preview-content-wrapper {\n    position: relative;\n    width: 100%;\n    height: 100%;\n    container-type: inline-size;\n  }\n\n  [data-ui='card'] {\n    position: relative;\n    width: 100%;\n    height: 100%;\n  }\n\n  .drag-preview-skeleton {\n    position: absolute;\n    inset: 0;\n\n    rect {\n      stroke: var(--drag-preview-skeleton-stroke);\n    }\n  }\n\n  .drag-preview-handle {\n    position: absolute;\n    top: 4cqmin;\n    left: 4cqmin;\n    width: 6cqmin;\n    fill: var(--drag-preview-handle-fill);\n  }\n`\n\nfunction clamp(number: number, min: number, max: number): number {\n  return number < min ? min : number > max ? max : number\n}\n\nfunction map(number: number, inMin: number, inMax: number, outMin: number, outMax: number): number {\n  const mapped: number = ((number - inMin) * (outMax - outMin)) / (inMax - inMin) + outMin\n  return clamp(mapped, outMin, outMax)\n}\n\nexport const OverlayDragPreview: FunctionComponent<{skeleton: DragSkeleton}> = ({skeleton}) => {\n  const maxSkeletonWidth = Math.min(skeleton.maxWidth, window.innerWidth / 2)\n  const scaleFactor = skeleton.w > maxSkeletonWidth ? maxSkeletonWidth / skeleton.w : 1\n\n  const offsetX = skeleton.offsetX * scaleFactor\n  const offsetY = skeleton.offsetY * scaleFactor\n\n  const prefersDark = usePrefersDark()\n  const theme = useTheme_v2()\n\n  const radius = theme.radius[~~map(skeleton.w, 0, 1920, 1, theme.radius.length - 2)]\n\n  const imageRects = skeleton.childRects.filter((r) => r.tagName === 'IMG')\n  const textRects = skeleton.childRects.filter((r) => r.tagName !== 'IMG')\n\n  return (\n    <Root\n      $width={skeleton.w}\n      $height={skeleton.h}\n      $offsetX={offsetX}\n      $offsetY={offsetY}\n      $scaleFactor={scaleFactor}\n    >\n      <Card\n        radius={radius}\n        shadow={4}\n        overflow=\"hidden\"\n        tone=\"transparent\"\n        scheme={prefersDark ? 'dark' : 'light'}\n      >\n        <div className=\"drag-preview-content-wrapper\">\n          <svg className=\"drag-preview-skeleton\" viewBox={`0 0 ${skeleton.w} ${skeleton.h}`}>\n            {/* render image rects first to account for background images overlapping text */}\n            {[...imageRects, ...textRects].map((r, i) => (\n              <rect\n                key={i}\n                x={r.x}\n                y={r.y}\n                width={r.w}\n                height={r.h}\n                fill={theme.color.skeleton.from}\n              ></rect>\n            ))}\n          </svg>\n        </div>\n      </Card>\n    </Root>\n  )\n}\n","import {ExpandIcon} from '@sanity/icons'\nimport {Card, Flex, Hotkeys, Text} from '@sanity/ui'\nimport type {FunctionComponent} from 'react'\nimport {styled} from 'styled-components'\n\nconst Root = styled(Card)`\n  position: fixed;\n  bottom: 2rem;\n  left: 2rem;\n`\n\nexport const OverlayMinimapPrompt: FunctionComponent = () => {\n  return (\n    <Root padding={2} shadow={2} radius={2} style={{zIndex: '999999'}}>\n      <Flex align=\"center\" gap={2}>\n        <Hotkeys keys={['Shift']} />\n        <Text size={1}>Zoom Out</Text>\n        <ExpandIcon />\n      </Flex>\n    </Root>\n  )\n}\n","import type {VisualEditingControllerMsg} from '@repo/visual-editing-helpers'\nimport type {ElementState, OverlayMsg} from '../types'\n\n/**\n * Reducer for managing element state from received channel messages\n * @internal\n */\nexport const elementsReducer = (\n  elements: ElementState[],\n  message: OverlayMsg | VisualEditingControllerMsg,\n): ElementState[] => {\n  const {type} = message\n  switch (type) {\n    case 'element/register': {\n      const elementExists = !!elements.find((e) => e.id === message.id)\n      if (elementExists) return elements\n\n      return [\n        ...elements,\n        {\n          id: message.id,\n          activated: false,\n          element: message.element,\n          focused: false,\n          hovered: false,\n          rect: message.rect,\n          sanity: message.sanity,\n          dragDisabled: message.dragDisabled,\n        },\n      ]\n    }\n    case 'element/activate':\n      return elements.map((e) => {\n        if (e.id === message.id) {\n          return {...e, activated: true}\n        }\n        return e\n      })\n    case 'element/update': {\n      return elements.map((e) => {\n        if (e.id === message.id) {\n          return {...e, sanity: message.sanity, rect: message.rect}\n        }\n        return e\n      })\n    }\n    case 'element/unregister':\n      return elements.filter((e) => e.id !== message.id)\n    case 'element/deactivate':\n      return elements.map((e) => {\n        if (e.id === message.id) {\n          return {...e, activated: false, hovered: false}\n        }\n        return e\n      })\n    case 'element/mouseenter':\n      return elements.map((e) => {\n        if (e.id === message.id) {\n          return {...e, rect: message.rect, hovered: true}\n        }\n        return {...e, hovered: false}\n      })\n    case 'element/mouseleave':\n      return elements.map((element) => {\n        if (element.id === message.id) {\n          return {...element, hovered: false}\n        }\n        return element\n      })\n    case 'element/updateRect':\n      return elements.map((element) => {\n        if (element.id === message.id) {\n          return {...element, rect: message.rect}\n        }\n        return element\n      })\n    case 'element/click':\n      return elements.map((e) => {\n        return {...e, focused: e.id === message.id && 'clicked'}\n      })\n    case 'overlay/blur':\n      return elements.map((e) => {\n        return {...e, focused: false}\n      })\n    case 'presentation/blur':\n      return elements.map((e) => {\n        return {...e, focused: false}\n      })\n    case 'presentation/focus': {\n      // Before setting the focus state of each element, check to see if any\n      // element has gained focus from an `element/click` message. Presentation\n      // tool \"reflects\" these back as a `presentation/focus` message.\n      const clickedElement = elements.find((e) => e.focused === 'clicked')\n      return elements.map((e) => {\n        // We want to focus any element which matches the received id and path\n        const focused =\n          'path' in e.sanity &&\n          e.sanity.id === message.data.id &&\n          e.sanity.path === message.data.path\n\n        // If we have a 'clicked' element, and that element matches, it is a\n        // reflection, so we maintain the focus state\n        if (clickedElement && e === clickedElement && focused) {\n          return e\n        }\n\n        return {\n          ...e,\n          // Mark as a dupe if another matching item has been clicked to prevent\n          // scrolling, otherwise just set focus as a boolean\n          focused: focused && clickedElement ? 'duplicate' : focused,\n        }\n      })\n    }\n    default:\n      return elements\n  }\n}\n","import type {SanityNode, VisualEditingControllerMsg} from '@repo/visual-editing-helpers'\nimport type {ClientPerspective} from '@sanity/client'\nimport type {\n  DragInsertPosition,\n  DragSkeleton,\n  ElementState,\n  OverlayMsg,\n  OverlayRect,\n} from '../types'\nimport {elementsReducer} from './elementsReducer'\n\nexport interface OverlayState {\n  contextMenu: {\n    node: SanityNode\n    position: {\n      x: number\n      y: number\n    }\n  } | null\n  focusPath: string\n  elements: ElementState[]\n  wasMaybeCollapsed: boolean\n  perspective: ClientPerspective\n  isDragging: boolean\n  dragInsertPosition: DragInsertPosition\n  dragSkeleton: DragSkeleton | null\n  dragShowMinimap: boolean\n  dragShowMinimapPrompt: boolean\n  dragMinimapTransition: boolean\n  dragGroupRect: OverlayRect | null\n}\n\nexport function overlayStateReducer(\n  state: OverlayState,\n  message: OverlayMsg | VisualEditingControllerMsg,\n): OverlayState {\n  const {type} = message\n  let {\n    contextMenu,\n    focusPath,\n    perspective,\n    isDragging,\n    dragInsertPosition,\n    dragShowMinimap,\n    dragShowMinimapPrompt,\n    dragSkeleton,\n    dragMinimapTransition,\n    dragGroupRect,\n  } = state\n  let wasMaybeCollapsed = false\n\n  if (type === 'presentation/focus') {\n    const prevFocusPath = state.focusPath\n\n    focusPath = message.data.path\n\n    if (prevFocusPath !== focusPath) {\n      wasMaybeCollapsed = prevFocusPath.slice(focusPath.length).startsWith('[')\n    }\n  }\n\n  if (type === 'presentation/perspective') {\n    perspective = message.data.perspective\n  }\n\n  if (type === 'element/contextmenu') {\n    if ('sanity' in message) {\n      contextMenu = {node: message.sanity, position: message.position}\n    } else {\n      contextMenu = null\n    }\n  }\n\n  if (\n    type === 'element/click' ||\n    type === 'element/mouseleave' ||\n    type === 'overlay/blur' ||\n    type === 'presentation/blur' ||\n    type === 'presentation/focus'\n  ) {\n    contextMenu = null\n  }\n\n  if (type === 'overlay/dragUpdateInsertPosition') {\n    dragInsertPosition = message.insertPosition\n  }\n\n  if (type === 'overlay/dragStart') {\n    isDragging = true\n  }\n\n  if (message.type === 'overlay/dragUpdateSkeleton') {\n    dragSkeleton = message.skeleton\n  }\n\n  if (type === 'overlay/dragEnd') {\n    isDragging = false\n  }\n\n  if (message.type === 'overlay/dragToggleMinimapPrompt') {\n    dragShowMinimapPrompt = message.display\n  }\n\n  if (type === 'overlay/dragStartMinimapTransition') {\n    dragMinimapTransition = true\n  }\n\n  if (type === 'overlay/dragEndMinimapTransition') {\n    dragMinimapTransition = false\n  }\n\n  if (type === 'overlay/dragUpdateGroupRect') {\n    dragGroupRect = message.groupRect\n  }\n\n  if (type === 'overlay/dragToggleMinimap') {\n    dragShowMinimap = message.display\n  }\n\n  return {\n    ...state,\n    contextMenu,\n    elements: elementsReducer(state.elements, message),\n    dragInsertPosition,\n    dragSkeleton,\n    dragGroupRect,\n    isDragging,\n    focusPath,\n    perspective,\n    wasMaybeCollapsed,\n    dragShowMinimap,\n    dragShowMinimapPrompt,\n    dragMinimapTransition,\n  }\n}\n","import {useEffect, useMemo, useState, type FunctionComponent, type PropsWithChildren} from 'react'\nimport type {VisualEditingNode} from '../../types'\nimport {PreviewSnapshotsContext, type PreviewSnapshotsContextValue} from './PreviewSnapshotsContext'\n\nexport const PreviewSnapshotsProvider: FunctionComponent<\n  PropsWithChildren<{\n    comlink?: VisualEditingNode\n  }>\n> = function (props) {\n  const {comlink, children} = props\n\n  const [previewSnapshots, setPreviewSnapshots] = useState<PreviewSnapshotsContextValue>([])\n\n  useEffect(() => {\n    return comlink?.on('presentation/preview-snapshots', (data) => {\n      setPreviewSnapshots(data.snapshots)\n    })\n  }, [comlink])\n\n  const context = useMemo<PreviewSnapshotsContextValue>(() => previewSnapshots, [previewSnapshots])\n  return (\n    <PreviewSnapshotsContext.Provider value={context}>{children}</PreviewSnapshotsContext.Provider>\n  )\n}\n","import type {\n  DocumentSchema,\n  ResolvedSchemaTypeMap,\n  SanityNode,\n  SanityStegaNode,\n  SchemaType,\n  TypeSchema,\n  UnresolvedPath,\n} from '@repo/visual-editing-helpers'\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  type FunctionComponent,\n  type PropsWithChildren,\n} from 'react'\nimport type {\n  ElementState,\n  OverlayElementField,\n  OverlayElementParent,\n  VisualEditingNode,\n} from '../../types'\nimport {SchemaContext, type SchemaContextValue} from './SchemaContext'\n\nfunction isSanityNode(node: SanityNode | SanityStegaNode): node is SanityNode {\n  return 'path' in node\n}\n\nfunction isDocumentSchemaType(type: SchemaType): type is DocumentSchema {\n  return type.type === 'document'\n}\n\nfunction isTypeSchemaType(type: SchemaType): type is TypeSchema {\n  return type.type === 'type'\n}\n\nfunction popUnkeyedPathSegments(path: string): string {\n  return path\n    .split('.')\n    .toReversed()\n    .reduce((acc, part) => {\n      if (acc.length) return [part, ...acc]\n      if (part.includes('[_key==')) return [part]\n      return []\n    }, [] as string[])\n    .join('.')\n}\n\nfunction getPathsWithUnresolvedTypes(elements: ElementState[]): {id: string; path: string}[] {\n  return elements.reduce((acc, element) => {\n    const {sanity} = element\n    if (!('id' in sanity)) return acc\n    if (!sanity.path.includes('[_key==')) return acc\n    const path = popUnkeyedPathSegments(sanity.path)\n    if (!acc.find((item) => item.id === sanity.id && item.path === path)) {\n      acc.push({id: sanity.id, path})\n    }\n    return acc\n  }, [] as UnresolvedPath[])\n}\n\nexport const SchemaProvider: FunctionComponent<\n  PropsWithChildren<{\n    comlink?: VisualEditingNode\n    elements: ElementState[]\n  }>\n> = function (props) {\n  const {comlink, children, elements} = props\n\n  const [resolvedTypes, setResolvedTypes] = useState<ResolvedSchemaTypeMap>(new Map())\n\n  const [schema, setSchema] = useState<SchemaType[] | null>(null)\n\n  const fetchSchema = useCallback(\n    async (signal: AbortSignal) => {\n      if (!comlink) return\n      try {\n        const response = await comlink.fetch('visual-editing/schema', undefined, {\n          signal,\n          suppressWarnings: true,\n        })\n        setSchema(response.schema)\n      } catch (e) {\n        // Fail silently as the app may be communicating with a version of\n        // Presentation that does not support this feature\n      }\n    },\n    [comlink],\n  )\n  useEffect(() => {\n    const controller = new AbortController()\n    fetchSchema(controller.signal)\n    return () => controller.abort()\n  }, [fetchSchema])\n\n  const reportedPathsRef = useRef<UnresolvedPath[]>([])\n\n  useEffect(() => {\n    // We report a list of paths that reference array items using a _key. We need\n    // to resolve the types of each of these items so we can map them to the\n    // correct schema types. One day CSM might include this data for us.\n    const reportPaths = async (paths: UnresolvedPath[], signal: AbortSignal) => {\n      if (!paths.length || !comlink) return\n      try {\n        const response = await comlink.fetch(\n          'visual-editing/schema-union-types',\n          {paths},\n          {signal, suppressWarnings: true},\n        )\n        setResolvedTypes(response.types)\n        reportedPathsRef.current = paths\n      } catch (e) {\n        // Fail silently as the app may be communicating with a version of\n        // Presentation that does not support this feature\n      }\n    }\n\n    const controller = new AbortController()\n    const paths = getPathsWithUnresolvedTypes(elements)\n    if (\n      paths.some(\n        (p) => !reportedPathsRef.current.find(({id, path}) => id === p.id && path === p.path),\n      )\n    ) {\n      reportPaths(paths, controller.signal)\n    }\n    return () => controller.abort()\n  }, [comlink, elements])\n\n  const getType = useCallback(\n    <T extends 'document' | 'type' = 'document'>(\n      node: SanityNode | SanityStegaNode | string,\n      _type?: T,\n    ): T extends 'document' ? DocumentSchema | undefined : TypeSchema | undefined => {\n      const type = _type || 'document'\n      if (\n        !schema ||\n        (typeof node !== 'string' && (!isSanityNode(node) || !Array.isArray(schema)))\n      ) {\n        return undefined\n      }\n      const name = typeof node === 'string' ? node : node.type\n      const filter = type === 'document' ? isDocumentSchemaType : isTypeSchemaType\n      return schema\n        .filter(filter)\n        .find((schemaType) => schemaType.name === name) as T extends 'document'\n        ? DocumentSchema | undefined\n        : TypeSchema | undefined\n    },\n    [schema],\n  )\n\n  const getField = useCallback(\n    (\n      node: SanityNode | SanityStegaNode,\n    ): {\n      field: OverlayElementField\n      parent: OverlayElementParent\n    } => {\n      if (!isSanityNode(node)) {\n        return {\n          field: undefined,\n          parent: undefined,\n        }\n      }\n\n      const schemaType = getType(node)\n\n      if (!schemaType) {\n        return {\n          field: undefined,\n          parent: undefined,\n        }\n      }\n      function fieldFromPath(\n        schemaType: OverlayElementParent,\n        path: string[],\n        parent: OverlayElementParent,\n        prevPath: string[] = [],\n      ): {\n        field: OverlayElementField\n        parent: OverlayElementParent\n      } {\n        if (!schemaType) {\n          return {field: undefined, parent: undefined}\n        }\n\n        const [next, ...rest] = path\n\n        if ('fields' in schemaType) {\n          const objectField = schemaType.fields[next]\n          if (!objectField && 'rest' in schemaType) {\n            return fieldFromPath(schemaType.rest, path, schemaType, prevPath)\n          }\n          if (!rest.length) {\n            return {field: objectField, parent}\n          }\n          if (!objectField) {\n            throw new Error(\n              `[@sanity/visual-editing] No field could be resolved at path: \"${[...prevPath, ...path].join('.')}\"`,\n            )\n          }\n          return fieldFromPath(objectField.value, rest, schemaType, [...prevPath, next])\n        } else if (schemaType.type === 'array') {\n          return fieldFromPath(schemaType.of, path, schemaType, prevPath)\n        } else if (schemaType.type === 'arrayItem') {\n          if (!rest.length) return {field: schemaType, parent}\n          return fieldFromPath(schemaType.value, rest, schemaType, [...prevPath, next])\n        } else if (schemaType.type === 'union') {\n          const name = next.startsWith('[_key==')\n            ? resolvedTypes\n                ?.get((node as SanityNode).id)\n                ?.get([prevPath.join('.'), next].filter(Boolean).join(''))\n            : next\n          return fieldFromPath(\n            schemaType.of.find((item) => (item.type === 'unionOption' ? item.name === name : item)),\n            rest,\n            schemaType,\n            [...prevPath, next],\n          )\n        } else if (schemaType.type === 'unionOption') {\n          if (!next) return {field: schemaType, parent}\n          return fieldFromPath(schemaType.value, path, schemaType, prevPath)\n        } else if (schemaType.type === 'inline') {\n          const type = getType(schemaType.name, 'type')\n          return fieldFromPath((type as TypeSchema).value, path, schemaType, prevPath)\n        }\n        throw new Error(\n          `[@sanity/visual-editing] No field could be resolved at path: \"${[...prevPath, ...path].join('.')}\"`,\n        )\n      }\n\n      const nodePath = node.path.split('.').flatMap((part) => {\n        if (part.includes('[')) {\n          return part.split(/(\\[.+\\])/, 2)\n        }\n        return [part]\n      })\n\n      try {\n        return fieldFromPath(schemaType, nodePath, undefined)\n      } catch (e) {\n        // eslint-disable-next-line no-console\n        if (e instanceof Error) console.warn(e.message)\n        return {field: undefined, parent: undefined}\n      }\n    },\n    [getType, resolvedTypes],\n  )\n\n  const context = useMemo<SchemaContextValue>(\n    () => ({\n      getField,\n      getType,\n      resolvedTypes,\n      schema: schema || [],\n    }),\n    [getField, getType, resolvedTypes, schema],\n  )\n  return <SchemaContext.Provider value={context}>{children}</SchemaContext.Provider>\n}\n","import type {SerializableObject} from '@repo/visual-editing-helpers'\nimport {useEffect, useMemo, type FunctionComponent, type PropsWithChildren} from 'react'\nimport type {VisualEditingNode} from '../../types'\nimport {SharedStateContext} from './SharedStateContext'\n\nconst createStore = (initialState: SerializableObject) => {\n  let state = initialState\n  const getState = () => state\n  const listeners = new Set<() => void>()\n  const setState = (fn: (state: SerializableObject) => SerializableObject) => {\n    state = fn(state)\n    listeners.forEach((l) => l())\n  }\n  const subscribe = (listener: () => void) => {\n    listeners.add(listener)\n    return () => listeners.delete(listener)\n  }\n  return {getState, setState, subscribe}\n}\n\nconst store = createStore({})\n\nexport const SharedStateProvider: FunctionComponent<\n  PropsWithChildren<{\n    comlink?: VisualEditingNode\n  }>\n> = (props) => {\n  const {comlink, children} = props\n\n  useEffect(() => {\n    return comlink?.on('presentation/shared-state', (data) => {\n      if ('value' in data) {\n        store.setState((prev) => ({...prev, [data.key]: data.value}))\n      } else {\n        store.setState((prev) => {\n          return Object.fromEntries(Object.entries(prev).filter(([key]) => key !== data.key))\n        })\n      }\n    })\n  }, [comlink])\n\n  useEffect(() => {\n    async function fetch() {\n      const value = await comlink?.fetch('visual-editing/shared-state', undefined, {\n        suppressWarnings: true,\n      })\n      if (value) {\n        store.setState(() => value.state)\n      }\n    }\n    fetch().catch((reason) => {\n      // eslint-disable-next-line no-console\n      console.debug(reason)\n      // eslint-disable-next-line no-console\n      console.warn(\n        '[@sanity/visual-editing]: Failed to fetch shared state. Check your version of `@sanity/presentation` is up-to-date',\n      )\n    })\n  }, [comlink])\n\n  const value = useMemo(() => ({comlink, store}), [comlink])\n\n  return <SharedStateContext.Provider value={value}>{children}</SharedStateContext.Provider>\n}\n","import type {VisualEditingControllerMsg} from '@repo/visual-editing-helpers'\nimport {useEffect} from 'react'\nimport type {OverlayMsg, VisualEditingNode} from '../types'\n\nexport function usePerspectiveSync(\n  comlink: VisualEditingNode | undefined,\n  dispatch: (value: OverlayMsg | VisualEditingControllerMsg) => void,\n): void {\n  useEffect(() => {\n    const controller = new AbortController()\n    comlink\n      ?.fetch('visual-editing/fetch-perspective', undefined, {\n        signal: controller.signal,\n        suppressWarnings: true,\n      })\n      .then((data) => {\n        dispatch({type: 'presentation/perspective', data})\n      })\n      .catch(() => {\n        // Fail silently as the app may be communicating with a version of\n        // Presentation that does not support this feature\n      })\n\n    const unsub = comlink?.on('presentation/perspective', (data) => {\n      dispatch({type: 'presentation/perspective', data})\n    })\n\n    return () => {\n      unsub?.()\n      controller.abort()\n    }\n  }, [comlink, dispatch])\n}\n","import {DRAFTS_PREFIX} from '@repo/visual-editing-helpers/csm'\nimport type {ClientPerspective, ContentSourceMapDocuments} from '@sanity/client'\nimport {useCallback, useEffect, useRef} from 'react'\nimport type {ElementState, SanityNode, VisualEditingNode} from '../types'\n\nfunction isEqualSets(a: Set<string>, b: Set<string>) {\n  if (a === b) return true\n  if (a.size !== b.size) return false\n  for (const value of a) if (!b.has(value)) return false\n  return true\n}\n\n/**\n * Hook for reporting in use documents to Presentation\n * @internal\n */\nexport function useReportDocuments(\n  comlink: VisualEditingNode | undefined,\n  elements: ElementState[],\n  perspective: ClientPerspective,\n): void {\n  const lastReported = useRef<\n    | {\n        nodeIds: Set<string>\n        perspective: ClientPerspective\n      }\n    | undefined\n  >(undefined)\n\n  const reportDocuments = useCallback(\n    (documents: ContentSourceMapDocuments, perspective: ClientPerspective) => {\n      comlink?.post('visual-editing/documents', {\n        documents,\n        perspective,\n      })\n    },\n    [comlink],\n  )\n\n  useEffect(() => {\n    // Report only nodes of type `SanityNode`. Untransformed `SanityStegaNode`\n    // nodes without an `id`, are not reported as they will not contain the\n    // necessary document data.\n    const nodes = elements\n      .map((e) => {\n        const {sanity} = e\n        if (!('id' in sanity)) return null\n        return {\n          ...sanity,\n          id: 'isDraft' in sanity ? `${DRAFTS_PREFIX}${sanity.id}` : sanity.id,\n        }\n      })\n      .filter((s) => !!s) as SanityNode[]\n\n    const nodeIds = new Set<string>(nodes.map((e) => e.id))\n    // Report if:\n    // - Documents not yet reported\n    // - Document IDs changed\n    // - Perspective changed\n    if (\n      !lastReported.current ||\n      !isEqualSets(nodeIds, lastReported.current.nodeIds) ||\n      perspective !== lastReported.current.perspective\n    ) {\n      const documentsOnPage: ContentSourceMapDocuments = Array.from(nodeIds).map((_id) => {\n        const node = nodes.find((node) => node.id === _id)!\n        const {type, projectId: _projectId, dataset: _dataset} = node\n        return _projectId && _dataset\n          ? {_id, _type: type!, _projectId, _dataset}\n          : {_id, _type: type!}\n      })\n      lastReported.current = {nodeIds, perspective}\n      reportDocuments(documentsOnPage, perspective)\n    }\n  }, [elements, perspective, reportDocuments])\n}\n","import {isAltKey, isHotkey, type VisualEditingControllerMsg} from '@repo/visual-editing-helpers'\nimport type {ClientPerspective} from '@sanity/client'\nimport type {Status} from '@sanity/comlink'\nimport {\n  isHTMLAnchorElement,\n  isHTMLElement,\n  LayerProvider,\n  PortalProvider,\n  studioTheme,\n  ThemeProvider,\n  usePrefersDark,\n} from '@sanity/ui'\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n  useState,\n  type FunctionComponent,\n} from 'react'\nimport {styled} from 'styled-components'\nimport type {\n  OverlayComponentResolver,\n  OverlayEventHandler,\n  OverlayMsg,\n  VisualEditingNode,\n} from '../types'\nimport {getDraftId, getPublishedId} from '../util/documents'\nimport {sanityNodesExistInSameArray} from '../util/findSanityNodes.ts'\nimport {useDragEndEvents} from '../util/useDragEvents'\nimport {ContextMenu} from './context-menu/ContextMenu'\nimport {ElementOverlay} from './ElementOverlay'\nimport {useOptimisticActor, useOptimisticActorReady} from './optimistic-state/useOptimisticActor'\nimport {OverlayDragGroupRect} from './OverlayDragGroupRect'\nimport {OverlayDragInsertMarker} from './OverlayDragInsertMarker'\nimport {OverlayDragPreview} from './OverlayDragPreview'\nimport {OverlayMinimapPrompt} from './OverlayMinimapPrompt'\nimport {overlayStateReducer} from './overlayStateReducer'\nimport {PreviewSnapshotsProvider} from './preview/PreviewSnapshotsProvider'\nimport {SchemaProvider} from './schema/SchemaProvider'\nimport {SharedStateProvider} from './shared-state/SharedStateProvider.tsx'\nimport {useController} from './useController'\nimport {usePerspectiveSync} from './usePerspectiveSync'\nimport {useReportDocuments} from './useReportDocuments'\n\nconst Root = styled.div<{\n  $zIndex?: string | number\n}>`\n  background-color: transparent;\n  direction: ltr;\n  inset: 0;\n  pointer-events: none;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  z-index: ${({$zIndex}) => $zIndex ?? '9999999'};\n`\n\nfunction raf2(fn: () => void) {\n  let r0: number | undefined = undefined\n  let r1: number | undefined = undefined\n\n  r0 = requestAnimationFrame(() => {\n    r1 = requestAnimationFrame(fn)\n  })\n\n  return () => {\n    if (r0 !== undefined) cancelAnimationFrame(r0)\n    if (r1 !== undefined) cancelAnimationFrame(r1)\n  }\n}\n\nconst DocumentReporter: FunctionComponent<{\n  documentIds: string[]\n  perspective: ClientPerspective\n}> = (props) => {\n  const {documentIds} = props\n  const [uniqueIds, setUniqueIds] = useState<string[]>([])\n\n  useEffect(() => {\n    setUniqueIds((prev) => {\n      const next = Array.from(new Set(documentIds))\n      return prev.length === next.length &&\n        prev.reduce((acc, prevId) => acc.filter((id) => id !== prevId), next)?.length === 0\n        ? prev\n        : next\n    })\n  }, [documentIds])\n\n  const actor = useOptimisticActor()\n\n  useEffect(() => {\n    for (const id of uniqueIds) {\n      actor.send({type: 'observe', documentId: getDraftId(id)})\n      actor.send({type: 'observe', documentId: getPublishedId(id)})\n    }\n    return () => {\n      for (const id of uniqueIds) {\n        actor.send({type: 'unobserve', documentId: getDraftId(id)})\n        actor.send({type: 'unobserve', documentId: getPublishedId(id)})\n      }\n    }\n  }, [actor, uniqueIds])\n\n  return null\n}\n\nconst OverlaysController: FunctionComponent<{\n  comlink?: VisualEditingNode\n  dispatch: (value: OverlayMsg | VisualEditingControllerMsg) => void\n  inFrame: boolean\n  onDrag: (x: number, y: number) => void\n  overlayEnabled: boolean\n  rootElement: HTMLElement | null\n}> = (props) => {\n  const {comlink, dispatch, inFrame, onDrag, overlayEnabled, rootElement} = props\n  const {dispatchDragEndEvent} = useDragEndEvents()\n\n  const overlayEventHandler: OverlayEventHandler = useCallback(\n    (message) => {\n      if (message.type === 'element/click') {\n        const {sanity} = message\n        comlink?.post('visual-editing/focus', sanity)\n      } else if (message.type === 'overlay/activate') {\n        comlink?.post('visual-editing/toggle', {enabled: true})\n      } else if (message.type === 'overlay/deactivate') {\n        comlink?.post('visual-editing/toggle', {enabled: false})\n      } else if (message.type === 'overlay/dragEnd') {\n        const {insertPosition, target, dragGroup, flow, preventInsertDefault} = message\n        dispatchDragEndEvent({insertPosition, target, dragGroup, flow, preventInsertDefault})\n      } else if (message.type === 'overlay/dragUpdateCursorPosition') {\n        onDrag(message.x, message.y)\n\n        return\n      } else if (message.type === 'overlay/setCursor') {\n        const {element, cursor} = message\n\n        if (cursor) {\n          element.style.cursor = cursor\n        } else {\n          element.style.removeProperty('cursor')\n        }\n      }\n\n      dispatch(message)\n    },\n    [comlink, dispatch, dispatchDragEndEvent, onDrag],\n  )\n\n  const controller = useController(rootElement, overlayEventHandler, inFrame)\n\n  useEffect(() => {\n    if (overlayEnabled) {\n      controller.current?.activate()\n    } else {\n      controller.current?.deactivate()\n    }\n  }, [controller, overlayEnabled])\n\n  return null\n}\n\n/**\n * @internal\n */\nexport const Overlays: FunctionComponent<{\n  comlink?: VisualEditingNode\n  componentResolver?: OverlayComponentResolver\n  inFrame: boolean\n  zIndex?: string | number\n}> = (props) => {\n  const {comlink, componentResolver: _componentResolver, inFrame, zIndex} = props\n\n  const [status, setStatus] = useState<Status>()\n\n  const prefersDark = usePrefersDark()\n\n  const [\n    {\n      contextMenu,\n      dragInsertPosition,\n      dragShowMinimap,\n      dragShowMinimapPrompt,\n      dragSkeleton,\n      elements,\n      isDragging,\n      perspective,\n      wasMaybeCollapsed,\n      dragMinimapTransition,\n      dragGroupRect,\n    },\n    dispatch,\n  ] = useReducer(overlayStateReducer, {\n    contextMenu: null,\n    dragInsertPosition: null,\n    dragShowMinimap: false,\n    dragShowMinimapPrompt: false,\n    dragSkeleton: null,\n    elements: [],\n    focusPath: '',\n    isDragging: false,\n    perspective: 'published',\n    wasMaybeCollapsed: false,\n    dragMinimapTransition: false,\n    dragGroupRect: null,\n  })\n  const [rootElement, setRootElement] = useState<HTMLElement | null>(null)\n  const [overlayEnabled, setOverlayEnabled] = useState(true)\n\n  useEffect(() => {\n    const unsubs = [\n      comlink?.on('presentation/focus', (data) => {\n        dispatch({type: 'presentation/focus', data})\n      }),\n      comlink?.on('presentation/blur', (data) => {\n        dispatch({type: 'presentation/blur', data})\n      }),\n      comlink?.on('presentation/toggle-overlay', () => {\n        setOverlayEnabled((enabled) => !enabled)\n      }),\n      comlink?.onStatus((status) => {\n        setStatus(status as Status)\n      }),\n    ].filter(Boolean)\n\n    return () => unsubs.forEach((unsub) => unsub!())\n  }, [comlink])\n\n  usePerspectiveSync(comlink, dispatch)\n\n  useReportDocuments(comlink, elements, perspective)\n\n  const updateDragPreviewCustomProps = useCallback(\n    (x: number, y: number) => {\n      if (!rootElement) return\n\n      rootElement.style.setProperty('--drag-preview-x', `${x}px`)\n      rootElement.style.setProperty('--drag-preview-y', `${y - window.scrollY}px`)\n    },\n    [rootElement],\n  )\n\n  useEffect(() => {\n    const handleClick = (event: MouseEvent) => {\n      const target = event.target\n\n      // We only need to modify the default behavior if the target is a link\n      const targetsLink = Boolean(\n        isHTMLAnchorElement(target) || (isHTMLElement(target) && target.closest('a')),\n      )\n\n      if (targetsLink && event.altKey) {\n        event.preventDefault()\n        event.stopPropagation()\n        const newEvent = new MouseEvent(event.type, {\n          ...event,\n          altKey: false,\n          bubbles: true,\n          cancelable: true,\n        })\n        event.target?.dispatchEvent(newEvent)\n      }\n    }\n\n    const handleKeyUp = (e: KeyboardEvent) => {\n      if (isAltKey(e)) {\n        setOverlayEnabled((enabled) => !enabled)\n      }\n    }\n\n    const handleKeydown = (e: KeyboardEvent) => {\n      if (isAltKey(e)) {\n        setOverlayEnabled((enabled) => !enabled)\n      }\n\n      if (isHotkey(['mod', '\\\\'], e)) {\n        setOverlayEnabled((enabled) => !enabled)\n      }\n    }\n\n    window.addEventListener('click', handleClick)\n    window.addEventListener('keydown', handleKeydown)\n    window.addEventListener('keyup', handleKeyUp)\n\n    return () => {\n      window.removeEventListener('click', handleClick)\n      window.removeEventListener('keydown', handleKeydown)\n      window.removeEventListener('keyup', handleKeyUp)\n    }\n  }, [setOverlayEnabled])\n\n  const [overlaysFlash, setOverlaysFlash] = useState(false)\n  const [fadingOut, setFadingOut] = useState(false)\n  const fadeOutTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined)\n\n  // Flash overlays when they are enabled\n  useEffect(() => {\n    if (overlayEnabled) {\n      return raf2(() => {\n        setOverlaysFlash(true)\n        raf2(() => {\n          setFadingOut(true)\n          fadeOutTimeoutRef.current = setTimeout(() => {\n            setFadingOut(false)\n            setOverlaysFlash(false)\n          }, 1500)\n        })\n      })\n    } else if (fadeOutTimeoutRef.current) {\n      clearTimeout(fadeOutTimeoutRef.current)\n      setOverlaysFlash(false)\n      setFadingOut(false)\n    }\n\n    return\n  }, [overlayEnabled])\n\n  const documentIds = useMemo(() => {\n    return elements.flatMap((element) => ('id' in element.sanity ? [element.sanity.id] : []))\n  }, [elements])\n\n  const closeContextMenu = useCallback(() => {\n    dispatch({type: 'overlay/blur'})\n  }, [])\n\n  const optimisticActorReady = useOptimisticActorReady()\n\n  const componentResolver = useMemo(() => {\n    return optimisticActorReady ? _componentResolver : undefined\n  }, [_componentResolver, optimisticActorReady])\n\n  const elementsToRender = useMemo(() => {\n    if ((inFrame && status !== 'connected') || isDragging) {\n      return []\n    }\n\n    return elements\n      .filter((e) => e.activated || e.focused)\n      .map(({id, element, focused, hovered, rect, sanity, dragDisabled}) => {\n        const draggable =\n          !dragDisabled &&\n          !!element.getAttribute('data-sanity') &&\n          optimisticActorReady &&\n          elements.some((e) =>\n            'id' in e.sanity && 'id' in sanity\n              ? sanityNodesExistInSameArray(e.sanity, sanity) && e.sanity.path !== sanity.path\n              : false,\n          )\n\n        return (\n          <ElementOverlay\n            componentResolver={componentResolver}\n            element={element}\n            enableScrollIntoView={!isDragging && !dragMinimapTransition && !dragShowMinimap}\n            key={id}\n            focused={focused}\n            hovered={hovered}\n            node={sanity}\n            rect={rect}\n            showActions={!inFrame}\n            draggable={draggable}\n            isDragging={isDragging || dragMinimapTransition}\n            wasMaybeCollapsed={focused && wasMaybeCollapsed}\n          />\n        )\n      })\n  }, [\n    componentResolver,\n    dragMinimapTransition,\n    dragShowMinimap,\n    elements,\n    inFrame,\n    isDragging,\n    optimisticActorReady,\n    status,\n    wasMaybeCollapsed,\n  ])\n\n  return (\n    <ThemeProvider scheme={prefersDark ? 'dark' : 'light'} theme={studioTheme} tone=\"transparent\">\n      <LayerProvider>\n        <PortalProvider element={rootElement}>\n          <SchemaProvider comlink={comlink} elements={elements}>\n            <PreviewSnapshotsProvider comlink={comlink}>\n              <SharedStateProvider comlink={comlink}>\n                <Root\n                  data-fading-out={fadingOut ? '' : undefined}\n                  data-overlays={overlaysFlash ? '' : undefined}\n                  ref={setRootElement}\n                  $zIndex={zIndex}\n                >\n                  <DocumentReporter documentIds={documentIds} perspective={perspective} />\n                  <OverlaysController\n                    comlink={comlink}\n                    dispatch={dispatch}\n                    inFrame={inFrame}\n                    onDrag={updateDragPreviewCustomProps}\n                    overlayEnabled={overlayEnabled}\n                    rootElement={rootElement}\n                  />\n                  {contextMenu && <ContextMenu {...contextMenu} onDismiss={closeContextMenu} />}\n                  {elementsToRender}\n\n                  {isDragging && !dragMinimapTransition && (\n                    <>\n                      {dragInsertPosition && (\n                        <OverlayDragInsertMarker dragInsertPosition={dragInsertPosition} />\n                      )}\n                      {dragShowMinimapPrompt && <OverlayMinimapPrompt />}\n                      {dragGroupRect && <OverlayDragGroupRect dragGroupRect={dragGroupRect} />}\n                    </>\n                  )}\n                  {isDragging && dragSkeleton && <OverlayDragPreview skeleton={dragSkeleton} />}\n                </Root>\n              </SharedStateProvider>\n            </PreviewSnapshotsProvider>\n          </SchemaProvider>\n        </PortalProvider>\n      </LayerProvider>\n    </ThemeProvider>\n  )\n}\n","import {useEffect, useRef, type MutableRefObject} from 'react'\nimport {createOverlayController} from '../controller'\nimport type {OverlayController, OverlayEventHandler} from '../types'\nimport {useOptimisticActorReady} from './optimistic-state/useOptimisticActor'\n\n/**\n * Hook for using an overlay controller\n * @internal\n */\nexport function useController(\n  element: HTMLElement | null,\n  handler: OverlayEventHandler,\n  inFrame: boolean,\n): MutableRefObject<OverlayController | undefined> {\n  const overlayController = useRef<OverlayController | undefined>()\n\n  const optimisticActorReady = useOptimisticActorReady()\n\n  useEffect(() => {\n    if (!element) return undefined\n\n    overlayController.current = createOverlayController({\n      handler,\n      overlayElement: element,\n      inFrame,\n      optimisticActorReady,\n    })\n\n    return () => {\n      overlayController.current?.destroy()\n      overlayController.current = undefined\n    }\n  }, [element, handler, inFrame, optimisticActorReady])\n\n  return overlayController\n}\n","import {useEffect, useRef, type FunctionComponent} from 'react'\nimport type {VisualEditingNode, VisualEditingOptions} from '../types'\n\n/**\n * @internal\n */\nexport const Refresh: FunctionComponent<\n  {\n    comlink: VisualEditingNode\n  } & Required<Pick<VisualEditingOptions, 'refresh'>>\n> = (props) => {\n  const {comlink, refresh} = props\n\n  const manualRefreshRef = useRef(0)\n  const mutationRefreshRef = useRef(0)\n\n  useEffect(\n    () =>\n      comlink.on('presentation/refresh', (data) => {\n        if (data.source === 'manual') {\n          clearTimeout(manualRefreshRef.current)\n          const promise = refresh(data)\n          if (promise === false) return\n          comlink.post('visual-editing/refreshing', data)\n          let timedOut = false\n          manualRefreshRef.current = window.setTimeout(() => {\n            comlink.post('visual-editing/refreshed', data)\n            timedOut = true\n          }, 3000)\n          promise?.finally?.(() => {\n            if (timedOut) return\n            clearTimeout(manualRefreshRef.current)\n            comlink.post('visual-editing/refreshed', data)\n          })\n        } else if (data.source === 'mutation') {\n          clearTimeout(mutationRefreshRef.current)\n          const promise = refresh(data)\n          if (promise === false) return\n          comlink.post('visual-editing/refreshing', data)\n          // Send an additional refresh to account for Content Lake eventual consistency\n          mutationRefreshRef.current = window.setTimeout(() => {\n            const promise = refresh(data)\n            if (promise === false) return\n            comlink.post('visual-editing/refreshing', data)\n            promise?.finally?.(() => {\n              comlink.post('visual-editing/refreshed', data)\n            }) || comlink.post('visual-editing/refreshed', data)\n          }, 1000)\n          promise?.finally?.(() => {\n            comlink.post('visual-editing/refreshed', data)\n          }) || comlink.post('visual-editing/refreshed', data)\n        }\n      }),\n    [comlink, refresh],\n  )\n\n  return null\n}\n","import {\n  createCompatibilityActors,\n  type VisualEditingControllerMsg,\n  type VisualEditingNodeMsg,\n} from '@repo/visual-editing-helpers'\nimport {createNode, createNodeMachine} from '@sanity/comlink'\nimport {useEffect, useState, type FunctionComponent} from 'react'\nimport {createActor} from 'xstate'\nimport type {VisualEditingNode, VisualEditingOptions} from '../types'\nimport {createDatasetMutator} from './comlink'\nimport {History} from './History'\nimport {Meta} from './Meta'\nimport {setActor} from './optimistic-state/context'\nimport {createSharedListener} from './optimistic-state/machines/createSharedListener'\nimport {Overlays} from './Overlays'\nimport {Refresh} from './Refresh'\n\n/**\n * @public\n */\nexport const VisualEditing: FunctionComponent<VisualEditingOptions> = (props) => {\n  const {components, history, refresh, zIndex} = props\n  const inFrame = window.self !== window.top || window.opener\n\n  const [comlink, setComlink] = useState<VisualEditingNode | undefined>(undefined)\n\n  useEffect(() => {\n    if (!inFrame) return\n    const comlink = createNode<VisualEditingNodeMsg, VisualEditingControllerMsg>(\n      {\n        name: 'visual-editing',\n        connectTo: 'presentation',\n      },\n      createNodeMachine<VisualEditingNodeMsg, VisualEditingControllerMsg>().provide({\n        actors: createCompatibilityActors<VisualEditingNodeMsg>(),\n      }),\n    )\n    setComlink(comlink)\n\n    const listener = createSharedListener(comlink)\n    const datasetMutator = createDatasetMutator(comlink)\n    const actor = createActor(datasetMutator, {\n      // @ts-expect-error @todo\n      input: {client: {withConfig: () => {}}, sharedListener: listener},\n    })\n\n    // Fetch features to determine if optimistic updates are supported\n    const controller = new AbortController()\n    comlink\n      .fetch('visual-editing/features', undefined, {\n        signal: controller.signal,\n        suppressWarnings: true,\n      })\n      .then((data) => {\n        if (data.features['optimistic']) {\n          setActor(actor)\n        }\n      })\n      .catch(() => {\n        // eslint-disable-next-line no-console\n        console.warn(\n          '[@sanity/visual-editing] Package version mismatch detected: Please update your Sanity studio to prevent potential compatibility issues.',\n        )\n      })\n\n    actor.start()\n    comlink.start()\n\n    return () => {\n      controller.abort()\n      actor.stop()\n      comlink.stop()\n    }\n  }, [inFrame])\n\n  return (\n    <>\n      <Overlays\n        comlink={comlink}\n        componentResolver={components}\n        inFrame={inFrame}\n        zIndex={zIndex}\n      />\n      {comlink && (\n        <>\n          <History comlink={comlink} history={history} />\n          <Meta comlink={comlink} />\n          {refresh && <Refresh comlink={comlink} refresh={refresh} />}\n        </>\n      )}\n    </>\n  )\n}\nVisualEditing.displayName = 'VisualEditing'\n","import {type ListenEvent} from '@sanity/client'\nimport {merge, ReplaySubject, Subject, type Observable, type ObservedValueOf} from 'rxjs'\nimport type {VisualEditingNode} from '../../../types'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype SharedListenEvent = ListenEvent<Record<string, any>>\n\n/**\n * Creates a single, shared, listener EventSource that strems remote mutations, and notifies when it's online (welcome), offline (reconnect).\n */\nexport function createSharedListener(comlink: VisualEditingNode): Observable<SharedListenEvent> {\n  // Welcome events could be received before the listener has been subscribed\n  // to. Using a ReplaySubject will ensure the welcome event is re-emitted when\n  // a new subscriber arrives.\n  const incomingConnection$ = new ReplaySubject<SharedListenEvent>(1)\n  const incomingMutations$ = new Subject<SharedListenEvent>()\n\n  comlink\n    .fetch('visual-editing/snapshot-welcome', undefined, {suppressWarnings: true})\n    .then((data) => {\n      incomingConnection$.next(data.event)\n    })\n    .catch(() => {\n      // Fail silently as the app may be communicating with a version of\n      // Presentation that does not support this feature\n    })\n\n  comlink.on('presentation/snapshot-event', (data) => {\n    // Welcome events are still emitted by Presentation for backwards\n    // compatibility. We don't need them anymore as we explicitly fetch the\n    // welcome event, so filter them out here.\n    if (data.event.type === 'reconnect') {\n      incomingConnection$.next(data.event)\n    }\n    if (data.event.type === 'mutation') {\n      incomingMutations$.next(data.event)\n    }\n  })\n\n  return merge(incomingConnection$, incomingMutations$)\n}\n\nexport type SharedListenerEvents = ObservedValueOf<ReturnType<typeof createSharedListener>>\n"],"names":["datasetMutatorMachine","setup","types","actions","emit","event","assertEvent","assign","documents","context","spawn","id","documentId","input","client","sharedListener","createSharedListener","stopChild","_","actors","documentMutatorMachine","createMachine","on","sync","mutation","pristine","observe","unobserve","initial","states","createDocumentMutator","comlink","fetchSnapshot","fromPromise","async","signal","snapshot","fetch","submitMutations","transactions","transaction","data","SanityEncoder","encodeTransaction","post","provide","enqueueActions","enqueue","sendParent","type","document","remote","local","History","props","$","_c","history","t0","t1","t2","t3","update","useEffect","subscribe","title","Meta","sendMeta","observer","MutationObserver","target","nodeName","head","subtree","characterData","childList","disconnect","_temp","customEvent","CustomEvent","detail","cancelable","window","dispatchEvent","SchemaContext","createContext","useSchema","useContext","Error","getArrayRemoveAction","node","doc","patch","getSnapshot","getArrayRemovePatches","getArrayInsertAction","insertType","position","getArrayInsertPatches","getDuplicateAction","getArrayDuplicatePatches","getContextMenuItems","field","parent","items","push","getDuplicateItem","getRemoveItems","getMoveItems","label","icon","InsertAboveIcon","action","name","InsertBelowIcon","getContextMenuArrayItems","options","insertMenu","width","views","some","view","undefined","component","boundaryElement","InsertMenuWrapper","onSelect","schemaType","of","filter","item","map","t","getNodeIcon","getContextMenuUnionItems","Promise","resolve","CopyIcon","RemoveIcon","withDivider","groupItems","moveUpPatches","moveDownPatches","moveFirstPatches","moveLastPatches","all","getArrayMovePatches","length","PublishIcon","ArrowUpIcon","ArrowDownIcon","UnpublishIcon","SortIcon","t4","Symbol","for","arrow","constrainSize","floatingBoundary","padding","placement","fallbackPlacements","preventOverflow","__unstable_margins","jsx","InsertMenu","MenuGroup","fontSize","popover","space","POPOVER_MARGINS","ContextMenuItem","onDismiss","onClick","MenuDivider","hotkeys","MenuItem","text","disabled","t5","itemIndex","Component","ContextMenu","x","y","setBoundaryElement","useState","getField","getDocument","useDocuments","setItems","t6","fetchContextMenuItems","items_0","getBoundingClientRect","bottom","left","right","top","height","contextMenuReferenceElement","t7","t8","t9","t10","minWidth","maxWidth","Box","flex","Text","size","Spinner","t11","t12","t13","t14","t15","Stack","children","weight","jsxs","Flex","gap","Fragment","i","Menu","style","t16","t17","t18","t19","t20","Popover","open","content","PopoverPortal","PreviewSnapshotsContext","Root","styled","Card","Actions","ActionOpen","Tab","Labels","ElementOverlayInner","element","focused","componentResolver","showActions","draggable","getType","path","baseUrl","tool","workspace","createEditUrl","pathToUrlString","studioPath","fromString","createIntentLink","href","previewSnapshots","usePreviewSnapshots","bb0","find","_id","bb1","value","componentContext","customComponents","resolved","isReactElementOverlayComponent","isValidElement","Array","isArray","useCustomComponents","dangerouslySetInnerHTML","__html","DocumentIcon","paddingBottom","Link","marginRight","className","DragHandleIcon","props_0","PointerEvents","ElementOverlay","memo","hovered","rect","wasMaybeCollapsed","enableScrollIntoView","ref","useRef","scrolledIntoViewRef","w","h","transform","current","scrollIntoView","behavior","block","inline","scrollMode","referer","useSyncExternalStore","_temp2","_temp3","useMemo","parsed","URL","location","origin","searchParams","set","toString","useLinkHref","as","rel","onStoreChange","handlePopState","addEventListener","removeEventListener","OverlayDragGroupRect","dragGroupRect","border","pointerEvents","lerp","v0","v1","OverlayDragInsertMarker","dragInsertPosition","offsetMultiplier","markerThickness","startX","endX","offset","Math","min","startY","endY","max","background","borderRadius","zIndex","div","$scaleFactor","$width","$height","OverlayDragPreview","skeleton","maxSkeletonWidth","innerWidth","scaleFactor","offsetX","offsetY","prefersDark","usePrefersDark","theme","useTheme_v2","radius","number","inMin","inMax","outMin","outMax","clamp","childRects","imageRects","textRects","color","from","r_1","r","fill","viewBox","shadow","overflow","tone","scheme","tagName","r_0","OverlayMinimapPrompt","align","Hotkeys","keys","ExpandIcon","elementsReducer","elements","message","e","activated","sanity","dragDisabled","clickedElement","overlayStateReducer","state","contextMenu","focusPath","perspective","isDragging","dragShowMinimap","dragShowMinimapPrompt","dragSkeleton","dragMinimapTransition","prevFocusPath","slice","startsWith","insertPosition","display","groupRect","PreviewSnapshotsProvider","setPreviewSnapshots","snapshots","Provider","isSanityNode","isDocumentSchemaType","isTypeSchemaType","SchemaProvider","Map","resolvedTypes","setResolvedTypes","schema","setSchema","response","suppressWarnings","fetchSchema","controller","AbortController","abort","reportedPathsRef","reportPaths","controller_0","paths_0","reduce","acc","includes","split","toReversed","part","join","popUnkeyedPathSegments","getPathsWithUnresolvedTypes","paths","p","signal_0","response_0","_type","node_0","schemaType_0","nodePath","flatMap","fieldFromPath","schemaType_1","path_0","prevPath","next","rest","objectField","fields","name_0","get","Boolean","console","warn","store","initialState","listeners","Set","getState","setState","fn","forEach","l","add","listener","delete","createStore","SharedStateProvider","catch","value_0","SharedStateContext","prev","key","Object","fromEntries","entries","reason","debug","e_0","s","DRAFTS_PREFIX","$zIndex","raf2","r0","r1","requestAnimationFrame","cancelAnimationFrame","DocumentReporter","documentIds","uniqueIds","setUniqueIds","actor","useOptimisticActor","id_0","send","getDraftId","getPublishedId","id_1","OverlaysController","dispatch","inFrame","onDrag","overlayEnabled","rootElement","dispatchDragEndEvent","handler","preventInsertDefault","reference","getReferenceNodeAndInsertPosition","targetKey","hasExplicitKey","getArrayItemKeyAndParentPath","arrayPath","referenceItemKey","elementValue","getFromPath","at","remove","_key","insert","useDragEndEvents","enabled","dragGroup","flow","cursor","removeProperty","useController","overlayController","optimisticActorReady","useOptimisticActorReady","createOverlayController","overlayElement","destroy","activate","deactivate","Overlays","_componentResolver","status","setStatus","useReducer","setRootElement","setOverlayEnabled","unsubs","data_0","onStatus","status_0","usePerspectiveSync","then","unsub","useReportDocuments","lastReported","perspective_0","reportDocuments","nodes","nodeIds","a","b","has","isEqualSets","documentsOnPage","projectId","_projectId","dataset","_dataset","setProperty","scrollY","updateDragPreviewCustomProps","handleClick","_temp4","handleKeyUp","_temp5","handleKeydown","isAltKey","_temp6","isHotkey","_temp7","overlaysFlash","setOverlaysFlash","fadingOut","setFadingOut","fadeOutTimeoutRef","setTimeout","clearTimeout","_temp8","closeContextMenu","_temp9","element_0","getAttribute","e_2","sanityNodesExistInSameArray","elementsToRender","t21","t22","t23","t24","t25","t26","t27","LayerProvider","PortalProvider","ThemeProvider","studioTheme","prevId","isHTMLAnchorElement","isHTMLElement","closest","altKey","preventDefault","stopPropagation","newEvent","MouseEvent","bubbles","enabled_0","enabled_1","enabled_2","e_1","Refresh","refresh","manualRefreshRef","mutationRefreshRef","source","promise","timedOut","finally","promise_0","promise_1","VisualEditing","components","self","opener","setComlink","comlink_0","createNode","connectTo","createNodeMachine","createCompatibilityActors","incomingConnection$","ReplaySubject","incomingMutations$","Subject","merge","datasetMutator","createDatasetMutator","createActor","withConfig","features","optimistic","setActor","start","stop","displayName"],"mappings":"4iDAqBO,MAAMA,GAAwBC,EAAM,CACzCC,MAAO,CAAC,EAgBRC,QAAS,CACP,kBAAmBC,GAAK,EAAEC,YACxBC,EAAYD,EAAO,QACZA,KAET,sBAAuBD,GAAK,EAAEC,YAC5BC,EAAYD,EAAO,YACZA,KAET,qBAAsBD,GAAK,EAAEC,YAC3BC,EAAYD,EAAO,CAAC,gBAAiB,mBAC9BA,KAET,sBAAuBD,GAAK,EAAEC,YAC5BC,EAAYD,EAAO,CAAC,aACbA,KAET,qBAAsBE,EAAO,CAC3BC,UAAWA,EAAEC,UAASJ,QAAOK,YAC3BJ,EAAYD,EAAO,WACnB,MAAMM,EAAKN,EAAMO,WAEjB,OAAIH,EAAQD,UAAUG,GAAYF,EAAQD,UACnC,IACFC,EAAQD,UACXG,CAACA,GAAKD,EAAM,yBAA0B,CACpCG,MAAO,CACLF,KACAG,OAAQL,EAAQK,OAChBC,eAAgBN,EAAQM,gBAAkBC,EAAqBP,EAAQK,SAEzEH,OAEJ,IAGJ,uBAAwBM,GAAU,EAAER,UAASJ,YAC3CC,EAAYD,EAAO,aACZI,EAAQD,UAAUH,EAAMO,eAEjC,sCAAuCL,EAAO,CAC5CC,UAAWA,EAAEC,UAASJ,YACpBC,GAAAA,EAAYD,EAAO,cAEdI,EAAQD,UAAUH,EAAMO,YAAa,OAAOH,EAAQD,UAEnD,MAAC,CAACH,EAAMO,YAAaM,KAAMV,GAAaC,EAAQD,UAC/CA,OAAAA,CAAAA,KAIbW,OAAQ,CACNC,4BAEDC,cAAc,CAEfV,GAAI,kBACJF,QAASA,EAAEI,YAAY,CACrBL,UAAW,CAAC,EACZM,OAAQD,EAAMC,OACdC,eAAgBF,EAAME,iBAGxBO,GAAI,CACFC,KAAQ,CAACpB,QAAS,CAAC,oBACnBqB,SAAY,CAACrB,QAAS,CAAC,wBACvB,YAAa,CAACA,QAAS,CAAC,uBACxBsB,SAAY,CAACtB,QAAS,CAAC,wBACvBuB,QAAW,CACTvB,QAAS,CAAC,uBAEZwB,UAAa,CACXxB,QAAS,CAAC,uBAAwB,yCAItCyB,QAAS,WAETC,OAAQ,CACNJ,SAAU,CAAA,KC1GDK,GAAwDC,IAC7DC,MAAAA,EAAgBC,GACpBC,OAAQrB,QAAOsB,aACP,MAAAxB,GAACA,GAAME,GACPuB,SAACA,SAAkBL,EAAQM,MAC/B,gCACA,CAACzB,WAAYD,GACb,CACEwB,WAGGC,OAAAA,CAAAA,IAILE,EAAkBL,GACtBC,OAAQrB,YACA,MAAA0B,aAACA,GAAgB1B,EACvB,IAAA,MAAW2B,KAAeD,EAAc,CAChCE,MAAAA,EAAOC,EAAcC,kBAAkBH,GACtCT,OAAAA,EAAQa,KAAK,wBAAyBH,EAAI,KAKvD,OAAOrB,EAAuByB,QAAQ,CACpC1C,QAAS,CACP,4BAA6B2C,GAAe,EAAEC,cAE5CA,EAAQC,YACN,EAAEvC,cACC,CACCwC,KAAM,OACNtC,GAAIF,EAAQE,GACZuC,SAAUzC,EAAQ0C,WAIxBJ,EAAQ3C,MAAK,EAAEK,cAAc,CAACwC,KAAM,QAASb,SAAU3B,EAAQ2C,SAAO,KAG1EjC,OAAQ,CACN,wBAAyBa,EACzB,mCAAoCM,IAEvC,EClDUe,GAGRC,IAAAC,MAAAA,EAAAC,EAAA,IACHzB,QAAAA,EAAAA,QAAA0B,GAA2BH,EAAK,IAAAI,EAAAC,EAMVC,EAAAC,EAAAN,OANUA,EAAAxB,KAAAA,GAAAwB,OAAAE,GAEtBC,EAAAA,IACD3B,GAAOT,GAAK,yBAAuBmB,IACxCgB,GAAOK,OAASrB,EAAI,IAErBkB,EAAA,CAAC5B,EAAS0B,GAAQF,KAAAxB,EAAAwB,KAAAE,EAAAF,KAAAG,EAAAH,KAAAI,IAAAD,EAAAH,EAAA,GAAAI,EAAAJ,EAAA,IAJrBQ,EAAUL,EAIPC,GAAmBJ,EAAAxB,KAAAA,GAAAwB,OAAAE,GAEZG,EAAAA,KACJH,GAAAA,EACKA,OAAAA,EAAOO,WAAAF,IACNG,EAAAA,MAASH,EAAMG,OAAAf,SAAAe,MACrBlC,GAAOa,KAAO,0BAA2BkB,EAAM,GAChD,EAGFD,EAAA,CAAC9B,EAAS0B,GAAQF,KAAAxB,EAAAwB,KAAAE,EAAAF,KAAAK,EAAAL,KAAAM,IAAAD,EAAAL,EAAA,GAAAM,EAAAN,EAAA,IARrBQ,EAAUH,EAQPC,GAAmB,IAAA,ECpBXK,GAERZ,IAAAC,MAAAA,EAAAC,EAAA,IACHzB,QAAAA,GAAkBuB,EAAK,IAAAI,EAAAC,EAAA,OAAAJ,OAAAxB,GAEb2B,EAAAA,KACR,MAAAS,EAAAA,KACEpC,EAAOa,KAAM,sBAAqB,CAAAqB,MAAAf,SAAAe,OAAyB,EAG7DG,EAAA,IAAAC,kBAAAT,IAAuCpC,MAAAA,GAAAoC,EACJ,UAArBU,EAAAA,OAAAC,UACVJ,GAAS,IAILzC,OAAAA,EAAAA,QAAAwB,SAAAsB,KAAA,CAAAC,SAAA,EAAAC,eAAA,EAAAC,WAAA,IAMRR,IAAU,IAEGC,EAAQQ,YAAY,EAChCjB,GAAC5B,GAAQwB,KAAAxB,EAAAwB,KAAAG,EAAAH,KAAAI,IAAAD,EAAAH,EAAA,GAAAI,EAAAJ,EAAA,IApBZQ,EAAUL,EAoBPC,GAAU,IAAA,ECRR,SAAAkB,GAAAxE,GAkEHyE,MAAAA,EAAA,IAAAC,YAAkD,iBAAgB,CAAAC,OACxD3E,EAAK4E,YAAA,IAGfC,OAAAC,cAAqBL,EAAY,CCrExBM,MAAAA,GAAgBC,EAAyC,MCrB/D,SAAAC,KACL7E,MAAAA,EAAgB8E,EAAAH,IAAyB,IAEpC3E,EAAO+E,MAAAA,IAAAA,MACM,6BAGX/E,OAAAA,CAAO,CCsBAgF,SAAAA,GAAqBC,EAAkBC,GACrD,IAAKD,EAAKzC,KAAY,MAAA,IAAIuC,MAAM,wBACzB,MAAA,IACLG,EAAIC,OAAM1D,OAAQ2D,iBAAiBC,EAAsBJ,QAAaG,MAC1E,CAEA,SAASE,GACPL,EACAC,EACAK,EACAC,GAEA,IAAKP,EAAKzC,KAAY,MAAA,IAAIuC,MAAM,wBACzB,MAAA,IAAMG,EAAIC,OAAM,IAAMM,EAAsBR,EAAMM,EAAYC,IACvE,CAEA,SAASE,GAAmBT,EAAkBC,GAC5C,IAAKD,EAAKzC,KAAY,MAAA,IAAIuC,MAAM,wBACzB,MAAA,IACLG,EAAIC,OAAM1D,OAAQ2D,iBAAiBO,EAAyBV,QAAaG,MAC7E,CAEO,SAASQ,GAAoB5F,GAM5B,MAAAiF,KAACA,EAAAA,MAAMY,EAAAA,OAAOC,EAAAA,IAAQZ,GAAOlF,EAC/B6F,MAAgB,cAAhBA,GAAOrD,KAwGbf,eAAwCzB,GAKhC,MAAAiF,KAACA,EAAAA,MAAMY,EAAAA,IAAOX,GAAOlF,EACrB+F,EAA2B,GAC3BC,OAAAA,EAAAA,QAAQC,GAAiBjG,IAC/B+F,EAAMC,QAAQE,GAAelG,IAC7B+F,EAAMC,cAAeG,GAAanG,IAElC+F,EAAMC,KAAK,CACTxD,KAAM,SACN4D,MAAO,gBACPC,KAAMC,EACNC,OAAQjB,GAAqBL,EAAMC,EAAKW,EAAMW,KAAM,YAEtDT,EAAMC,KAAK,CACTxD,KAAM,SACN4D,MAAO,eACPC,KAAMI,EACNF,OAAQjB,GAAqBL,EAAMC,EAAKW,EAAMW,KAAM,WAG/CT,CACT,CAhIWW,CAAyB,CAACzB,OAAMY,QAAOX,QAE3B,UAAjBY,GAAQtD,KAyKdf,eAAwCzB,GAKhC,MAAAkF,IAACA,EAAAA,KAAKD,EAAAA,OAAMa,GAAU9F,EACtB+F,EAA2B,GACjCA,GAAAA,EAAMC,QAAQC,GAAiBjG,IAC/B+F,EAAMC,QAAQE,GAAelG,IAC7B+F,EAAMC,cAAeG,GAAanG,IAE9B8F,EAAOa,SAASC,WAAY,CAE9B,MAAMC,GADoBf,EAAOa,QAAQC,YAAc,CAAC,GACxBE,OAAOC,MAAeC,GAAc,SAAdA,EAAKR,OAAmB,OAAIS,EAElFlB,EAAMC,KAAK,CACTxD,KAAM,SACN0E,UAAWA,EAAEC,uBAMRC,GAAA,CACChB,MAAM,gBACNiB,SAPyCC,IAC5BhC,GAAqBL,EAAMC,EAAKoC,EAAWd,KAAM,SAAjDlB,EACR,EAMLQ,SACAe,QACAM,sBAMRpB,EAAMC,KAAK,CACTxD,KAAM,SACN0E,UAAWA,EAAEC,uBAMRC,GAAA,CACChB,MAAM,eACNiB,SAPyCC,IAC5BhC,GAAqBL,EAAMC,EAAKoC,EAAWd,KAAM,QAAjDlB,EACR,EAMLQ,SACAe,QACAM,qBAKV,MACEpB,EAAMC,KAAK,CACTxD,KAAM,QACN4D,MAAO,gBACPC,KAAMC,EACNP,MACED,EAAOyB,GAAGC,QAAQC,GAAuB,gBAAdA,EAAKjF,OAChCkF,KACOC,IAAA,CACLnF,KAAM,SACN6D,KAAMuB,EAAYD,GAClBvB,MAAkB,UAAXuB,EAAEnB,KAAmB,YAAcmB,EAAEnE,OAASmE,EAAEnB,KACvDD,OAAQjB,GAAqBL,EAAMC,EAAKyC,EAAEnB,KAAM,gBAItDT,EAAMC,KAAK,CACTxD,KAAM,QACN4D,MAAO,eACPC,KAAMI,EACNV,MACED,EAAOyB,GAAGC,QAAQC,GAAuB,gBAAdA,EAAKjF,OAChCkF,KACOC,IAAA,CACLnF,KAAM,SACN4D,MAAkB,UAAXuB,EAAEnB,KAAmB,YAAcmB,EAAEnE,OAASmE,EAAEnB,KACvDH,KAAMuB,EAAYD,GAClBpB,OAAQjB,GAAqBL,EAAMC,EAAKyC,EAAEnB,KAAM,eAMjDT,OAAAA,CACT,CA9PW8B,CAAyB,CAAC5C,OAAMa,SAAQZ,QAG1C4C,QAAQC,QAAQ,GACzB,CAEA,SAAS9B,GAAiBjG,GAClB,MAAAiF,KAACA,EAAAA,IAAMC,GAAOlF,EACpB,OAAKkF,EACE,CACL,CACE1C,KAAM,SACN4D,MAAO,YACPC,KAAM2B,EACNzB,OAAQb,GAAmBT,EAAMC,KANpB,EASnB,CAEA,SAASgB,GAAelG,GAChB,MAAAiF,KAACA,EAAAA,IAAMC,GAAOlF,EACpB,OAAKkF,EACE,CACL,CACE1C,KAAM,SACN4D,MAAO,SACPC,KAAM4B,EACN1B,OAAQvB,GAAqBC,EAAMC,KANtB,EASnB,CAEAzD,eAAe0E,GACbnG,EAIAkI,GAAc,GAER,MAAAjD,KAACA,EAAAA,IAAMC,GAAOlF,EAChB,IAACkF,EAAK,MAAO,GAEjB,MAAMa,EAA2B,GAC3BoC,EAAgC,IAE/BC,EAAeC,EAAiBC,EAAkBC,SAAyBT,QAAQU,IAAI,CAC5FC,EAAoBxD,EAAMC,EAAK,YAC/BuD,EAAoBxD,EAAMC,EAAK,QAC/BuD,EAAoBxD,EAAMC,EAAK,SAC/BuD,EAAoBxD,EAAMC,EAAK,UAG7BoD,OAAAA,EAAiBI,QACnBP,EAAWnC,KAAK,CACdxD,KAAM,SACN4D,MAAO,SACPC,KAAMsC,GACNpC,OAAQA,IAAMrB,EAAIC,MAAMmD,KAGxBF,EAAcM,QAChBP,EAAWnC,KAAK,CACdxD,KAAM,SACN4D,MAAO,KACPC,KAAMuC,GACNrC,OAAQA,IAAMrB,EAAIC,MAAMiD,KAGxBC,EAAgBK,QAClBP,EAAWnC,KAAK,CACdxD,KAAM,SACN4D,MAAO,OACPC,KAAMwC,GACNtC,OAAQA,IAAMrB,EAAIC,MAAMkD,KAGxBE,EAAgBG,QAClBP,EAAWnC,KAAK,CACdxD,KAAM,SACN4D,MAAO,YACPC,KAAMyC,GACNvC,OAAQA,IAAMrB,EAAIC,MAAMoD,KAIxBJ,EAAWO,SACb3C,EAAMC,KAAK,CACTxD,KAAM,QACN4D,MAAO,OACPC,KAAM0C,GACNhD,MAAOoC,IAELD,GACFnC,EAAMC,KAAK,CAACxD,KAAM,aAIfuD,CACT,CA6BA,MAAMqB,GAMDvE,IAAAC,MAAAA,EAAAC,EAAA,KACHqD,MAAAA,EAAAA,OAAAN,EAAAA,MAAAe,EAAAA,SAAAQ,EAAAA,gBAAAF,GAA0DtE,EAAKI,IAAAA,EAqBxDC,EAG+BC,EACjCC,EAI+C4F,EAAAlG,OA7BWA,EAAA,KAAAmG,OAAAC,IAAA,8BAarCjG,EAClB,CAAA,aACA,QACA,OACA,YACA,WACA,SACA,OACDH,KAAAG,GAAAA,EAAAH,EAAA,GAAAA,EAAA,KAAAmG,OAAAC,IAAA,8BAGmBhG,EAAA,CAAA,EAAA,EAAA,EAAA,GAAYJ,KAAAI,GAAAA,EAAAJ,EAAA,GAAAA,EAAAqE,KAAAA,GAAArE,OAAA+D,GAjBzB1D,EAAA,CAAAgG,OAAA,EAAAC,eAAA,EAAAC,iBAGWlC,EAAemC,QAAA,EAAAC,UAEtB,cAAaC,mBACJvG,EAQnBwG,iBAAA,EAAA5C,QAAA6C,mBAGmBxG,GACrBJ,KAAAqE,EAAArE,KAAA+D,EAAA/D,KAAAK,GAAAA,EAAAL,EAAA,GAAAA,EAAAuE,KAAAA,GAAAvE,OAAAgD,GAID1C,EAACuG,EAAAC,GAAiB9D,CAAAA,KAAAA,EAAkBuB,aAAYvE,KAAAuE,EAAAvE,KAAAgD,EAAAhD,KAAAM,GAAAA,EAAAN,EAAA,GAAAA,EAAAsD,KAAAA,GAAAtD,OAAAK,GAAAL,EAAA,MAAAM,GA1BlD4F,IAACa,IACWC,WACJrD,KAAAA,EACG6C,QAAA,EACAS,QAAA5G,EAmBF6G,MAAA,EACD5D,KAAIA,EAEVhD,aACUN,KAAAsD,EAAAtD,KAAAK,EAAAL,MAAAM,EAAAN,MAAAkG,GAAAA,EAAAlG,EAAA,IA3BZkG,CAAAA,ECrLJ,MAAMiB,GAAkC,EAAK,EAAA,KAAO,GAEpD,SAAAC,GAAArH,GAAAC,MAAAA,EAAAC,EAAA,KAKEkC,KAAAA,EAAAA,UAAAkF,EAAAA,gBAAAhD,GAA2CtE,EAAKI,IAAAA,EAAAgC,EAAAA,KAAAA,GAAAnC,OAAAqH,GAEpBlH,EAAAA,KACR,WAAdgC,EAAIzC,OACNyC,EAAIsB,WACJ4D,QAEHrH,KAAAmC,EAAAnC,KAAAqH,EAAArH,KAAAG,GAAAA,EAAAH,EAAA,GALD,MAAAsH,EAAgBnH,EAOZgC,GAAc,YAAdA,EAAIzC,KAAmB,CAAAU,IAAAA,EAAAJ,OAAAA,EAAA,KAAAmG,OAAAC,IAAA,8BAClBhG,EAACyG,EAAAU,GAAc,CAAA,GAAAvH,KAAAI,GAAAA,EAAAJ,EAAA,GAAfI,CAAAA,CAGL+B,GAAc,WAAdA,EAAIzC,KAAkB,CASVU,MAAAA,GAAC+B,EAAIsB,OAAOpD,IAAAA,EAAA,OAAAL,EAAAmC,KAAAA,EAAAqF,SAAAxH,EAAA,KAAAmC,EAAAoB,MAAAvD,EAAAmC,KAAAA,EAAAmB,OAAAtD,OAAAsH,GAAAtH,EAAA,KAAAI,GAPxBC,IAACoH,GACW,CAAAT,SAAC,EACFQ,QAAArF,EAAIqF,QACPjE,KAAApB,EAAIoB,KACDiD,QAAC,EACHU,MAAA,EACDQ,KAAAvF,EAAImB,MACAqE,SAAAvH,EACDkH,YACTtH,EAAA,GAAAmC,EAAAqF,QAAAxH,EAAA,GAAAmC,EAAAoB,KAAAvD,EAAA,GAAAmC,EAAAmB,MAAAtD,KAAAsH,EAAAtH,KAAAI,EAAAJ,KAAAK,GAAAA,EAAAL,EAAA,GATFK,CAAAA,CAaA8B,GAAc,UAAdA,EAAIzC,KAAiB,CAIb,MAAAU,EAAA+B,EAAIoB,KAAKlD,IAAAA,EAAAL,EAAA,MAAAmG,OAAAC,IAAA,8BAMN/F,EAAA,CAAAgG,OAAA,EAAAC,eAAA,EAAAG,UAGI,cAAaC,mBAEtB,CAAA,aACA,QACA,OACA,YACA,WACA,SACA,OAAKC,iBAAA,EAAAC,mBAAAO,IAIRnH,MAAAK,GAAAA,EAAAL,EAAA,IAEK,MAAAM,EAAA6B,EAAImB,MAAM4C,IAAAA,EASd0B,EATc,GAAA5H,EAAA,MAAAqE,GAAArE,EAAA,MAAAmC,EAAAc,OAAAjD,EAAA,MAAAqH,EAAA,CAAAO,IAAAA,EAAAvD,EAAAA,MAAAA,GAAArE,QAAAqH,GAEAO,EAAAA,CAAAjD,EAAAkD,IACbhB,EAAAO,IAEOzC,KAAGA,EACE0C,YACMhD,mBAHZwD,GAKR7H,MAAAqE,EAAArE,MAAAqH,EAAArH,MAAA4H,GAAAA,EAAA5H,EAAA,IAPAkG,EAAA/D,EAAIc,MAAA2B,IAAWgD,GAOd5H,MAAAqE,EAAArE,EAAA,IAAAmC,EAAAc,MAAAjD,MAAAqH,EAAArH,MAAAkG,CAAA,MAAAA,EAAAlG,EAAA,IAAAA,OAAAA,EAAA,MAAAmC,EAAAoB,MAAAvD,EAAAmC,MAAAA,EAAAmB,OAAAtD,QAAAkG,GAlCJ0B,EAACf,EAAAE,GAAA,CACWC,WACJzD,KAAAnD,EACGoG,QAAA,EAKAS,QAAA5G,EAgBF6G,MAAA,EACDQ,KAAApH,EAEL4F,SAQHA,IAAYlG,EAAA,IAAAmC,EAAAoB,KAAAvD,EAAA,IAAAmC,EAAAmB,MAAAtD,MAAAkG,EAAAlG,MAAA4H,GAAAA,EAAA5H,EAAA,IAnCZ4H,CAAAA,CAuCAzF,GAAc,WAAdA,EAAIzC,KAAkB,CACxB,MAAA0E,UAAA0D,GAA+B3F,EAAI/B,IAAAA,EAAA,OAAAJ,EAAA8H,MAAAA,GAAA9H,QAAAqE,GAC5BjE,IAAC0H,EAA2BzD,CAAAA,oBAAmBrE,MAAA8H,EAAA9H,MAAAqE,EAAArE,MAAAI,GAAAA,EAAAJ,EAAA,IAA/CI,CAAAA,CAA+C,OAAA,IAAA,CAMnD,MAAM2H,GAAmDhI,IAAAC,MAAAA,EAAAC,EAAA,KAC9DkC,KAAAA,EAAAA,UAAAkF,EAAA3E,SAAAvC,GAIIJ,GADQiI,EAAAA,EAAAA,EAAAC,GAAA9H,GAGZkE,EAAA6D,GAA8CC,SAE9CC,SAAAA,GAAmBrG,MACnBsG,YAAAA,GAAsBC,IAAclI,IAAAA,EAAAgI,EAAAA,KAAAA,GAAApI,OAAAmC,GAEZ/B,EAAAgI,EAASjG,GAAKnC,KAAAoI,EAAApI,KAAAmC,EAAAnC,KAAAI,GAAAA,EAAAJ,EAAA,GAAtC,MAAA+C,MAAAA,EAAAA,OAAAC,GAAwB5C,EAAcC,IAAAA,EAG7B0C,EAAAA,GAAKrC,OAAWqC,GAAKW,MAAU,eADxC,MAAAhD,EAAcL,GAId4C,EAAAsF,GAA0BJ,OAAAhE,GAAkD,IAAA7D,EAAA4F,EAUtC0B,EAAAY,EAVsCxI,EAAA,KAAA+C,GAAA/C,EAAAqI,KAAAA,GAAArI,EAAAmC,KAAAA,GAAAnC,OAAAgD,GAElE1C,EAAAA,KAORmI,WALErG,MAAAA,EAAYiG,EAAYlG,EAAI/E,IAAI,IAC3BgF,EAAG,OACRsG,MAAAA,QAAoB5F,GAAA,CAAAX,OAAAY,QAAAC,SAAAZ,QACpBmG,EAAStF,EAEW,EAAtBwF,EAAsB,EACrBvC,GAACnD,EAAOZ,EAAMa,EAAQqF,GAAYrI,KAAA+C,EAAA/C,KAAAqI,EAAArI,KAAAmC,EAAAnC,KAAAgD,EAAAhD,KAAAM,EAAAN,KAAAkG,IAAA5F,EAAAN,EAAA,GAAAkG,EAAAlG,EAAA,IARrCQ,EAAUF,EAQP4F,GAAmClG,EAAAgI,KAAAA,GAAAhI,QAAAiI,GAG7BO,EAAA,CAAAG,sBAAAA,KAAA,CAAAC,OAEKX,EAACY,KACHb,EAACc,MACAd,EAACe,IACHd,EAAClE,MAAA,EAAAiF,OAAA,KAIThJ,KAAAgI,EAAAhI,MAAAiI,EAAAjI,MAAAwI,GAAAA,EAAAxI,EAAA,IATD4H,EAAOY,EADT,MAAAS,EAAoCrB,EAW1B,IAAAsB,EAAAC,EAAAnJ,QAAA+C,GAGDoG,EAAArE,EAAY/B,GAAM/C,MAAA+C,EAAA/C,MAAAmJ,GAAAA,EAAAnJ,EAAA,IAAzBkJ,EAAOC,EADT,MAAA5F,EAAa2F,EAEFE,IAAAA,EAWwCC,EAXxCrJ,EAAA,MAAAmG,OAAAC,IAAA,8BAWUgD,EAAA,CAAAE,SAAA,IAAAC,SAAA,KAA8BvJ,MAAAoJ,GAAAA,EAAApJ,EAAA,IAAAuD,EAAAA,MAAAA,GAAAvD,QAAAiD,GAEvCoG,EAACxC,EAAA2C,GAAA,CAASC,KAAA,OAAQxG,SAAAA,IAASyG,GAAW,CAAAC,KAAA,EAAIpG,SAAKA,IAAWsD,EAAA+C,GAAA,CAAcD,KAAC,MAAW3J,MAAAuD,EAAAvD,MAAAiD,EAAAjD,MAAAqJ,GAAAA,EAAArJ,EAAA,IAI/E6J,MAAAA,EAAA5G,EAAQvC,EAAQ,aAAYoJ,IAAAA,EAEzBC,EACHC,EAcNC,EAjBkCjK,QAAA6J,GAFjCC,IAACI,GAAY,CAAAT,KAAA,EAAUvC,MAAA,EACrBiD,SAACtD,EAAA6C,IAAWC,KAAA,EAAUS,OAAA,WACnBP,SACHA,MACM7J,MAAA6J,EAAA7J,MAAA8J,GAAAA,EAAA9J,EAAA,IAAAA,EAAAqJ,MAAAA,GAAArJ,QAAA8J,GAPVC,EAACM,EAAAC,GAAA,CAAUC,IAAA,EAAY/D,UACrB6C,SAAAA,CAAAA,EAEAS,KAKK9J,MAAAqJ,EAAArJ,MAAA8J,EAAA9J,MAAA+J,GAAAA,EAAA/J,EAAA,IAAAA,EAAAqE,MAAAA,GAAArE,QAAAiD,GAAAjD,EAAA,MAAAqH,GAEN2C,EAAA/G,GAEGoH,EAAAG,EAAA,CAAAL,SAAA,CAAAtD,EAACU,OACAtE,EAAK2B,MAAAD,EAAA8F,IACH5D,EAAAO,GAEOzC,CAAAA,KAAGA,EACE0C,YACMhD,mBAHZoG,QAOZzK,MAAAqE,EAAArE,MAAAiD,EAAAjD,MAAAqH,EAAArH,MAAAgK,GAAAA,EAAAhK,EAAA,IAAAA,EAAA+J,MAAAA,GAAA/J,QAAAgK,GAvBHC,EAACI,EAAAK,GAAY,CAAAC,MAAAvB,EACXW,SAAAA,CAAAA,EAUCC,KAaIhK,MAAA+J,EAAA/J,MAAAgK,EAAAhK,MAAAiK,GAAAA,EAAAjK,EAAA,IAIF,MAAA4K,EAAA,GAAG5C,KAAKC,IAAG4C,IAAAA,EAKfC,EACDC,EACMC,EAAA,OAPUhL,EAAAgI,MAAAA,GAAAhI,QAAAiI,GACT4C,EAAA,CAAAnI,SACK,WAAUmG,KACdb,EAACe,IACFd,GACNjI,MAAAgI,EAAAhI,MAAAiI,EAAAjI,MAAA6K,GAAAA,EAAA7K,EAAA,IAAAA,EAAA4K,MAAAA,GAAA5K,QAAA6K,GANHC,EAOEjE,EAAA,MALO,CAAA8D,MAAAE,GADFD,GAML5K,MAAA4K,EAAA5K,MAAA6K,EAAA7K,MAAA8K,GAAAA,EAAA9K,EAAA,IAAAiJ,EAAAA,MAAAA,GAAAjJ,QAAAiK,GAAAjK,EAAA,MAAA8K,GAzCJC,EAAClE,EAAAoE,GACqB9D,CAAAA,sBACbd,SACP6E,MAAA,EACUzE,UAAA,cACQwC,iBAA0BA,EAE1CkC,QAAAlB,EA2BFa,SAQFA,IAAU9K,MAAAiJ,EAAAjJ,MAAAiK,EAAAjK,MAAA8K,EAAA9K,MAAA+K,GAAAA,EAAA/K,EAAA,IAAAA,EAAAqH,MAAAA,GAAArH,QAAA+K,GA3CZC,EAACnE,EAAAuE,GAAkClD,CAAAA,qBAA+Bb,YAChE0D,SA2CFA,IAAgB/K,MAAAqH,EAAArH,MAAA+K,EAAA/K,MAAAgL,GAAAA,EAAAhL,EAAA,IA5ChBgL,CAAAA,ECpJSK,GAA0BvJ,EAAmD,MC2B1F,MAwBMwJ,GAAOC,GAAOC,GAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EA6ClBC,GAAUF,GAAOjB,GAAI;;;;;;;;;;EAYrBoB,GAAaH,GAAOC,GAAI;;;;;;;;;EAWxBG,GAAMJ,GAAOjB,GAAI;;;;;;EAQjBsB,GAASL,GAAOjB,GAAI;;;;;;;;;;;EA0B1B,MAAMuB,GAA8D9L,IAAAC,MAAAA,EAAAC,EAAA,KAClE6L,QAAAA,EAAAA,QAAAC,EAAAA,kBAAAC,EAAAA,KAAA7J,EAAAA,YAAA8J,EAAAA,UAAAC,GAA4EnM,GAE5EqI,SAAAA,EAAAA,QAAA+D,GAA4BpK,KAAW5B,IAAAA,EAAAgM,EAAAA,KAAAA,GAAAnM,OAAAmC,GACpBhC,EAAAgM,EAAQhK,GAAKnC,KAAAmM,EAAAnM,KAAAmC,EAAAnC,KAAAG,GAAAA,EAAAH,EAAA,GAAhC,MAAAwE,EAAmBrE,EAAaC,IAAAA,EAAAgI,EAAAA,KAAAA,GAAApI,OAAAmC,GACR/B,EAAAgI,EAASjG,GAAKnC,KAAAoI,EAAApI,KAAAmC,EAAAnC,KAAAI,GAAAA,EAAAJ,EAAA,GAAtC,MAAA+C,MAAAA,EAAAA,OAAAC,GAAwB5C,EAAcC,IAAAA,SAAA8B,GAEzB9B,EAAA,SAAU8B,EApBzB,SAA0BA,GAClB,MAAA/E,GAACA,EAAAA,KAAIsC,EAAAA,KAAM0M,EAAAA,QAAMC,EAAAA,KAASC,EAAAA,UAAMC,GAAapK,EAEnD,OAAOqK,GAAc,CACnBH,UACAE,YACAD,OACA5M,OACAtC,KACAgP,KAAMK,GAAgBC,GAAWC,WAAWP,KAEhD,CASgCQ,CAAiBzK,GAAQA,EAAI0K,KAAK7M,KAAAmC,EAAAnC,KAAAK,GAAAA,EAAAL,EAAA,GAAhE6M,MAAAA,EAAaxM,EAEbyM,ECpKK,WACL5P,MAAAA,EAAgB8E,EAAAqJ,IAAmC,IAE9CnO,EAAO+E,MAAAA,IAAAA,MACM,wCAGX/E,OAAAA,CAAO,CD6JW6P,GAAqBzM,IAAAA,EAAA0M,EAAA,CAGtC,KAAA,SAAU7K,GAAI,CAAGgC,OAAAA,EAAgB6I,MAAAA,CAAAA,CAAA9G,IAAAA,EAAAlG,OAAAmC,EAAA/E,IAAA4C,OAAA8M,GAChC5G,EAAA4G,EAAgBG,MAAApO,GAAoBA,EAAQqO,MAAS/K,EAAI/E,MAAIsD,MAAOV,EAAA,GAAAmC,EAAA/E,GAAA4C,KAAA8M,EAAA9M,MAAAkG,GAAAA,EAAAlG,EAAA,IAA3EM,EAAO4F,CAAAA,CAFT,MAAAxF,EAAcJ,EAGc4F,IAAAA,EAAAiH,EAAA,CAGpB,KAAA,SAAUhL,GAAI,CAAGgC,OAAAA,EAAgBgJ,MAAAA,CAAAA,CACnC,IAACpK,IAAUyB,EAAU,CAAEL,OAAAA,EAAgBgJ,MAAAA,CAAAA,CAC3C,MAAAzN,EAAaqD,EAAKqK,MAAA1N,KAMPkI,IAAEmE,EAAOvD,IAAAA,EAAAsD,EAAAA,MAAAA,GAAA9L,EAAA+C,MAAAA,GAAA/C,EAAAmC,MAAAA,GAAAnC,QAAAgD,GAAAhD,EAAA,MAAAwE,GAAAxE,EAAA,MAAA4H,GAAA5H,EAAA,MAAAN,GAJb8I,EAAA,CAAA7I,SACK6E,EAAUsH,UAAA/I,QAAAgJ,QAGXnE,EAASzF,OAAAa,SAAAtD,QAInBM,MAAA8L,EAAA9L,MAAA+C,EAAA/C,MAAAmC,EAAAnC,MAAAgD,EAAAhD,MAAAwE,EAAAxE,MAAA4H,EAAA5H,MAAAN,EAAAM,MAAAwI,GAAAA,EAAAxI,EAAA,IARDkG,EAAOsC,CAAAA,CALT,MAAA6E,EAAyBnH,EAgBzBoH,EAyGF,SAAAD,EAAArB,GAAAhM,MAAAA,EAAAC,EAAA,GAAAE,IAAAA,EAAA6M,EAAA,CAAA,IAKSK,EAAgB,CAAElJ,OAAAA,EAAgB6I,MAAAA,CAAAA,CAAA5M,IAAAA,EAAA,GAAAJ,EAAAqN,KAAAA,GAAArN,OAAAgM,EAAA,CACvCuB,MAAAA,EAAiBvB,IAAoBqB,GAAiB,IACjDE,EAAQ,CAAEpJ,OAAAA,EAAgB6I,MAAAA,CAAAA,CAE3BQ,GAzQCC,EAyQ8BF,GAAS,CACnCA,EAAAA,EAAQP,MAAAA,CAAAA,CAGTU,GAAAA,MAAAC,QAAcJ,GAAYA,EAAQ,CAAIA,IAAS3I,IAAAtD,IAKrDtB,KAAAqN,EAAArN,KAAAgM,EAAAhM,KAAAI,EAAAJ,KAAAG,CAAA,MAAAC,EAAAJ,EAAA,GAAAG,EAAAH,EAAA,GALKI,EAAAA,CAAAA,CATFD,OAAAA,CAekC,CA5HhByN,CAAoBP,EAAkBrB,GAAkBpE,IAAAA,UAAApD,GAEpEoD,EAAApD,GAAUjB,KACsCsD,EAAA,MAAA,CAA7BgH,wBAAA,CAAAC,OAAStJ,EAAUjB,UAEhDwK,GAAA,CAAA,GACF/N,MAAAwE,EAAAxE,MAAA4H,GAAAA,EAAA5H,EAAA,IAJD,MAAAuD,EAAaqE,EAIZY,IAAAA,EAQWU,EAkBPC,EAQmBC,EAAA,OAlCvBpJ,EAAA6M,MAAAA,GAAA7M,QAAAiM,GAIIzD,EAAAyD,IACER,GAAa,CAAAlB,IAAC,EAAiByD,gBAAG,+BAAA,EACjC7D,SAACtD,EAAAoH,GAAWpB,CAAAA,WAER,KAAA7M,MAAA6M,EAAA7M,MAAAiM,EAAAjM,MAAAwI,GAAAA,EAAAxI,EAAA,IAAAA,EAAAkM,MAAAA,GAAAlM,QAAAuD,GAAAvD,EAAA,MAAAU,GAEPwI,EAAAxI,GACCmG,EAAC8E,GAAS,CAAApB,IAAA,EAAkByD,gBAC1B7D,SAAAE,EAACuB,GAAY,CAAArB,IAAC,EAAW/D,UACtB0F,SAAAA,CAAAA,KACE1C,GAAA,CAAiB0E,YAAC,EACjB/D,SAACtD,EAAA6C,GAAA,CAAeyE,UAAA,cAAoBxE,KAAC,EACnCQ,SAACtD,EAAAuH,GAAA,CAAA,SAIN1E,GAAA,CAAWC,OAAIpG,SAAKA,MACpBmG,GAAW,CAAAC,OAAUS,OAAA,kBAEtB1J,SAGLV,MAAAkM,EAAAlM,MAAAuD,EAAAvD,MAAAU,EAAAV,MAAAkJ,GAAAA,EAAAlJ,EAAA,IAAAA,EAAAqN,MAAAA,GAAArN,QAAAsN,GAEAnE,EAAAuE,MAAAC,QAAcL,GACXA,EAAgB1I,KAAAwE,CAAAA,EAAAqB,KAAM,MAAArG,UAAA0D,EAAA/H,MAAAsO,GAAAjF,WAEjBtB,EAAiCwG,CAAAA,oBAAmBjB,KAAuBtN,KAAS,IAGzFuN,EAAgBtN,MAAAqN,EAAArN,MAAAsN,EAAAtN,MAAAmJ,GAAAA,EAAAnJ,EAAA,IAAAA,EAAAwI,MAAAA,GAAAxI,QAAAkJ,GAAAlJ,EAAA,MAAAmJ,GA/BtBC,EACGZ,EAAAA,EAAAA,CAAAA,SAAAA,CAAAA,EAMAU,EAkBAC,KAOAnJ,MAAAwI,EAAAxI,MAAAkJ,EAAAlJ,MAAAmJ,EAAAnJ,MAAAoJ,GAAAA,EAAApJ,EAAA,IAhCHoJ,CAAAA,EAoCSmF,GAAiBC,GAAK,SAAAzO,GAAAC,MAAAA,EAAAC,EAAA,KACjC8L,QAAAA,EAAAA,QAAA0C,EAAAA,KAAAC,EAAAA,kBAAAC,EAAAA,qBAAAC,GAA0E7O,EAE1E8O,EAAYC,EAAA,MAEZC,EAA4BD,GAAA,GAAa3O,IAAAA,EAI9B,MAAAC,EAAA,GAAGsO,EAAIM,MACN3O,EAAA,GAAGqO,EAAIO,MACJ3O,eAAaoO,EAAI1G,QAAS0G,EAAIzG,OAAO/B,IAAAA,EAAA9F,EAAAA,KAAAA,GAAAJ,OAAAK,GAAAL,EAAA,KAAAM,GAH3C4F,EAAA,CAAAnC,MACE3D,EAAa4I,OACZ3I,EAAa6O,UACV5O,GACZN,KAAAI,EAAAJ,KAAAK,EAAAL,KAAAM,EAAAN,KAAAkG,GAAAA,EAAAlG,EAAA,GAAAG,EAJM+F,EADT,MAAAyE,EAAcxK,EAOb,IAAAyH,EAAAY,EAAAxI,EAAA4O,KAAAA,GAAA5O,OAAA+L,GAAA/L,EAAA,KAAA2O,GAES/G,EAAAA,KAEN,IAACmH,EAAmBI,UACnBR,IACM,IAAP5C,GACA8C,EAAGM,SACHP,EAAoB,CAEpB,MAAA7N,EAAe8N,EAAGM,QAClBC,GAAeP,EAAGM,QAAA,CAAAE,SAAAzS,IAGU,IAAbgJ,EAAAA,QAKX7E,EAAMqO,eAAA,CAAAC,SACM,SAAQC,MACX,SAAQC,OACP,WACT,EAACC,WAEQ,YAAWF,MAChB,SAAQC,OACP,WACT,CAGHR,EAAmBI,SAA2B,IAAhBpD,CAAgB,EAC7CvD,EAACuD,CAAAA,EAAS4C,EAAmBC,GAAqB5O,KAAA4O,EAAA5O,KAAA+L,EAAA/L,KAAA2O,EAAA3O,KAAA4H,EAAA5H,KAAAwI,IAAAZ,EAAA5H,EAAA,GAAAwI,EAAAxI,EAAA,IA9BrDQ,EAAUoH,EA8BPY,GAIe,MAAAU,EAAA6C,EAAU,QAAE5H,EACZgF,EAAAsF,EAAU,QAAEtK,EAAYiF,IAAAA,EAIQC,EAAArJ,OAJRA,EAAAyO,KAAAA,GAAAzO,QAAAD,GAIrCqJ,EAAAqF,GAAY5H,EAAAgF,GAAA,IAAwB9L,IAASC,KAAAyO,EAAAzO,MAAAD,EAAAC,MAAAoJ,GAAAA,EAAApJ,EAAA,IAAAA,EAAA,MAAA2K,GAAA3K,EAAAkJ,MAAAA,GAAAlJ,EAAAmJ,MAAAA,GAAAnJ,QAAAoJ,GANhDC,EAACiC,EAAAA,IACe,eAAApC,EACA,eAAAC,EACT0F,MACElE,QAENvB,aACIpJ,MAAA2K,EAAA3K,MAAAkJ,EAAAlJ,MAAAmJ,EAAAnJ,MAAAoJ,EAAApJ,MAAAqJ,GAAAA,EAAArJ,EAAA,IAPPqJ,CAOO,IAIX,SAAA/H,GAAA8C,GAAA,MAc+B,iBAAdA,GAA0B,cAAeA,EAC3CA,EAAS,CAAAA,YAAArE,MAAA,CAAA,EAAA,CAOxB,MAAMkO,GAAOO,GAAK,SAAAzO,GAAA,MAAAC,EAAAC,EAAA,GAChBwP,EAAgBC,EAAAC,GAAAC,IAQhB/C,EAaF,SAAqBA,EAAc4C,GACjC,OAAOI,GAAQ,KACT,IACIC,MAAAA,EAAS,IAAIC,IAAIlD,SAAamD,SAAa,SAAc7L,EAAY6L,SAASC,QACpFH,OAAAA,EAAOI,aAAaC,IAAI,UAAWV,GAC5BK,EAAOM,UAAS,CACjB,MACCvD,OAAAA,CAAAA,IAER,CAACA,EAAM4C,GACZ,CAvBeY,CAAYtQ,EAAK8M,KAAO4C,GAAQtP,IAAAA,EAQ5BC,EAAAJ,OAR4BA,EAAA,KAAAmG,OAAAC,IAAA,8BAIzCjG,EAAC0G,EAAA6E,GAAoB,CAAAlF,UACnB2D,WAACT,GAAW,CAAAC,OAAUS,OAAA,SAASD,SAAA,qBAGpBnK,KAAAG,GAAAA,EAAAH,EAAA,GAAAA,OAAA6M,GALfzM,EAACyG,EAAA2C,GAAA,CAAO8G,GAAA,IAAUzD,OAAa9L,OAAA,SAAawP,IAAA,sBAC1CpQ,SAAAA,IAKIH,KAAA6M,EAAA7M,KAAAI,GAAAA,EAAAJ,EAAA,GANNI,CAMM,IAlBQ,SAAAuP,GAAAa,GAGZC,MAAAA,EAAAA,IAA6BD,IAC7BE,OAAAA,OAAAA,iBAAwB,WAAYD,GAAe,IACtC9O,OAAAgP,oBAA2B,WAAYF,EAAe,CALvD,SAAAb,KAAA,OAAAjO,OAAAqO,SAAAnD,IAAA,CE1TX,MAAM+D,GAERzQ,IAAAH,MAAAA,EAAAC,EAAA,IAAC4Q,cAAAA,GAAA1Q,EAKOC,EAAA,GAAGyQ,EAAa5I,MACf5H,EAAA,GAAGwQ,EAAa7I,MACf1H,EAAGuQ,EAAa7B,IAAb6B,KACF3K,EAAG2K,EAAa5B,IAAb4B,KAAuBjJ,IAAAA,EAAA5H,OAAAA,EAAA,KAAAI,GAAAJ,EAAAK,KAAAA,GAAAL,EAAAM,KAAAA,GAAAN,OAAAkG,GANtC0B,EAAAf,EAAA,OACS8D,MAAA,CAAAjI,SACK,WAAUqG,IACf3I,EAAsByI,KACrBxI,EAAsB0D,MACrBzD,EAA0B0I,OACzB9C,EAA0B4K,OAC1B,qBAAoBC,cACb,UAEZ/Q,KAAAI,EAAAJ,KAAAK,EAAAL,KAAAM,EAAAN,KAAAkG,EAAAlG,KAAA4H,GAAAA,EAAA5H,EAAA,GAVP4H,CAAAA,ECFJ,SAASoJ,GAAKC,EAAYC,EAAYrM,GAC7BoM,OAAAA,GAAM,EAAIpM,GAAKqM,EAAKrM,CAC7B,CAEO,MAAMsM,GAERA,EAAEC,yBACL,GAA2B,OAAvBA,EAA6B,OAIjC,IAAIpJ,EAAI,EACJC,EAAI,EACJlE,EAAQ,EACRiF,EAAS,EACb,MAAMqI,EAAmB,MAEzB,GAAa,gBARAD,GAAoBvI,MAAQuI,GAAoBtI,MAAQ,aAAe,YAQzD,CACnB,MAAAD,KAACA,EAAAA,MAAMC,GAASsI,EAEtBrN,GAAAA,EAAQuN,EAEJxI,GAASD,EAAM,CACX0I,MAAAA,EAAS1I,EAAK6F,KAAK1G,EAAIa,EAAK6F,KAAKM,EACjCwC,EAAO1I,EAAM4F,KAAK1G,EAElByJ,EADeC,KAAKC,IAAI7I,EAAM4F,KAAKO,EAAGpG,EAAK6F,KAAKO,GACxBoC,EAE1BL,EAAAA,GAAKO,EAAQC,EAAM,IAAOF,EAC9BrJ,EAAIY,EAAK6F,KAAKzG,EAAIwJ,EAElBzI,EAAS0I,KAAKC,IAAI7I,EAAM4F,KAAKO,EAAGpG,EAAK6F,KAAKO,GAAc,EAATwC,CAAS,MAAA,GAC/C3I,IAAUD,EAAM,CAEnB4I,MAAAA,EADe3I,EAAM4F,KAAKO,EACFoC,EAE9BrJ,EAAIc,EAAM4F,KAAK1G,EAAIsJ,EACnBrJ,EAAIa,EAAM4F,KAAKzG,EAAIwJ,EACnBzI,EAASF,EAAM4F,KAAKO,EAAa,EAATwC,CAAS,MAAA,GACxB5I,IAASC,EAAO,CAEnB2I,MAAAA,EADe5I,EAAK6F,KAAKO,EACDoC,EAE9BrJ,EAAIa,EAAK6F,KAAK1G,EAAIa,EAAK6F,KAAKM,EAAIsC,EAChCrJ,EAAIY,EAAK6F,KAAKzG,EAAIwJ,EAClBzI,EAASH,EAAK6F,KAAKO,EAAa,EAATwC,CAAS,CAClC,KACK,CACC,MAAA7I,OAACA,EAAAA,IAAQG,GAAOqI,EAEtB,GAAIxI,GAAUG,EAAK,CACjB,MAAMwI,EAASG,KAAKC,IAAI5I,EAAI2F,KAAK1G,EAAGY,EAAO8F,KAAK1G,GAC1C4J,EAAS7I,EAAI2F,KAAKzG,EAAIc,EAAI2F,KAAKO,EAC/B4C,EAAOjJ,EAAO8F,KAAKzG,EAEnBwJ,EADcC,KAAKC,IAAI/I,EAAO8F,KAAKM,EAAGjG,EAAI2F,KAAKM,GACxBqC,EAEpBC,EAAAA,EAETtJ,EAAIuJ,EAASE,EACbxJ,EAAI+I,GAAKY,EAAQC,EAAM,IAAOP,EAC9BvN,EAAQ2N,KAAKI,IAAIlJ,EAAO8F,KAAKM,EAAGjG,EAAI2F,KAAKM,GAAc,EAATyC,CAAS,MAAA,GAC9C7I,IAAWG,EAAK,CAEnB0I,MAAAA,EADc7I,EAAO8F,KAAKM,EACHqC,EAE7BrJ,EAAIY,EAAO8F,KAAK1G,EAAIyJ,EACpBxJ,EAAIW,EAAO8F,KAAKzG,EAAIqJ,EACpBvN,EAAQ6E,EAAO8F,KAAKM,EAAa,EAATyC,EACxBzI,EAASsI,CAAAA,MAAAA,GACAvI,IAAQH,EAAQ,CAEnB6I,MAAAA,EADc1I,EAAI2F,KAAKM,EACAqC,EAE7BrJ,EAAIe,EAAI2F,KAAK1G,EAAIyJ,EACjBxJ,EAAIc,EAAI2F,KAAKzG,EAAIc,EAAI2F,KAAKO,EAAIqC,EAC9BvN,EAAQgF,EAAI2F,KAAKM,EAAa,EAATyC,EACrBzI,EAASsI,CAAAA,CACX,CAIA,OAAAzK,EAAC,OACC8D,MAAO,CACLjI,SAAU,WACVqB,MAAO,GAAGA,MACViF,OAAQ,GAAGA,MACXkG,UAAW,aAAalH,QAAQC,OAChC8J,WAAY,UACZjB,OAAQ,kBACRkB,aAAc,QACdC,OAAQ,WAEX,EC7FC3G,GAAOC,GAAO2G,GAAAA;;;;;;;;;;eAgBL,EAAEC,eAAcC,SAAQC,aACnC,0CAA0CD,EAAS,sCAAsCC,EAAU,eAAeF;WAC3G,EAAEC,YAAY,GAAGA;YAChB,EAAEC,aAAa,GAAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EA6CvB,MAAMC,GAAkEnS,IAAAH,MAAAA,EAAAC,EAAA,KAACsS,SAAAA,GAAApS,EAC9EqS,EAAyBd,KAAAC,IAASY,EAAQhJ,SAAW5H,OAAA8Q,cACrDC,EAAoBH,EAAQvD,EAAKwD,EAAmBA,EAAmBD,EAAQvD,EAAM,EAErF2D,EAAgBJ,EAAQI,QAAWD,EACnCE,EAAgBL,EAAQK,QAAWF,EAEnCG,EAAoBC,KACpBC,EAAcC,KAEdC,EAAeF,EAAKE,QAfTC,EAeuBX,EAAQvD,EAffmE,IAAeC,OAAeC,IAAgBC,EAefP,EAAKE,OAAArN,WAnBjE,SAAesN,EAAgBvB,EAAaG,GAC1C,OAAOoB,EAASvB,EAAMA,EAAMuB,EAASpB,EAAMA,EAAMoB,CACnD,CAISK,EADkBL,EAASC,IAAUG,EAASD,IAAYD,EAAQD,GAASE,EAC7DA,EAAQC,KAF/B,IAAaJ,EAAgBC,EAAeC,EAAeC,EAAgBC,EAeUlT,IAAAA,EAAAJ,EAAA,KAAAuS,EAAAiB,YAEhEpT,EAAAmS,EAAQiB,WAAA9O,OAAApD,IAA8CtB,EAAA,GAAAuS,EAAAiB,WAAAxT,KAAAI,GAAAA,EAAAJ,EAAA,GAAzE,MAAAyT,EAAmBrT,EAAsDC,IAAAA,EAAAL,EAAA,KAAAuS,EAAAiB,YACvDnT,EAAAkS,EAAQiB,WAAA9O,OAAAiL,IAA8C3P,EAAA,GAAAuS,EAAAiB,WAAAxT,KAAAK,GAAAA,EAAAL,EAAA,GAAxE,MAAA0T,EAAkBrT,EAINC,EAAAiS,EAAQvD,EACP9I,EAAAqM,EAAQtD,EAUPrH,EAAAiL,EAAc,OAAS,QAGmBrK,SAAO+J,EAAQvD,KAAMuD,EAAQtD,IAAI/F,IAAAA,EAEjDC,EAS5BC,EAEAC,EACDQ,EAAA,OAd8E7J,EAAAyT,KAAAA,GAAAzT,OAAA0T,GAE9ExK,EAAA,IAAIuK,KAAeC,GAAU1T,KAAAyT,EAAAzT,KAAA0T,EAAA1T,KAAAkJ,GAAAA,EAAAlJ,EAAA,GAAAA,EAAA,KAAAkJ,GAAAlJ,EAAA,KAAA+S,EAAAY,MAAApB,SAAAqB,MAA7BzK,EAAAD,EAA6BtE,KAAAiP,CAAAA,EAAApJ,IAC5B5D,EAAA,OAEK,CAAAmB,EAAA8L,EAAC9L,EACDC,EAAA6L,EAAC7L,EACGlE,MAAA+P,EAAC9E,EACAhG,OAAA8K,EAAC7E,EACH8E,KAAAhB,EAAKY,MAAApB,SAAAqB,MALNnJ,KAOPzK,KAAAkJ,EAAAlJ,KAAA+S,EAAAY,MAAApB,SAAAqB,KAAA5T,KAAAmJ,GAAAA,EAAAnJ,EAAA,GAAAA,EAAAwI,MAAAA,GAAAxI,QAAAmJ,GAZNC,EAAAvC,EAAA,OAAesH,UAAA,+BACbhE,WAYM,MAAA,CAZSgE,UAAA,wBAAiC6F,QAAAxL,EAE7CW,SAAAA,MAWCnJ,MAAAwI,EAAAxI,MAAAmJ,EAAAnJ,MAAAoJ,GAAAA,EAAApJ,EAAA,IAAAiT,EAAAA,MAAAA,GAAAjT,QAAA4H,GAAA5H,EAAA,MAAAoJ,GArBRC,IAACmC,GACSyH,CAAAA,SACAgB,OAAC,EACAC,SAAA,SACJC,KAAA,cACGC,OAAAxM,EAERwB,SAAAA,IAeKpJ,MAAAiT,EAAAjT,MAAA4H,EAAA5H,MAAAoJ,EAAApJ,MAAAqJ,GAAAA,EAAArJ,EAAA,IAAAA,EAAA2S,MAAAA,GAAA3S,EAAA4S,MAAAA,GAAA5S,EAAA0S,MAAAA,GAAA1S,QAAAuS,EAAAtD,GAAAjP,EAAA,MAAAuS,EAAAvD,GAAAhP,EAAA,MAAAqJ,GA7BTQ,EAAChD,EAAAyE,GAAA,CACS8G,OAAA9R,EACC+R,QAAAnM,EACCyM,SAAMA,EACNC,SAAMA,EACFF,aAAUA,EAExBrJ,SAuBFA,IAAOrJ,MAAA2S,EAAA3S,MAAA4S,EAAA5S,MAAA0S,EAAA1S,EAAA,IAAAuS,EAAAtD,EAAAjP,EAAA,IAAAuS,EAAAvD,EAAAhP,MAAAqJ,EAAArJ,MAAA6J,GAAAA,EAAA7J,EAAA,IA9BP6J,CAAAA,EAhB2E,SAAAvI,GAAAwS,GAAA,MAYV,QAAdA,EAACO,OAAkB,CAZK,SAAA1E,GAAA2E,GAAA,MAaX,QAAdR,EAACO,OAAkB,CC7EzE,MAAM/I,GAAOC,GAAOC,GAAI;;;;EAMX+I,GAA0CA,KAAAvU,MAAAA,EAAAC,EAAA,GAAAE,IAAAA,EAEcC,EAAAJ,OAFdA,EAAA,KAAAmG,OAAAC,IAAA,8BAEJjG,EAAA,CAAA8R,OAAS,UAASjS,KAAAG,GAAAA,EAAAH,EAAA,GAAAA,EAAA,KAAAmG,OAAAC,IAAA,8BAAjEhG,EAACyG,EAAAyE,GAAc,CAAA9E,QAAA,EAAWyN,OAAA,EAAWhB,OAAA,EAAUtI,MAAAxK,EAC7CgK,WAACG,GAAW,CAAAkK,MAAA,SAAcjK,IAAC,EACzBJ,SAAA,GAACsK,GAAc,CAAAC,KAAA,CAAC,aACfhL,GAAA,CAAWC,KAAC,EAAEQ,SAAQ,eACtBwK,GACH,CAAA,QACK3U,KAAAI,GAAAA,EAAAJ,EAAA,GANPI,CAAAA,ECNSwU,GAAkBA,CAC7BC,EACAC,KAEM,MAAApV,KAACA,GAAQoV,EACf,OAAQpV,GACN,IAAK,mBACqBmV,OAAAA,EAAS5H,MAAM8H,GAAMA,EAAE3X,KAAO0X,EAAQ1X,KACpCyX,EAEnB,IACFA,EACH,CACEzX,GAAI0X,EAAQ1X,GACZ4X,WAAW,EACXlJ,QAASgJ,EAAQhJ,QACjBC,SAAS,EACT0C,SAAS,EACTC,KAAMoG,EAAQpG,KACduG,OAAQH,EAAQG,OAChBC,aAAcJ,EAAQI,eAI5B,IAAK,mBACH,OAAOL,EAASjQ,KAAKmQ,GACfA,EAAE3X,KAAO0X,EAAQ1X,GACZ,IAAI2X,EAAGC,WAAW,GAEpBD,IAEX,IAAK,iBACH,OAAOF,EAASjQ,KAAKmQ,GACfA,EAAE3X,KAAO0X,EAAQ1X,GACZ,IAAI2X,EAAGE,OAAQH,EAAQG,OAAQvG,KAAMoG,EAAQpG,MAE/CqG,IAGX,IAAK,qBACH,OAAOF,EAASnQ,QAAQqQ,GAAMA,EAAE3X,KAAO0X,EAAQ1X,KACjD,IAAK,qBACH,OAAOyX,EAASjQ,KAAKmQ,GACfA,EAAE3X,KAAO0X,EAAQ1X,GACZ,IAAI2X,EAAGC,WAAW,EAAOvG,SAAS,GAEpCsG,IAEX,IAAK,qBACH,OAAOF,EAASjQ,KAAKmQ,GACfA,EAAE3X,KAAO0X,EAAQ1X,GACZ,IAAI2X,EAAGrG,KAAMoG,EAAQpG,KAAMD,SAAS,GAEtC,IAAIsG,EAAGtG,SAAS,KAE3B,IAAK,qBACH,OAAOoG,EAASjQ,KAAKkH,GACfA,EAAQ1O,KAAO0X,EAAQ1X,GAClB,IAAI0O,EAAS2C,SAAS,GAExB3C,IAEX,IAAK,qBACH,OAAO+I,EAASjQ,KAAKkH,GACfA,EAAQ1O,KAAO0X,EAAQ1X,GAClB,IAAI0O,EAAS4C,KAAMoG,EAAQpG,MAE7B5C,IAEX,IAAK,gBACI+I,OAAAA,EAASjQ,KACPmQ,IAAA,IAAIA,EAAGhJ,QAASgJ,EAAE3X,KAAO0X,EAAQ1X,IAAM,cAElD,IAAK,eAIL,IAAK,oBACIyX,OAAAA,EAASjQ,KACPmQ,IAAA,IAAIA,EAAGhJ,SAAS,MAE3B,IAAK,qBAAsB,CAIzB,MAAMoJ,EAAiBN,EAAS5H,MAAY8H,GAAc,YAAdA,EAAEhJ,UACvC8I,OAAAA,EAASjQ,KAAWmQ,IAEzB,MAAMhJ,EACJ,SAAUgJ,EAAEE,QACZF,EAAEE,OAAO7X,KAAO0X,EAAQ5V,KAAK9B,IAC7B2X,EAAEE,OAAO7I,OAAS0I,EAAQ5V,KAAKkN,KAIjC,OAAI+I,GAAkBJ,IAAMI,GAAkBpJ,EACrCgJ,EAGF,IACFA,EAGHhJ,QAASA,GAAWoJ,EAAiB,YAAcpJ,EACrD,GACD,CAEH,QACS8I,OAAAA,EAAAA,ECnFGO,SAAAA,GACdC,EACAP,GAEM,MAAApV,KAACA,GAAQoV,EACX,IAAAQ,YACFA,EAAAA,UACAC,EAAAA,YACAC,EAAAA,WACAC,EAAAA,mBACArE,EAAAA,gBACAsE,EAAAA,sBACAC,EAAAA,aACAC,EAAAA,sBACAC,EAAAA,cACAhF,GACEwE,EACA1G,GAAoB,EAExB,GAAa,uBAATjP,EAA+B,CACjC,MAAMoW,EAAgBT,EAAME,UAE5BA,EAAYT,EAAQ5V,KAAKkN,KAErB0J,IAAkBP,IACpB5G,EAAoBmH,EAAcC,MAAMR,EAAU3P,QAAQoQ,WAAW,KAAG,CAIxEtW,MAAS,6BAATA,IACF8V,EAAcV,EAAQ5V,KAAKsW,aAGhB,wBAAT9V,IAEA4V,EADE,WAAYR,EACA,CAAC3S,KAAM2S,EAAQG,OAAQvS,SAAUoS,EAAQpS,UAEzC,OAKP,kBAAThD,GACS,uBAATA,GACS,iBAATA,GACS,sBAATA,GACS,uBAATA,KAEA4V,EAAc,MAGH,qCAAT5V,IACF0R,EAAqB0D,EAAQmB,gBAGlB,sBAATvW,IACF+V,GAAa,GAGM,+BAAjBX,EAAQpV,OACVkW,EAAed,EAAQvC,UAGZ,oBAAT7S,IACF+V,GAAa,GAGM,oCAAjBX,EAAQpV,OACViW,EAAwBb,EAAQoB,SAGrB,uCAATxW,IACFmW,GAAwB,GAGb,qCAATnW,IACFmW,GAAwB,GAGb,gCAATnW,IACFmR,EAAgBiE,EAAQqB,WAGb,8BAATzW,IACFgW,EAAkBZ,EAAQoB,SAGrB,IACFb,EACHC,cACAT,SAAUD,GAAgBS,EAAMR,SAAUC,GAC1C1D,qBACAwE,eACA/E,gBACA4E,aACAF,YACAC,cACA7G,oBACA+G,kBACAC,wBACAE,wBAEJ,CClIaO,MAAAA,GAIT,SAAArW,GAAAC,MAAAA,EAAAC,EAAA,IACFzB,QAAAA,EAAAA,SAAA2L,GAA4BpK,EAAKI,IAAAA,EAAAH,EAAA,KAAAmG,OAAAC,IAAA,8BAEsDjG,EAAA,GAAEH,KAAAG,GAAAA,EAAAH,EAAA,GAAzF,MAAA8M,EAAAuJ,GAAgDlO,EAAuChI,GAAG,IAAAC,EAAAC,EAM7EC,SAN6E9B,GAEhF4B,EAAAA,IACD5B,GAAOT,GAAK,kCAAgCmB,IACjDmX,EAAoBnX,EAAIoX,UAAU,IAEnCjW,GAAC7B,GAAQwB,KAAAxB,EAAAwB,KAAAI,EAAAJ,KAAAK,IAAAD,EAAAJ,EAAA,GAAAK,EAAAL,EAAA,IAJZQ,EAAUJ,EAIPC,GAEyDyM,EAAAA,EAA5D,MAAA5P,EAAgBoD,EAAiF4F,IAAAA,EAAA,OAAAlG,EAAAmK,KAAAA,GAAAnK,OAAA9C,GAE/FgJ,EAAAW,EAAAwE,GAAAkL,SAAA,CAAyCrZ,MAAAA,EAAUiN,aAA4CnK,KAAAmK,EAAAnK,KAAA9C,EAAA8C,KAAAkG,GAAAA,EAAAlG,EAAA,GAA/FkG,CAA+F,ECKnG,SAASsQ,GAAarU,GACpB,MAAO,SAAUA,CACnB,CAEA,SAASsU,GAAqB/W,GAC5B,MAAqB,aAAdA,EAAKA,IACd,CAEA,SAASgX,GAAiBhX,GACxB,MAAqB,SAAdA,EAAKA,IACd,CA2BaiX,MAAAA,GAKT,SAAA5W,GAAAC,MAAAA,EAAAC,EAAA,KACFzB,QAAAA,EAAAA,SAAA2L,EAAAA,SAAA0K,GAAsC9U,EAAKI,IAAAA,EAAAH,EAAA,KAAAmG,OAAAC,IAAA,8BAE+BjG,EAAAyW,IAAAA,IAAS5W,KAAAG,GAAAA,EAAAH,EAAA,GAAnF,MAAA6W,EAAAC,GAA0C3O,EAAgChI,IAE1E4W,EAAAC,GAA4B7O,QAAmC/H,IAAAA,EAAAJ,OAAAxB,GAG7D4B,QAAAxB,IACOJ,GAAAA,EAAO,IAEV,MAAAyY,QAAuBzY,EAAOM,MAAO,6BAAuBqF,EAAA,CAAAvF,SAAAsY,kBAAA,IAI5DF,EAAUC,EAAQF,QAAQ,MACnBhC,GAIV/U,KAAAxB,EAAAwB,KAAAI,GAAAA,EAAAJ,EAAA,GAbH,MAAAmX,EAAoB/W,EAenB,IAAAC,EAAAC,EAKgB4F,EALhBlG,OAAAmX,GACS9W,EAAAA,KACR+W,MAAAA,MAAAC,gBACAF,OAAAA,EAAYC,EAAUxY,QAAQ,IACjBwY,EAAUE,OAAO,EAC7BhX,GAAC6W,GAAYnX,KAAAmX,EAAAnX,KAAAK,EAAAL,KAAAM,IAAAD,EAAAL,EAAA,GAAAM,EAAAN,EAAA,IAJhBQ,EAAUH,EAIPC,GAAcN,EAAA,KAAAmG,OAAAC,IAAA,8BAEiCF,EAAA,GAAElG,KAAAkG,GAAAA,EAAAlG,EAAA,GAApDuX,MAAAA,EAAyBzI,EAAyB5I,GAAG,IAAA0B,EAAAY,EAgC9BU,EAhC8B1K,EAAAA,KAAAA,GAAAwB,OAAA6U,GAE3CjN,EAAAA,KAIR4P,MAgBAC,MAAAJ,gBACAK,EAtEJ,SAAqC7C,GACnC,OAAOA,EAAS8C,QAAO,CAACC,EAAK9L,KACrB,MAAAmJ,OAACA,GAAUnJ,EACb,KAAE,OAAQmJ,KACTA,EAAO7I,KAAKyL,SAAS,WAAmBD,OAAAA,EACvCxL,MAAAA,EAjBV,SAAgCA,GAC9B,OAAOA,EACJ0L,MAAM,KACNC,aACAJ,QAAO,CAACC,EAAKI,IACRJ,EAAIhS,OAAe,CAACoS,KAASJ,GAC7BI,EAAKH,SAAS,WAAmB,CAACG,GAC/B,IACN,IACFC,KAAK,IACV,CAOiBC,CAAuBjD,EAAO7I,MAC3C,OAAKwL,EAAI3K,MAAetI,GAAAA,EAAKvH,KAAO6X,EAAO7X,IAAMuH,EAAKyH,OAASA,KAC7DwL,EAAI1U,KAAK,CAAC9F,GAAI6X,EAAO7X,GAAIgP,SAEpBwL,CAAAA,GACN,GACL,CA2DkBO,CAA4BtD,GAExCuD,OAAAA,EAAKnU,MAAAoU,IACKd,EAAgBpI,QAAAlC,MAAA9D,IAAe,MAAA/L,GAAAA,EAAAA,KAAAgP,GAAAjD,EAAU,OAAK/L,IAAOib,EAACjb,IAAOgP,IAASiM,EAACjM,IAAAA,OApBnFzN,OAAAyZ,EAAAE,KACM,GAACF,EAAKxS,QAAYpH,EAAO,IAE3B,MAAA+Z,QAAuB/Z,EAAOM,MAC5B,oCAAmC,CAAAsZ,SAAA,CAAAxZ,OAElCA,EAAMsY,kBAAA,IAETJ,EAAiBG,EAAQta,OACzB4a,EAAgBpI,QAAWiJ,EAAK,MACzBrD,GAaTyC,CAAYY,EAAOhB,EAAUxY,QAAQ,IAE1BwY,EAAUE,OAAO,EAC7B9O,EAAA,CAAChK,EAASqW,GAAS7U,KAAAxB,EAAAwB,KAAA6U,EAAA7U,KAAA4H,EAAA5H,MAAAwI,IAAAZ,EAAA5H,EAAA,GAAAwI,EAAAxI,EAAA,KA9BtBQ,EAAUoH,EA8BPY,GAAoBxI,QAAA+W,GAGrB7N,EAAAA,CAAA/G,EAAAqW,KAIE,MAAA9Y,EAAa8Y,GAAS,WAAU,IAE7BzB,GACgB,iBAAT5U,KAAuBqU,GAAarU,KAAUuL,MAAAC,QAAcoJ,IAAS,OAI/ErT,MAAAA,EAA6B,iBAATvB,EAAoBA,EAAOA,EAAIzC,KACnDgF,EAAwB,aAAThF,EAAmB+W,GAAAC,GAC3BK,OAAAA,EAAMrS,OACHA,GAAOuI,MACOzI,GAAAA,EAAUd,OAAUA,GAAI,EAGjD1D,MAAA+W,EAAA/W,MAAAkJ,GAAAA,EAAAlJ,EAAA,IAnBH,MAAAmM,EAAgBjD,EAqBfC,IAAAA,EAAAgD,EAAAA,MAAAA,GAAAnM,QAAA6W,GAGC1N,EAAAsP,IAMOjC,IAAAA,GAAarU,GAAK,MAAA,CAAAY,WAAAoB,EAAAnB,YAAAmB,GAOvBuU,MAAAA,EAAmBvM,EAAQhK,GAAK,IAE3BqC,EAAU,MAAA,CAAAzB,WAAAoB,EAAAnB,YAAAmB,GAgEf,MAAAwU,EAAiBxW,EAAIiK,KAAA0L,MAAY,KAAIc,QAAAtX,IAKnC,IAGOuX,OAlET,SAAAA,EAAAC,EAAAC,EAAA/V,EAAAoG,GAIE,MAAA4P,OAAuB7U,IAAvBiF,KAAAA,EAAuB,IAKlB5E,EAAU,MAAA,CAAAzB,WAAAoB,EAAAnB,YAAAmB,GAIf,MAAA8U,KAAAC,GAAwB9M,EAAI,GAExB,WAAY5H,EAAU,CACxB2U,MAAAA,EAAoB3U,EAAU4U,OAAQH,GAClC,IAACE,GAAe,SAAU3U,EAAU,OAC/BqU,EAAcrU,EAAU0U,KAAO9M,EAAM5H,EAAYwU,GAAS,IAE9DE,EAAItT,OAAA,MAAA,CAAA7C,MACQoW,EAAWnW,UAAA,IAEvBmW,EAAW,MAAA,IAAAlX,MAEZ,iEAAiE,IAAI+W,KAAa5M,GAAI6L,KAAO,SAG1FY,OAAAA,EAAcM,EAAW/L,MAAQ8L,EAAM1U,EAAgBwU,IAAAA,EAAUC,GAAK,CAAC,GACjD,UAApBzU,EAAU9E,KAAiB,OAC7BmZ,EAAcrU,EAAUC,GAAK2H,EAAM5H,EAAYwU,GAAS,GAClC,cAApBxU,EAAU9E,KAAqB,OACnCwZ,EAAItT,OACFiT,EAAcrU,EAAU4I,MAAQ8L,EAAM1U,EAAgBwU,IAAAA,EAAUC,IAD9D,CAAAlW,MAAwByB,EAAUxB,UAElCwB,GAAoB,UAApBA,EAAU9E,KAAiB,CACpC2Z,MAAAA,EAAaJ,EAAIjD,WAAY,WACzBa,GAAayC,IACJnX,EAAI/E,KAAAkc,IACL,CAACN,EAAQf,KAAM,KAAMgB,GAAIvU,OAAA6U,SAAiBtB,KAAM,KACxDgB,EACGJ,OAAAA,EACLrU,EAAUC,GAAAwI,MAAoBtI,GAAc,gBAAdA,EAAIjF,KAA0BiF,EAAIjB,OAAUA,EAAOiB,IACjFuU,EACA1U,EACIwU,IAAAA,EAAUC,GAChB,CAAC,GAC4B,gBAApBzU,EAAU9E,KAAuB,OACrCuZ,EACEJ,EAAcrU,EAAU4I,MAAQhB,EAAM5H,EAAYwU,GADhD,CAAAjW,MAAiByB,EAAUxB,UAE3BwB,GAAoB,WAApBA,EAAU9E,KAC0B,OACtCmZ,EADM1M,EAAQ3H,EAAUd,KAAO,QACZ0J,MAAuBhB,EAAM5H,EAAYwU,GAAS,MAAA,IAAA/W,MAG5E,iEAAiE,IAAI+W,KAAa5M,GAAI6L,KAAO,QAAO,CAY/FY,CAAcrU,EAAYmU,OAAQxU,SAAYkF,GAC9C0L,MAAAA,EAAAA,EAAC,OAEJA,aAAC9S,OAAmBuX,QAAAC,KAAa1E,EAACD,SAAS,CAAA/R,WAAAoB,EAAAnB,YAAAmB,EAAA,GAGlDnE,MAAAmM,EAAAnM,MAAA6W,EAAA7W,MAAAmJ,GAAAA,EAAAnJ,EAAA,IA9FH,MAAAoI,EAAiBe,EAgGhB,IAAAC,EAAAC,EAOuBQ,EAPvB7J,QAAA+W,GAOW1N,EAAA0N,GAAY,GAAA/W,MAAA+W,EAAA/W,MAAAqJ,GAAAA,EAAArJ,EAAA,IAAAA,EAAA,MAAAoI,GAAApI,EAAAmM,MAAAA,GAAAnM,EAAA6W,MAAAA,GAAA7W,QAAAqJ,GAJfQ,EAAA,CAAAzB,WAAA+D,UAAA0K,gBAAAE,OAIG1N,GACTrJ,MAAAoI,EAAApI,MAAAmM,EAAAnM,MAAA6W,EAAA7W,MAAAqJ,EAAArJ,MAAA6J,GAAAA,EAAA7J,EAAA,IAAAoJ,EALMS,EADT,MAAA3M,EAAgBkM,EAQfU,IAAAA,EAAA,OAAA9J,EAAAmK,MAAAA,GAAAnK,QAAA9C,GACM4M,EAAAjD,EAAAhF,GAAA0U,SAAA,CAA+BrZ,MAAAA,EAAUiN,aAAkCnK,MAAAmK,EAAAnK,MAAA9C,EAAA8C,MAAA8J,GAAAA,EAAA9J,EAAA,IAA3E8J,CAA2E,EAjMhF,SAAAxI,GAAA0W,GAuKQA,OAAAA,EAAIH,SAAU,KACTG,EAAIF,MAAA,WAAA,GAAqB,CAE1BE,EAAI,CCzOpB,MAeM0B,GAfeC,CAAqCA,IACxD,IAAItE,EAAQsE,EACZ,MACMC,MAAgBC,IASf,MAAA,CAACC,SAVSA,IAAMzE,EAUL0E,SAR0DC,IAClEA,EAAAA,EAAG3E,GACXuE,EAAUK,SAASC,GAAMA,KAAG,EAMFzZ,cAH1BmZ,EAAUO,IAAIC,GACP,IAAMR,EAAUS,OAAOD,IAEK,EAGzBE,CAAY,IAEbC,GAITxa,IAAAC,MAAAA,EAAAC,EAAA,KACFzB,QAAAA,EAAAA,SAAA2L,GAA4BpK,EAAK,IAAAI,EAAAC,EAYpBC,EAAAC,EAmBA4F,EAAA0B,EA/BoB5H,OAAAxB,GAEvB2B,EAAAA,IACD3B,GAAOT,GAAK,4BAA2BuD,IAS7ClB,GAAC5B,GAAQwB,KAAAxB,EAAAwB,KAAAG,EAAAH,KAAAI,IAAAD,EAAAH,EAAA,GAAAI,EAAAJ,EAAA,IAVZQ,EAAUL,EAUPC,GAAUJ,OAAAxB,GAEH6B,EAAAA,MASRvB,iBAPE,MAAAsO,QAAoB5O,GAAOM,MAAQ,mCAA6BqF,EAAA,CAAA+S,kBAAA,KAG5D9J,GACFsM,GAAAK,UAAA,IAAqB3M,EAAKiI,OAAM,EAGpCvW,GAAO0b,MAAA7K,GAON,EACArP,GAAC9B,GAAQwB,KAAAxB,EAAAwB,KAAAK,EAAAL,KAAAM,IAAAD,EAAAL,EAAA,GAAAM,EAAAN,EAAA,IAjBZQ,EAAUH,EAiBPC,UAAU9B,GAEgBoJ,EAAA,CAAApJ,UAAAkb,UAAgB1Z,KAAAxB,EAAAwB,KAAA4H,GAAAA,EAAA5H,EAAA,GAAAkG,EAAhB0B,EAA7B,MAAA6S,EAAcvU,EAA4CsC,IAAAA,EAAA,OAAAxI,EAAAmK,KAAAA,GAAAnK,OAAAya,GAEnDjS,EAAA3B,EAAA6T,GAAAnE,SAAA,CAAoCnJ,MAAAA,EAAQjD,aAAuCnK,KAAAmK,EAAAnK,KAAAya,EAAAza,MAAAwI,GAAAA,EAAAxI,EAAA,IAAnFwI,CAAAA,EApCL,SAAAlH,GAAApC,GAKM,UAAWA,EACbwa,GAAAK,UAAAY,IAAA,IAA8BA,EAAI,CAAGzb,EAAI0b,KAAO1b,EAAIkO,UAEpDsM,GAAAK,UACSc,GAAAA,OAAAC,YAAmBD,OAAAE,QAAeJ,GAAKjW,QAAAvE,IAASya,MAAAA,GAAAza,EAAK,OAAKya,IAAQ1b,EAAI0b,GAAAA,MAC7E,CAVN,SAAAjL,GAAAqL,GA0BExB,QAAAyB,MAAcD,GAEdxB,QAAAC,KACE,qHACD,CCpDA,SAAAnY,KAAA,CCYA,SAAAsO,GAAAsL,GAAA,OAsC8CnG,EAAC3X,EAAA,CAtC/C,SAAAuS,GAAAwL,GAAA,QAoCgBA,CAAC,CApCjB,SAAA7Z,GAAAyT,GA6BC,MAAAE,OAAAA,GAAiBF,EAAC,MACZ,OAAQE,EAAM,IAEfA,EAAM7X,GACL,YAAa6X,EAAS,GAAAmG,KAAmBnG,EAAM7X,KAAQ6X,EAAM7X,IAH/C,IAGkD,CCH9E,MAAMkO,GAAOC,GAAO2G,GAAAA;;;;;;;;aAUP,EAAEmJ,aAAaA,GAAW;EAGvC,SAASC,GAAKtB,GACZ,IAAIuB,EACAC,EAEJD,OAAAA,EAAKE,uBAAsB,KACzBD,EAAKC,sBAAsBzB,EAAE,IAGxB,UACM7V,IAAPoX,GAAkBG,qBAAqBH,QAChCpX,IAAPqX,GAAkBE,qBAAqBF,EAAE,CAEjD,CAEA,MAAMG,GAGD5b,IAAAC,MAAAA,EAAAC,EAAA,IACH2b,YAAAA,GAAsB7b,EAAKI,IAAAA,EAAAH,EAAA,KAAAmG,OAAAC,IAAA,8BAC0BjG,EAAA,GAAEH,KAAAG,GAAAA,EAAAH,EAAA,GAAvD,MAAA6b,EAAAC,GAAkC3T,EAAmBhI,GAAG,IAAAC,EAAAC,EAAAL,OAAA4b,GAE9Cxb,EAAAA,KACR0b,GAAYnB,IACV,MAAA1B,EAAavL,MAAAkG,SAAAiG,IAAmB+B,IACzBjB,OAAAA,EAAI/U,SAAYqT,EAAIrT,QAC0D,IAAnF+U,EAAIhD,OAAArW,GAA4D2X,IAAKrT,OACnE+U,EACA1B,CAAAA,GACL,EACA5Y,GAACub,GAAY5b,KAAA4b,EAAA5b,KAAAI,EAAAJ,KAAAK,IAAAD,EAAAJ,EAAA,GAAAK,EAAAL,EAAA,IARhBQ,EAAUJ,EAQPC,GAEH,MAAA0b,EAAcC,IAAoB,IAAA1b,EAAA4F,EAAAlG,OAAAA,EAAA+b,KAAAA,GAAA/b,OAAA6b,GAExBvb,EAAAA,KAAA,IAAA,MACH2b,KAAYJ,EACfE,EAAKG,KAAA,CAAAxc,KAAa,UAASrC,WAAc8e,EAAW/e,KACpD2e,EAAKG,KAAA,CAAAxc,KAAa,UAASrC,WAAc+e,EAAehf,KAAK,MAAA,KAAA,IAAA,MAGxDif,KAAYR,EACfE,EAAKG,KAAA,CAAAxc,KAAa,YAAWrC,WAAc8e,EAAW/e,KACtD2e,EAAKG,KAAA,CAAAxc,KAAa,YAAWrC,WAAc+e,EAAehf,IAAI,CAAC,EAGlE8I,EAAA,CAAC6V,EAAOF,GAAU7b,KAAA+b,EAAA/b,KAAA6b,EAAA7b,KAAAM,EAAAN,KAAAkG,IAAA5F,EAAAN,EAAA,GAAAkG,EAAAlG,EAAA,IAXrBQ,EAAUF,EAWP4F,GAAmB,IAAA,EAKlBoW,GAODvc,IAAAC,MAAAA,EAAAC,EAAA,KACHzB,QAAAA,EAAAA,SAAA+d,EAAAA,QAAAC,EAAAA,OAAAC,EAAAA,eAAAC,EAAAA,YAAAC,GAA0E5c,GAC1E6c,qBAAAA,GnB9FK,WAAA5c,MAAAA,EAAAC,EAAA,IAGLoI,YAAAA,GAAsBC,IAAc,IAAAnI,EAAAC,EAAAJ,OAAAqI,GAE1BlI,EAAAA,KACR0c,MAAAA,EAAA9H,IACE,MAAAkB,eAAAA,EAAAA,OAAAlV,EAAAA,qBAAA+b,GAAuD/H,EAACtT,OAEpDqb,GAAAA,EAAoB,OAExBC,MAAAA,EAvBN,SAA2Cra,GACzC,GAAIA,EAAU,CACN,MAAAqG,IAACA,EAAAA,MAAKD,EAAAA,OAAOF,EAAAA,KAAQC,GAAQnG,EACnC,GAAImG,GAAQE,EACH,MAAA,CAAC5G,MAAO0G,GAAQE,GAAMkM,OAAQvS,SAAU,SAC1C,GAAIoG,GAASF,EACX,MAAA,CAACzG,MAAO2G,GAASF,GAASqM,OAAQvS,SAAU,SAAiB,CAI1E,CAawBsa,CAAkC/G,GAAe,GAC/D8G,EAAS,CACX,MAAA3a,EAAYiG,EAAYtH,EAAM3D,KAI9B+E,KAAAA,EAAAA,SAAAO,GAAyBqa,GAEzBnC,IAAAqC,EAAAA,eAAAC,GAAyCC,EAA6Bpc,IAEtEqL,KAAAgR,EAAAxC,IAAAyC,GAAiDF,EAA6Bhb,GAG1Eib,GAAaC,GAAoBA,IAAqBJ,GACxD7a,EAAGC,OAAA1D,MAAA0B,IAAc,MAAAiC,YAAAA,GAAAjC,EACfxB,QAAuByD,IAGvBgb,EAAqBC,EAAY1e,EAAUkC,EAAMqL,MAAM,OAEnD8Q,EAAc,CAGdM,EAAGJ,EAAWK,EAAA,CAAAC,KAAcT,KAE5BO,EAAGJ,EAAWO,EAAOL,EAAc5a,EAAQ,CAAAgb,KAASL,MAAmB,CAMvEG,EAAGJ,EAAWK,IAASR,IAEvBO,EACEJ,EACAO,EACEL,EACA5a,EAEA2a,EAAmBJ,IAAcI,EAAgB,IAASA,IAE7D,GAGN,GAIP1b,OAAAA,OAAA+O,iBAAwB,iBAAkBmM,GAAyB,KAEjElM,OAAAA,oBAA2B,iBAAkBkM,EAAwB,CAAC,EAEvEzc,GAACiI,GAAYrI,KAAAqI,EAAArI,KAAAG,EAAAH,KAAAI,IAAAD,EAAAH,EAAA,GAAAI,EAAAJ,EAAA,IA1DhBQ,EAAUL,EA0DPC,GAEH,MAAAwc,EAAAtb,GAMMjB,IAAAA,EAAA,OAAAL,EAAA,KAAAmG,OAAAC,IAAA,8BAEC/F,EAAA,CAAAuc,wBAAsB5c,KAAAK,GAAAA,EAAAL,EAAA,GAAtBK,CAAsB,CmBqBEud,GAAkBzd,IAAAA,EAAAH,EAAA,KAAAxB,GAAAwB,EAAAuc,KAAAA,GAAAvc,EAAA4c,KAAAA,GAAA5c,OAAAyc,GAG/Ctc,EAAA2U,IACMA,GAAiB,kBAAjBA,EAAOpV,KAAyB,CAClC,MAAAuV,OAAAA,GAAiBH,EACVzV,GAAAA,KAAO,uBAAwB4V,EAAM,MAAA,GAClB,qBAAjBH,EAAOpV,KAChBlB,GAAOa,KAAO,wBAAuB,CAAAwe,SAAA,SAAA,GACX,uBAAjB/I,EAAOpV,KAChBlB,GAAOa,KAAO,wBAAuB,CAAAwe,SAAA,SAC5B/I,GAAiB,oBAAjBA,EAAOpV,KAA2B,CAC3C,MAAAuW,eAAAA,EAAAA,OAAAlV,EAAAA,UAAA+c,EAAAA,KAAAC,EAAAA,qBAAAjB,GAAwEhI,EACpD8H,EAAA,CAAA3G,iBAAAlV,SAAA+c,YAAAC,OAAAjB,wBAAgE,KAAA,IAC1D,qCAAjBhI,EAAOpV,KACY,YAArBoV,EAAAA,EAAO9M,EAAI8M,EAAO7M,GAAG,GAGF,sBAAjB6M,EAAOpV,KAA6B,CAC7C,MAAAoM,QAAAA,EAAAA,OAAAkS,GAA0BlJ,EAEtBkJ,EACFlS,EAAOnB,MAAAqT,OAAgBA,EAEvBlS,EAAOnB,MAAAsT,eAAsB,SAAQ,EAIzC1B,EAASzH,EAAO,EACjB9U,KAAAxB,EAAAwB,KAAAuc,EAAAvc,KAAA4c,EAAA5c,KAAAyc,EAAAzc,KAAAG,GAAAA,EAAAH,EAAA,GAIH,MAAAoX,EC7IK8G,SAAApS,EAAA+Q,EAAAL,GAAAxc,MAAAA,EAAAC,EAAA,GAKLke,EAA0BrP,IAE1BsP,EAA6BC,IAAyB,IAAAle,EAAAC,EAAA,OAAAJ,EAAA,KAAA8L,GAAA9L,EAAA6c,KAAAA,GAAA7c,EAAAwc,KAAAA,GAAAxc,OAAAoe,GAE5Cje,EAAAA,KACH2L,GAAAA,EAELqS,OAAAA,EAAiBhP,QAAWmP,GAAA,CAAAzB,UAAA0B,eAEVzS,EAAO0Q,UAAA4B,yBAGvB,KAGAD,EAAiBhP,SAAAqP,UACjBL,EAAiBhP,aAAAhL,CAAAA,CAAA,EAElB/D,GAAC0L,EAAS+Q,EAASL,EAAS4B,GAAqBpe,KAAA8L,EAAA9L,KAAA6c,EAAA7c,KAAAwc,EAAAxc,KAAAoe,EAAApe,KAAAG,EAAAH,KAAAI,IAAAD,EAAAH,EAAA,GAAAI,EAAAJ,EAAA,IAdpDQ,EAAUL,EAcPC,GAEI+d,CAAiB,CDoHLD,CAAcvB,EA/BgBxc,EA+BkBqc,GAAQpc,IAAAA,EAQ1EC,EAAA,cAR0E+W,EAAAjI,SAAAnP,OAAA0c,GAEjEtc,EAAAA,KACJsc,EACFtF,EAAUjI,SAAAsP,WAEVrH,EAAUjI,SAAAuP,YAAA,EAEb1e,EAAA,GAAAoX,EAAAjI,QAAAnP,KAAA0c,EAAA1c,KAAAI,GAAAA,EAAAJ,EAAA,GAAAA,EAAAoX,KAAAA,GAAApX,OAAA0c,GAAErc,EAAA,CAAC+W,EAAYsF,GAAe1c,KAAAoX,EAAApX,KAAA0c,EAAA1c,MAAAK,GAAAA,EAAAL,EAAA,IAN/BQ,EAAUJ,EAMPC,GAA6B,IAAA,EAQrBse,GAKR5e,IAAAC,MAAAA,EAAAC,EAAA,KACHzB,QAAAA,EAAAwN,kBAAA4S,EAAAA,QAAApC,EAAAA,OAAAvK,GAA0ElS,GAE1E8e,EAAAC,GAA4B3W,IAE5B0K,EAAoBC,KAAgB3S,IAAAA,EAAAH,EAAA,KAAAmG,OAAAC,IAAA,8BAiBAjG,EAAA,CAAAmV,YAAA,KAAAlE,mBAAA,KAAAsE,iBAAA,EAAAC,uBAAA,EAAAC,aAAA,KAAAf,SAAA,GAAAU,UAOvB,GAAEE,YAAA,EAAAD,YAEA,YAAW7G,mBAAA,EAAAkH,uBAAA,EAAAhF,cAAA,MAIzB7Q,KAAAG,GAAAA,EAAAH,EAAA,GA5BD,MAAAI,EAAAmc,GAeIwC,EAAA3J,GAAgCjV,IAdlCmV,YAAAA,EAAAA,mBAAAlE,EAAAA,gBAAAsE,EAAAA,sBAAAC,EAAAA,aAAAC,EAAAA,SAAAf,EAAAA,WAAAY,EAAAA,YAAAD,EAAAA,kBAAA7G,EAAAA,sBAAAkH,EAAAA,cAAAhF,GAAAzQ,GA4BFuc,EAAAqC,GAAsC7W,SACtCuU,EAAAuC,GAA4C9W,MAAc,IAAA9H,EAAAC,EAuBR4F,EAvBQlG,OAAAxB,GAEhD6B,EAAAA,KACR,MAAA6e,EAAe,CACb1gB,GAAOT,GAAK,sBAAoBmB,IACtBqd,EAAA,CAAA7c,KAAQ,qBAAoBR,QAAO,IAE7CV,GAAOT,GAAK,qBAAmBohB,IACrB5C,EAAA,CAAA7c,KAAQ,oBAAmBR,KAAEA,GAAK,IAE5CV,GAAOT,GAAK,+BAA6B,KACvCkhB,EAAiBtP,GAAsB,IAEzCnR,GAAO4gB,UAAAC,IACLP,EAAUD,EAAgB,KAACna,OAAA6U,SAEd,MAAA,IAEJ2F,EAAMjF,QAAArK,GAA4B,EAC9CtP,GAAC9B,GAAQwB,KAAAxB,EAAAwB,KAAAK,EAAAL,KAAAM,IAAAD,EAAAL,EAAA,GAAAM,EAAAN,EAAA,IAjBZQ,EAAUH,EAiBPC,GF/NEgf,SAAA9gB,EAAA+d,GAAAvc,MAAAA,EAAAC,EAAA,GAAA,IAAAE,EAAAC,EAAA5B,EAAAA,KAAAA,GAAAwB,OAAAuc,GAIKpc,EAAAA,KACRiX,MAAAA,MAAAC,gBACOvY,GAAAA,MACG,wCAAkCqF,EAAA,CAAAvF,OAChCwY,EAAUxY,OAAAsY,kBAAA,IAAAqI,MAAArgB,IAIVqd,EAAA,CAAA7c,KAAQ,2BAA0BR,QAAO,IAACsb,MAAAlZ,IAOtD,MAAAke,EAAchhB,GAAOT,GAAK,4BAA0BohB,IAC1C5C,EAAA,CAAA7c,KAAQ,2BAA0BR,KAAEA,GAAK,IACjD,MAAA,KAGKsgB,MACLpI,EAAUE,OAAO,CAAC,EAEnBlX,EAAA,CAAC5B,EAAS+d,GAASvc,KAAAxB,EAAAwB,KAAAuc,EAAAvc,KAAAG,EAAAH,KAAAI,IAAAD,EAAAH,EAAA,GAAAI,EAAAJ,EAAA,IAvBtBQ,EAAUL,EAuBPC,EAAoB,CEsMvBkf,CAAmB9gB,EAAS+d,GDrNvBkD,SAAAjhB,EAAAqW,EAAAW,GAAA,MAAAxV,EAAAC,EAAA,GAKLyf,EAAqB5Q,OAAA3K,GAMThE,IAAAA,EAAAH,OAAAxB,GAGV2B,EAAAA,CAAAlD,EAAA0iB,KACEnhB,GAAOa,KAAO,2BAA0B,CAAApC,YAAAuY,YAEtCA,GAAW,EAEdxV,KAAAxB,EAAAwB,KAAAG,GAAAA,EAAAH,EAAA,GANH,MAAA4f,EAAwBzf,EAQvB,IAAAC,EAAAC,EAAAL,EAAA6U,KAAAA,GAAA7U,OAAAwV,GAAAxV,EAAA,KAAA4f,GAESxf,EAAAA,KAIR,MAAAyf,EAAchL,EAAQjQ,IAAAtD,IAQlBoD,OAAAiL,IAGJmQ,MAAAjG,IAAgCgG,EAAKjb,IAAAgL,KAAkB,IAMpD8P,EAAYvQ,UAvDnB,SAAqB4Q,EAAgBC,GAC/BD,GAAAA,IAAMC,EAAU,OAAA,EACpB,GAAID,EAAEpW,OAASqW,EAAErW,KAAa,OAAA,EACnByD,IAAAA,MAAAA,KAAS2S,EAAO,IAACC,EAAEC,IAAI7S,GAAe,OAAA,EAC1C,OAAA,CACT,CAmDO8S,CAAYJ,EAASJ,EAAYvQ,QAAA2Q,UAClCtK,IAAgBkK,EAAYvQ,QAAAqG,YAAoB,CAEhD,MAAA2K,EAAmDzS,MAAAkG,KAAWkM,GAAQlb,KAAAsI,IACpEuL,MAAAA,EAAaoH,EAAK5S,SAAgB9K,EAAI/E,KAAQ8P,KAC9CxN,KAAAA,EAAA0gB,UAAAC,EAAAC,QAAAC,GAAyDpe,EAAI,OACtDke,GAAcE,EAAQ,CAAArT,MAAAsL,MACZ9Y,EAAI2gB,aAAAE,YAAA,CAAArT,MAAAsL,MACJ9Y,EAAI,IAEvBggB,EAAYvQ,QAAA,CAAA2Q,UAAAtK,eACZoK,EAAgBO,EAAiB3K,EAAW,GAE7CnV,EAACwU,CAAAA,EAAUW,EAAaoK,GAAgB5f,KAAA6U,EAAA7U,KAAAwV,EAAAxV,KAAA4f,EAAA5f,KAAAI,EAAAJ,KAAAK,IAAAD,EAAAJ,EAAA,GAAAK,EAAAL,EAAA,IAnC3CQ,EAAUJ,EAmCPC,EAAyC,CC6J5Cof,CAAmBjhB,EAASqW,EAAUW,GAAYxV,OAAA2c,GAGhDzW,EAAAA,CAAA8B,EAAAC,KACO0U,IAELA,EAAWhS,MAAA6V,YAAmB,mBAAoB,GAAGxY,OACrD2U,EAAWhS,MAAA6V,YAAmB,mBAAuBvY,EAACtG,OAAA8e,QAAJ,MAAyB,EAC5EzgB,KAAA2c,EAAA3c,KAAAkG,GAAAA,EAAAlG,EAAA,GANH,MAAA0gB,EAAqCxa,EAQpC,IAAA0B,EAAAY,EAAAxI,EAAA,KAAAmG,OAAAC,IAAA,8BAESwB,EAAAA,KACR+Y,MAAAA,EAAAC,GAqBAC,EAAA9L,IACeA,EAAAA,IACXkK,EAAiB6B,GAAsB,EAI3CC,EAAA7F,IACM8F,EAASjM,IACXkK,EAAiBgC,IAGfC,EAAU,CAAA,MAAO,MAAOnM,IAC1BkK,EAAiBkC,GAAsB,EAI3Cxf,OAAAA,OAAA+O,iBAAwB,QAASiQ,GACjChf,OAAA+O,iBAAwB,UAAWqQ,GACnCpf,OAAA+O,iBAAwB,QAASmQ,GAAY,KAG3Clf,OAAAgP,oBAA2B,QAASgQ,GACpChf,OAAAgP,oBAA2B,UAAWoQ,GACtCpf,OAAAgP,oBAA2B,QAASkQ,EAAW,CAAC,EAEjDrY,GAACyW,GAAkBjf,KAAA4H,EAAA5H,KAAAwI,IAAAZ,EAAA5H,EAAA,GAAAwI,EAAAxI,EAAA,IA/CtBQ,EAAUoH,EA+CPY,GAEH,MAAA4Y,EAAAC,GAA0ClZ,OAC1CmZ,EAAAC,GAAkCpZ,MAClCqZ,EAA0B1S,OAAA3K,GAA6C,IAAA+E,EAAAC,EAsBnDC,EAAAC,EAtBmDrJ,OAAA0c,GAG7DxT,EAAAA,KACJwT,GAAAA,EAAc,OACTpB,IAAA,WAELA,IAAA,KACEiG,MACAC,EAAiBrS,QAAWsS,YAAA,WAE1BJ,KAAsB,GAAC,KAClB,GACR,IAEuBlS,EAAAA,UAC1BuS,aAAaF,EAAiBrS,SAC9BkS,MACAE,MAAkB,EAInBpY,GAACuT,GAAe1c,KAAA0c,EAAA1c,KAAAkJ,EAAAlJ,MAAAmJ,IAAAD,EAAAlJ,EAAA,GAAAmJ,EAAAnJ,EAAA,KAnBnBQ,EAAU0I,EAmBPC,WAAiB0L,GAGXxL,EAAAwL,EAAQ+D,QAAA+I,IAA0E3hB,MAAA6U,EAAA7U,MAAAqJ,GAAAA,EAAArJ,EAAA,IAAzFoJ,EAAOC,EADT,MAAAuS,EAAoBxS,EAENS,IAAAA,GAAA7J,EAAA,MAAAmG,OAAAC,IAAA,8BAEuByD,GAAAA,KAC3B0S,EAAA,CAAA7c,KAAQ,gBAAe,EAChCM,MAAA6J,IAAAA,GAAA7J,EAAA,IAFD4hB,MAAAA,GAAyB/X,GAIzBuU,GAA6BC,IAAyBvU,IAAAA,GAGpDA,GAAOsU,GAAuBQ,OAAkBza,EADlD,MAAA6H,GAA0BlC,GAEoBC,IAAAA,GAAAiD,EAAA,CAGvCwP,GAAAA,GAAsB,cAAXqC,GAA2BpJ,EAAU,CAAAzL,IAAAA,EAAAhK,EAAA,MAAAmG,OAAAC,IAAA,8BAC5C4D,EAAA,GAAEhK,MAAAgK,GAAAA,EAAAhK,EAAA,IAAT+J,GAAOC,EAAEgD,MAAAA,CAAAA,CAAAhD,IAAAA,EAAAhK,EAAA,MAAAgM,IAAAhM,EAAA,MAAA6V,GAAA7V,EAAA,MAAA0V,GAAA1V,EAAA6U,MAAAA,GAAA7U,EAAAwc,MAAAA,GAAAxc,EAAAyV,MAAAA,GAAAzV,EAAAoe,MAAAA,IAAApe,QAAA2O,GAGJ3E,EAAA6K,EAAQnQ,OAAAmd,IAC2Bjd,KAAAqF,IAClC,MAAA7M,GAAAA,EAAA0O,QAAAgW,EAAAA,QAAA/V,EAAAA,QAAA0C,EAAAA,KAAAC,EAAAA,OAAAuG,EAAAA,aAAAC,GAAAjL,EACJiC,GACGgJ,KACCpJ,EAAOiW,aAAc,gBACvB3D,IACAvJ,EAAQ5Q,MAAA+d,GACN,OAAQjN,EAACE,QAAW,OAAQA,IACxBgN,GAA4BlN,EAACE,OAASA,IAAWF,EAACE,OAAA7I,OAAiB6I,EAAM7I,QAK/E,OAACvF,EAAA0H,GACoBvC,CAAAA,qBACVF,QAAMgW,EACOlT,sBAAC6G,IAAeI,IAA0BH,EAEvD3J,UACA0C,UACHwG,KAAAA,EACAvG,OACOzC,aAACuQ,EACHtQ,YACCuJ,WAAAA,GAAcI,EACPlH,kBAAA5C,GAAW4C,GARxBvR,EASN,IAEJ4C,MAAAgM,GAAAhM,MAAA6V,EAAA7V,MAAA0V,EAAA1V,MAAA6U,EAAA7U,MAAAwc,EAAAxc,MAAAyV,EAAAzV,MAAAoe,GAAApe,MAAA2O,EAAA3O,MAAAgK,GAAAA,EAAAhK,EAAA,IA7BJ+J,GAAOC,CAAAA,CALT,MAAAkY,GAAyBnY,GAgDAC,GAAA6I,EAAc,OAAS,QAOf5I,GAAAqX,EAAY,QAAEnd,EAChByG,GAAAwW,EAAgB,QAAEjd,EAAY0G,IAAAA,GAI2BC,GAQtEC,GAC2EC,GAW5EmX,GAC4EC,GACxEC,GACaC,GACGC,GACZC,GAELC,GAAA,OA/ByCziB,EAAA4b,MAAAA,GAAA5b,QAAAwV,GAI7C3K,GAAChE,EAAA8U,GAA8BC,CAAAA,cAA0BpG,gBAAexV,MAAA4b,EAAA5b,MAAAwV,EAAAxV,MAAA6K,IAAAA,GAAA7K,EAAA,IAAAxB,EAAAA,MAAAA,GAAAwB,EAAA,MAAAwc,GAAAxc,EAAA0c,MAAAA,GAAA1c,EAAA,MAAA2c,GAAA3c,QAAA0gB,GACxE5V,GAACjE,EAAAyV,GACU9d,CAAAA,UACC+d,WACDC,UACDkE,OAA2BA,EACnBhE,iBACHC,gBACb3c,MAAAxB,EAAAwB,MAAAwc,EAAAxc,MAAA0c,EAAA1c,MAAA2c,EAAA3c,MAAA0gB,EAAA1gB,MAAA8K,IAAAA,GAAA9K,EAAA,YAAAsV,GACDvK,GAAAuK,KAAgBvN,GAAW,IAAKuN,EAAwBsM,UAAeA,KAAK5hB,MAAAsV,EAAAtV,MAAA+K,IAAAA,GAAA/K,EAAA,IAAA6Q,EAAAA,MAAAA,GAAA7Q,EAAA,MAAAoR,GAAApR,EAAA6V,MAAAA,GAAA7V,EAAA,MAAA2V,GAAA3V,QAAAyV,GAG5EzK,GAAAyK,IAAeI,GAEXzE,EAAAA,EAAAA,CAAAA,SAAAA,CACCA,GAAAvK,EAACsK,IAA4CC,uBAE9CuE,KAA0BpB,GAAoB,IAC9C1D,GAAkBhK,EAAA+J,GAAA,CAAoCC,qBAE1D7Q,MAAA6Q,EAAA7Q,MAAAoR,EAAApR,MAAA6V,EAAA7V,MAAA2V,EAAA3V,MAAAyV,EAAAzV,MAAAgL,IAAAA,GAAAhL,EAAA,IAAAA,EAAA4V,MAAAA,GAAA5V,QAAAyV,GACA0M,GAAA1M,GAAcG,GAAiB/O,EAAAyL,IAA6BsD,SAAWA,IAAK5V,MAAA4V,EAAA5V,MAAAyV,EAAAzV,MAAAmiB,IAAAA,GAAAniB,EAAA,IAAAA,EAAA,MAAAkiB,IAAAliB,EAAAiK,MAAAA,IAAAjK,QAAA4K,IAAA5K,EAAA,MAAA6K,IAAA7K,EAAA8K,MAAAA,IAAA9K,EAAA+K,MAAAA,IAAA/K,EAAA,MAAAgL,IAAAhL,EAAAmiB,MAAAA,IAAAniB,QAAAiS,GA3B/EmQ,KAAC9W,IACkB,kBAAArB,GACF,gBAAAW,GACVoU,IAAaA,EACT/M,UAETpH,SAAAA,CAAAA,GACAC,GAQCC,MAGAC,GASAmX,MACIniB,MAAAkiB,GAAAliB,MAAAiK,GAAAjK,MAAA4K,GAAA5K,MAAA6K,GAAA7K,MAAA8K,GAAA9K,MAAA+K,GAAA/K,MAAAgL,GAAAhL,MAAAmiB,GAAAniB,MAAAiS,EAAAjS,MAAAoiB,IAAAA,GAAApiB,EAAA,IAAAA,EAAAxB,MAAAA,GAAAwB,QAAAoiB,IA7BTC,GAACxb,EAAA0T,GAA6B/b,CAAAA,UAC5B4jB,SA6BFA,KAAsBpiB,MAAAxB,EAAAwB,MAAAoiB,GAAApiB,MAAAqiB,IAAAA,GAAAriB,EAAA,IAAAA,EAAAxB,MAAAA,GAAAwB,QAAAqiB,IA/BxBC,GAACzb,EAAAuP,GAAkC5X,CAAAA,UACjC6jB,SA+BFA,KAA2BriB,MAAAxB,EAAAwB,MAAAqiB,GAAAriB,MAAAsiB,IAAAA,GAAAtiB,EAAA,IAAAA,EAAAxB,MAAAA,GAAAwB,QAAA6U,GAAA7U,EAAA,MAAAsiB,IAjC7BC,GAAC1b,EAAA8P,GAAA,CAAwBnY,UAAmBqW,WAC1CyN,SAAAA,KAiCetiB,MAAAxB,EAAAwB,MAAA6U,EAAA7U,MAAAsiB,GAAAtiB,MAAAuiB,IAAAA,GAAAviB,EAAA,IAAAA,EAAA2c,MAAAA,GAAA3c,QAAAuiB,IApCrBC,GAAC3b,EAAA6b,GAAA,CACCvY,SAACtD,EAAA8b,GAAA,CAAwBhG,QAAAA,EACvB4F,SAAAA,OAoCYviB,MAAA2c,EAAA3c,MAAAuiB,GAAAviB,MAAAwiB,IAAAA,GAAAxiB,EAAA,IAAAA,EAAAgK,MAAAA,IAAAhK,QAAAwiB,IAvClBC,KAACG,GAAsB,CAAAxO,OAAApK,GAAuC6Y,SAAkB1O,KAAA,cAC9EqO,SAuCFA,KAAgBxiB,MAAAgK,GAAAhK,MAAAwiB,GAAAxiB,MAAAyiB,IAAAA,GAAAziB,EAAA,IAxChByiB,EAAAA,EAhTC,SAAAnhB,GAAAsW,EAAAkL,GAAA,OAQgClL,EAAGlT,QAAgBtH,GAAAA,IAAO0lB,GAAO,CAuFjE,SAAAnT,GAAAkO,GAAA,OAgDmCA,CAAO,CAhD1C,SAAAjO,GAAA4P,GAAA,OAuDsCA,GAAQ,CAvD9C,SAAAoB,GAAA9jB,GA0EC,MAAAiE,EAAejE,EAAKiE,OAIlBgiB,IAAAA,GAAoBhiB,IAAYiiB,GAAcjiB,IAAWA,EAAMkiB,QAAS,OAGvDnmB,EAAKomB,OAAO,CACxBC,EAAAA,iBACLrmB,EAAKsmB,kBACL,MAAAC,EAAAC,IAAAA,WAAgCxmB,EAAK4C,KAAA,IAChC5C,EAAKomB,QAAA,EAAAK,SAAA,EAAA7hB,YAAA,IAKLX,EAAAA,QAAAa,cAAuByhB,EAAQ,CAAA,CA1FvC,SAAAvC,GAAA0C,GAAA,OAgGmC3F,CAAO,CAhG1C,SAAAoD,GAAAwC,GAAA,OAsGmC5F,CAAO,CAtG1C,SAAAsD,GAAAuC,GAAA,OA0GmC7F,CAAO,CA1G1C,SAAA8D,GAAA7V,GAoJqC,MAAA,OAAQA,EAAOmJ,OAAWnJ,CAAAA,EAAOmJ,OAAA7X,IAAgB,EAAA,CApJtF,SAAAykB,GAAA8B,GAuKgB5O,OAAAA,EAACC,WAAcD,EAAChJ,OAAQ,CE5UtC,MAAM6X,GAIT7jB,IAAAC,MAAAA,EAAAC,EAAA,IACFzB,QAAAA,EAAAA,QAAAqlB,GAA2B9jB,EAE3B+jB,EAAyBhV,EAAA,GACzBiV,EAA2BjV,EAAA,GAAS,IAAA3O,EAAAC,EAAA,OAAAJ,EAAAxB,KAAAA,GAAAwB,OAAA6jB,GAGlC1jB,EAAAA,IACE3B,EAAOT,GAAI,wBAAsBmB,IAC3BA,GAAgB,WAAhBA,EAAI8kB,OAAoB,CAC1BtC,aAAaoC,EAAgB3U,SAC7B8U,MAAAA,EAAgBJ,EAAQ3kB,GAAK,IACR,IAAjB+kB,EAAiB,OAErBC,IAAAA,EADO7kB,EAAAA,KAAM,4BAA6BH,GAC1CglB,GAAA,EACAJ,EAAgB3U,QAAWxN,OAAA8f,YAAA,KACzBjjB,EAAOa,KAAM,2BAA4BH,GACzCglB,GAAAA,CAAAA,GAAQ,KAEVD,GAAOE,WAAA,KACDD,IACJxC,aAAaoC,EAAgB3U,SAC7B3Q,EAAOa,KAAM,2BAA4BH,GAAI,GAAC,MAAA,GAEvB,aAAhBA,EAAI8kB,OAAsB,CACnCtC,aAAaqC,EAAkB5U,SAC/BiV,MAAAA,EAAgBP,EAAQ3kB,GAAK,IACR,IAAjB+kB,EAAiB,OACd5kB,EAAAA,KAAM,4BAA6BH,GAE1C6kB,EAAkB5U,QAAWxN,OAAA8f,YAAA,KAC3B4C,MAAAA,EAAgBR,EAAQ3kB,IACH,IAAAmlB,IACrB7lB,EAAOa,KAAM,4BAA6BH,GAC1C+kB,GAAOE,WAAA,KACE9kB,EAAAA,KAAM,2BAA4BH,EAAI,KACzCV,EAAOa,KAAM,2BAA4BH,GAAI,GAAC,KAEtD+kB,GAAOE,WAAA,KACE9kB,EAAAA,KAAM,2BAA4BH,EAAI,KACzCV,EAAOa,KAAM,2BAA4BH,EAAI,KAGzDkB,EAAA,CAAC5B,EAASqlB,GAAQ7jB,KAAAxB,EAAAwB,KAAA6jB,EAAA7jB,KAAAG,EAAAH,KAAAI,IAAAD,EAAAH,EAAA,GAAAI,EAAAJ,EAAA,IArCpBQ,EACEL,EAoCAC,GACD,IAAA,EClCUkkB,GAAyDvkB,IAAAC,MAAAA,EAAAC,EAAA,KACpEskB,WAAAA,EAAAA,QAAArkB,EAAAA,QAAA2jB,EAAAA,OAAA5R,GAA+ClS,EAC/Cyc,EAAgB7a,OAAA6iB,OAAA7iB,OAAAoH,KAA0BpH,OAAA8iB,QAE1CjmB,EAAAkmB,GAA8Bvc,OAAAhE,GAAkD,IAAAhE,EAAAC,EAiDnEC,EASPC,EAOD4F,EAAAlG,OAjE2EA,EAAA,KAAAmG,OAAAC,IAAA,8BAEtEjG,EAAAA,KAAA,IACHqc,EAAO,OACZ,MAAAmI,EAAgBC,EAAA,CAAAlhB,KAEN,iBAAgBmhB,UACX,gBAEbC,IAAqExlB,QAAA,CAAA1B,OAC3DmnB,OAGZL,EAAWlmB,GAEX4b,MAAAA,EC7BG,SAA8B5b,GAInC,MAAMwmB,EAAsB,IAAIC,EAAiC,GAC3DC,EAAqB,IAAIC,EAG5BrmB,OAAAA,EAAAA,MAAM,uCAAmCqF,EAAW,CAAC+S,kBAAkB,IACvEqI,MAAergB,IACM+Z,EAAAA,KAAK/Z,EAAKpC,MAAK,IAEpC0d,OAAM,SAKThc,EAAQT,GAAG,+BAAyCmB,IAI1B,cAApBA,EAAKpC,MAAM4C,MACbslB,EAAoB/L,KAAK/Z,EAAKpC,OAER,aAApBoC,EAAKpC,MAAM4C,MACbwlB,EAAmBjM,KAAK/Z,EAAKpC,MAAK,IAI/BsoB,EAAMJ,EAAqBE,EACpC,CDDqBznB,CAAqBe,GACtC6mB,EzBoBiC7mB,CAC5B/B,GAAAA,GAAsB6C,QAAQ,CACnC1B,OAAQ,CACNC,uBAAwBU,GAAsBC,MyBvBzB8mB,CAAqB9mB,GAC5Cud,EAAcwJ,EAAYF,EAAc,CAAA/nB,MAAA,CAAAC,OAAA,CAAAioB,WAAAlkB,IAAA9D,eAEkB4c,KAI1DhD,MAAAC,gBACOvY,OAAAA,EAAAA,MACE,+BAAyBqF,EAAA,CAAAvF,OACtBwY,EAAUxY,OAAAsY,kBAAA,IAElBqI,MAAArgB,IAEQumB,EAAAA,SAAAC,YACNC,EAAS5J,EAAK,IAEhBvB,MAAA7K,IAQJoM,EAAK6J,QACLpnB,EAAOonB,QAAQ,KAGbxO,EAAUE,QACVyE,EAAK8J,OACLrnB,EAAOqnB,MAAM,CAAC,EAEfzlB,GAACoc,GAAQxc,KAAAG,EAAAH,KAAAI,IAAAD,EAAAH,EAAA,GAAAI,EAAAJ,EAAA,IA/CZQ,EAAUL,EA+CPC,GAAUJ,EAAAxB,KAAAA,GAAAwB,OAAAukB,GAAAvkB,EAAA,KAAAiS,GAIT5R,EAACwG,EAAA8X,GACUngB,CAAAA,UACU+lB,kBAAAA,EACV/H,UACDvK,WACRjS,KAAAxB,EAAAwB,KAAAukB,EAAAvkB,KAAAiS,EAAAjS,KAAAK,GAAAA,EAAAL,EAAA,GAAAA,EAAAxB,KAAAA,GAAAwB,OAAAE,GAAAF,EAAA,KAAA6jB,GACDvjB,EAAA9B,GAEG6L,EAAAG,EAAA,CAAAL,SAAA,CAACtD,EAAA/G,GAAA,CAAiBtB,UAAkB0B,YACnC2G,EAAAlG,IAAcnC,YACdqlB,GAAYhd,EAAA+c,GAAiBplB,CAAAA,UAAkBqlB,eAEnD7jB,KAAAxB,EAAAwB,KAAAE,EAAAF,KAAA6jB,EAAA7jB,KAAAM,GAAAA,EAAAN,EAAA,GAAAA,EAAAK,MAAAA,GAAAL,QAAAM,GAbH4F,EACE7F,EAAAA,EAAAA,CAAAA,SAAAA,CAAAA,EAMCC,KAOAN,MAAAK,EAAAL,MAAAM,EAAAN,MAAAkG,GAAAA,EAAAlG,EAAA,IAdHkG,CAAAA,EAxDkE,SAAA5E,KAAA,CAAA,SAAAqO,KAwC9D6J,QAAAC,KACE,0IACD,CA+BT6K,GAAcwB,YAAc"}