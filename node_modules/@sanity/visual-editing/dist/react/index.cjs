"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react/jsx-runtime"),t=require("react-compiler-runtime"),n=require("../_chunks-cjs/create-data-attribute.cjs"),r=require("@sanity/comlink"),o=require("react"),i=require("xstate"),s=require("@sanity/mutate"),a=require("@sanity/mutate/_unstable_machine"),c=require("../_chunks-cjs/mutations.cjs"),l=require("rxjs"),d=require("../_chunks-cjs/PointerEvents.cjs"),u=require("../_chunks-cjs/SharedStateContext.cjs"),p=require("@sanity/client/csm"),f=require("../_chunks-cjs/transformSanityNodeData.cjs");function m(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h=m(require("scroll-into-view-if-needed"));const v=i.setup({types:{},actions:{"emit sync event":i.emit((({event:e})=>(i.assertEvent(e,"sync"),e))),"emit mutation event":i.emit((({event:e})=>(i.assertEvent(e,"mutation"),e))),"emit rebased event":i.emit((({event:e})=>(i.assertEvent(e,["rebased.local","rebased.remote"]),e))),"emit pristine event":i.emit((({event:e})=>(i.assertEvent(e,["pristine"]),e))),"add document actor":i.assign({documents:({context:e,event:t,spawn:n})=>{i.assertEvent(t,"observe");const r=t.documentId;return e.documents[r]?e.documents:{...e.documents,[r]:n("documentMutatorMachine",{input:{id:r,client:e.client,sharedListener:e.sharedListener||a.createSharedListener(e.client)},id:r})}}}),"stop remote snapshot":i.stopChild((({context:e,event:t})=>(i.assertEvent(t,"unobserve"),e.documents[t.documentId]))),"remove remote snapshot from context":i.assign({documents:({context:e,event:t})=>{if(i.assertEvent(t,"unobserve"),!e.documents[t.documentId])return e.documents;const{[t.documentId]:n,...r}=e.documents;return r}})},actors:{documentMutatorMachine:a.documentMutatorMachine}}).createMachine({id:"dataset-mutator",context:({input:e})=>({documents:{},client:e.client,sharedListener:e.sharedListener}),on:{sync:{actions:["emit sync event"]},mutation:{actions:["emit mutation event"]},"rebased.*":{actions:["emit rebased event"]},pristine:{actions:["emit pristine event"]},observe:{actions:["add document actor"]},unobserve:{actions:["stop remote snapshot","remove remote snapshot from context"]}},initial:"pristine",states:{pristine:{}}}),g=e=>{const t=i.fromPromise((async({input:t,signal:n})=>{const{id:r}=t,{snapshot:o}=await e.fetch("visual-editing/fetch-snapshot",{documentId:r},{signal:n});return o})),n=i.fromPromise((async({input:t})=>{const{transactions:n}=t;for(const t of n){const n=s.SanityEncoder.encodeTransaction(t);return e.post("visual-editing/mutate",n)}}));return a.documentMutatorMachine.provide({actions:{"send sync event to parent":i.enqueueActions((({enqueue:e})=>{e.sendParent((({context:e})=>({type:"sync",id:e.id,document:e.remote}))),e.emit((({context:e})=>({type:"ready",snapshot:e.local})))}))},actors:{"fetch remote snapshot":t,"submit mutations as transactions":n}})},y=e=>{const n=t.c(8),{comlink:r,history:i}=e;let s,a,c,l;return n[0]!==r||n[1]!==i?(s=()=>r?.on("presentation/navigate",(e=>{i?.update(e)})),a=[r,i],n[0]=r,n[1]=i,n[2]=s,n[3]=a):(s=n[2],a=n[3]),o.useEffect(s,a),n[4]!==r||n[5]!==i?(c=()=>{if(i)return i.subscribe((e=>{e.title=e.title||document.title,r?.post("visual-editing/navigate",e)}))},l=[r,i],n[4]=r,n[5]=i,n[6]=c,n[7]=l):(c=n[6],l=n[7]),o.useEffect(c,l),null},b=e=>{const n=t.c(3),{comlink:r}=e;let i,s;return n[0]!==r?(i=()=>{const e=()=>{r.post("visual-editing/meta",{title:document.title})},t=new MutationObserver((t=>{const[n]=t;"TITLE"===n.target.nodeName&&e()}));return t.observe(document.head,{subtree:!0,characterData:!0,childList:!0}),e(),()=>t.disconnect()},s=[r],n[0]=r,n[1]=i,n[2]=s):(i=n[1],s=n[2]),o.useEffect(i,s),null};function w(e){const t=new CustomEvent("sanity/dragEnd",{detail:e,cancelable:!0});window.dispatchEvent(t)}const x=o.createContext(null);function j(){const e=o.useContext(x);if(!e)throw new Error("Schema context is missing");return e}function k(e,t){if(!e.type)throw new Error("Node type is missing");return()=>t.patch((async({getSnapshot:t})=>c.f(e,await t())))}function E(e,t,n,r){if(!e.type)throw new Error("Node type is missing");return()=>t.patch((()=>c.c(e,n,r)))}function S(e,t){if(!e.type)throw new Error("Node type is missing");return()=>t.patch((async({getSnapshot:t})=>c.h(e,await t())))}function _(t){const{node:n,field:r,parent:o,doc:i}=t;return"arrayItem"===r?.type?async function(e){const{node:t,field:n,doc:r}=e,o=[];return o.push(...M(e)),o.push(...I(e)),o.push(...await P(e)),o.push({type:"action",label:"Insert before",icon:d.a,action:E(t,r,n.name,"before")}),o.push({type:"action",label:"Insert after",icon:d.b,action:E(t,r,n.name,"after")}),o}({node:n,field:r,doc:i}):"union"===o?.type?async function(t){const{doc:n,node:r,parent:o}=t,i=[];if(i.push(...M(t)),i.push(...I(t)),i.push(...await P(t)),o.options?.insertMenu){const t=(o.options.insertMenu||{}).views?.some((e=>"grid"===e.name))?0:void 0;i.push({type:"custom",component:({boundaryElement:i})=>e.jsx($,{label:"Insert before",onSelect:e=>{E(r,n,e.name,"before")()},parent:o,width:t,boundaryElement:i})}),i.push({type:"custom",component:({boundaryElement:i})=>e.jsx($,{label:"Insert after",onSelect:e=>{E(r,n,e.name,"after")()},parent:o,width:t,boundaryElement:i})})}else i.push({type:"group",label:"Insert before",icon:d.a,items:o.of.filter((e=>"unionOption"===e.type)).map((e=>({type:"action",icon:d.g(e),label:"block"===e.name?"Paragraph":e.title||e.name,action:E(r,n,e.name,"before")})))}),i.push({type:"group",label:"Insert after",icon:d.b,items:o.of.filter((e=>"unionOption"===e.type)).map((e=>({type:"action",label:"block"===e.name?"Paragraph":e.title||e.name,icon:d.g(e),action:E(r,n,e.name,"after")})))});return i}({node:n,parent:o,doc:i}):Promise.resolve([])}function M(e){const{node:t,doc:n}=e;return n?[{type:"action",label:"Duplicate",icon:d.C,action:S(t,n)}]:[]}function I(e){const{node:t,doc:n}=e;return n?[{type:"action",label:"Remove",icon:d.R,action:k(t,n)}]:[]}async function P(e,t=!0){const{node:n,doc:r}=e;if(!r)return[];const o=[],i=[],[s,a,l,u]=await Promise.all([c.e(n,r,"previous"),c.e(n,r,"next"),c.e(n,r,"first"),c.e(n,r,"last")]);return l.length&&i.push({type:"action",label:"To top",icon:d.c,action:()=>r.patch(l)}),s.length&&i.push({type:"action",label:"Up",icon:d.e,action:()=>r.patch(s)}),a.length&&i.push({type:"action",label:"Down",icon:d.f,action:()=>r.patch(a)}),u.length&&i.push({type:"action",label:"To bottom",icon:d.U,action:()=>r.patch(u)}),i.length&&(o.push({type:"group",label:"Move",icon:d.S,items:i}),t&&o.push({type:"divider"})),o}const $=n=>{const r=t.c(12),{label:o,parent:i,width:s,onSelect:a,boundaryElement:c}=n;let l,u,p,f,m;return r[0]===Symbol.for("react.memo_cache_sentinel")?(l=["left-start","right","left","right-end","left-end","bottom","top"],r[0]=l):l=r[0],r[1]===Symbol.for("react.memo_cache_sentinel")?(u=[4,4,4,4],r[1]=u):u=r[1],r[2]!==c||r[3]!==s?(p={arrow:!1,constrainSize:!0,floatingBoundary:c,padding:0,placement:"right-start",fallbackPlacements:l,preventOverflow:!0,width:s,__unstable_margins:u},r[2]=c,r[3]=s,r[4]=p):p=r[4],r[5]!==a||r[6]!==i?(f=e.jsx(d.h,{node:i,onSelect:a}),r[5]=a,r[6]=i,r[7]=f):f=r[7],r[8]!==o||r[9]!==p||r[10]!==f?(m=e.jsx(d.M,{fontSize:1,icon:d.b,padding:2,popover:p,space:2,text:o,children:f}),r[8]=o,r[9]=p,r[10]=f,r[11]=m):m=r[11],m};const R=[-4,4,-4,4];function T(n){const r=t.c(25),{node:o,onDismiss:i,boundaryElement:s}=n;let a;r[0]!==o||r[1]!==i?(a=()=>{"action"===o.type&&(o.action?.(),i?.())},r[0]=o,r[1]=i,r[2]=a):a=r[2];const c=a;if("divider"===o.type){let t;return r[3]===Symbol.for("react.memo_cache_sentinel")?(t=e.jsx(d.i,{}),r[3]=t):t=r[3],t}if("action"===o.type){const t=!o.action;let n;return r[4]!==o.hotkeys||r[5]!==o.icon||r[6]!==o.label||r[7]!==c||r[8]!==t?(n=e.jsx(d.p,{fontSize:1,hotkeys:o.hotkeys,icon:o.icon,padding:2,space:2,text:o.label,disabled:t,onClick:c}),r[4]=o.hotkeys,r[5]=o.icon,r[6]=o.label,r[7]=c,r[8]=t,r[9]=n):n=r[9],n}if("group"===o.type){const t=o.icon;let n;r[10]===Symbol.for("react.memo_cache_sentinel")?(n={arrow:!1,constrainSize:!0,placement:"right-start",fallbackPlacements:["left-start","right","left","right-end","left-end","bottom","top"],preventOverflow:!0,__unstable_margins:R},r[10]=n):n=r[10];const a=o.label;let c,l;if(r[11]!==s||r[12]!==o.items||r[13]!==i){let t;r[15]!==s||r[16]!==i?(t=(t,n)=>e.jsx(T,{node:t,onDismiss:i,boundaryElement:s},n),r[15]=s,r[16]=i,r[17]=t):t=r[17],c=o.items.map(t),r[11]=s,r[12]=o.items,r[13]=i,r[14]=c}else c=r[14];return r[18]!==o.icon||r[19]!==o.label||r[20]!==c?(l=e.jsx(d.M,{fontSize:1,icon:t,padding:2,popover:n,space:2,text:a,children:c}),r[18]=o.icon,r[19]=o.label,r[20]=c,r[21]=l):l=r[21],l}if("custom"===o.type){const{component:t}=o;let n;return r[22]!==t||r[23]!==s?(n=e.jsx(t,{boundaryElement:s}),r[22]=t,r[23]=s,r[24]=n):n=r[24],n}return null}const D=n=>{const r=t.c(43),{node:i,onDismiss:s,position:a}=n,{x:l,y:u}=a,[p,f]=o.useState(null),{getField:m}=j(),{getDocument:h}=c.a();let v;r[0]!==m||r[1]!==i?(v=m(i),r[0]=m,r[1]=i,r[2]=v):v=r[2];const{field:g,parent:y}=v;let b;b=g?.title||g?.name||"Unknown type";const w=b,[x,k]=o.useState(void 0);let E,S,M,I;r[3]!==g||r[4]!==h||r[5]!==i||r[6]!==y?(E=()=>{(async()=>{const e=h(i.id);if(!e)return;const t=await _({node:i,field:g,parent:y,doc:e});k(t)})()},S=[g,i,y,h],r[3]=g,r[4]=h,r[5]=i,r[6]=y,r[7]=E,r[8]=S):(E=r[7],S=r[8]),o.useEffect(E,S),r[9]!==l||r[10]!==u?(I={getBoundingClientRect:()=>({bottom:u,left:l,right:l,top:u,width:0,height:0})},r[9]=l,r[10]=u,r[11]=I):I=r[11],M=I;const P=M;let $,D;r[12]!==g?(D=d.g(g),r[12]=g,r[13]=D):D=r[13],$=D;const z=$;let q,F;r[14]===Symbol.for("react.memo_cache_sentinel")?(q={minWidth:120,maxWidth:160},r[14]=q):q=r[14],r[15]!==z||r[16]!==x?(F=e.jsx(d.j,{flex:"none",children:x?e.jsx(d.T,{size:1,children:z}):e.jsx(d.k,{size:1})}),r[15]=z,r[16]=x,r[17]=F):F=r[17];const A=x?w:"Loading...";let C,L,N,O;r[18]!==A?(C=e.jsx(d.l,{flex:1,space:2,children:e.jsx(d.T,{size:1,weight:"semibold",children:A})}),r[18]=A,r[19]=C):C=r[19],r[20]!==F||r[21]!==C?(L=e.jsxs(d.F,{gap:2,padding:2,children:[F,C]}),r[20]=F,r[21]=C,r[22]=L):L=r[22],r[23]!==p||r[24]!==x||r[25]!==s?(N=x&&e.jsxs(e.Fragment,{children:[e.jsx(d.i,{}),x.map(((t,n)=>e.jsx(T,{node:t,onDismiss:s,boundaryElement:p},n)))]}),r[23]=p,r[24]=x,r[25]=s,r[26]=N):N=r[26],r[27]!==L||r[28]!==N?(O=e.jsxs(d.m,{style:q,children:[L,N]}),r[27]=L,r[28]=N,r[29]=O):O=r[29];const W=`${l}-${u}`;let G,U,B,V;return r[30]!==l||r[31]!==u?(G={position:"absolute",left:l,top:u},r[30]=l,r[31]=u,r[32]=G):G=r[32],r[33]!==W||r[34]!==G?(U=e.jsx("div",{style:G},W),r[33]=W,r[34]=G,r[35]=U):U=r[35],r[36]!==P||r[37]!==O||r[38]!==U?(B=e.jsx(d.n,{__unstable_margins:R,arrow:!1,open:!0,placement:"right-start",referenceElement:P,content:O,children:U}),r[36]=P,r[37]=O,r[38]=U,r[39]=B):B=r[39],r[40]!==s||r[41]!==B?(V=e.jsx(d.o,{setBoundaryElement:f,onDismiss:s,children:B}),r[40]=s,r[41]=B,r[42]=V):V=r[42],V},z=o.createContext(null);const q=d.d(d.q)`
  background-color: var(--overlay-bg);
  border-radius: 3px;
  pointer-events: none;
  position: absolute;
  will-change: transform;
  box-shadow: var(--overlay-box-shadow);
  transition: none;

  --overlay-bg: transparent;
  --overlay-box-shadow: inset 0 0 0 1px transparent;

  [data-overlays] & {
    --overlay-bg: color-mix(in srgb, transparent 95%, var(--card-focus-ring-color));
    --overlay-box-shadow: inset 0 0 0 2px
      color-mix(in srgb, transparent 50%, var(--card-focus-ring-color));
  }

  [data-fading-out] & {
    transition:
      box-shadow 1550ms,
      background-color 1550ms;

    --overlay-bg: rgba(0, 0, 255, 0);
    --overlay-box-shadow: inset 0 0 0 1px transparent;
  }

  &[data-focused] {
    --overlay-box-shadow: inset 0 0 0 1px var(--card-focus-ring-color);
  }

  &[data-hovered]:not([data-focused]) {
    transition: none;
    --overlay-box-shadow: inset 0 0 0 2px var(--card-focus-ring-color);
  }

  /* [data-unmounted] & {
    --overlay-box-shadow: inset 0 0 0 1px var(--card-focus-ring-color);
  } */

  :link {
    text-decoration: none;
  }
`,F=d.d(d.F)`
  bottom: 100%;
  cursor: pointer;
  pointer-events: none;
  position: absolute;
  right: 0;

  [data-hovered] & {
    pointer-events: all;
  }
`,A=d.d(d.q)`
  background-color: var(--card-focus-ring-color);
  right: 0;
  border-radius: 3px;

  & [data-ui='Text'] {
    color: #fff;
    white-space: nowrap;
  }
`,C=d.d(d.F)`
  bottom: 100%;
  cursor: pointer;
  pointer-events: none;
  position: absolute;
  left: 0;
`,L=d.d(d.F)`
  display: flex;
  align-items: center;
  background-color: var(--card-focus-ring-color);
  right: 0;
  border-radius: 3px;
  & [data-ui='Text'],
  & [data-sanity-icon] {
    color: #fff;
    white-space: nowrap;
  }
`;const N=n=>{const r=t.c(35),{element:i,focused:s,componentResolver:a,node:c,showActions:l,draggable:u}=n,{getField:m,getType:h}=j();let v;r[0]!==h||r[1]!==c?(v=h(c),r[0]=h,r[1]=c,r[2]=v):v=r[2];const g=v;let y;r[3]!==m||r[4]!==c?(y=m(c),r[3]=m,r[4]=c,r[5]=y):y=r[5];const{field:b,parent:w}=y;let x;r[6]!==c?(x="path"in c?function(e){const{id:t,type:n,path:r,baseUrl:o,tool:i,workspace:s}=e;return p.createEditUrl({baseUrl:o,workspace:s,tool:i,type:n,id:t,path:f.p(p.studioPath.fromString(r))})}(c):c.href,r[6]=c,r[7]=x):x=r[7];const k=x,E=function(){const e=o.useContext(z);if(!e)throw new Error("Preview Snapshots context is missing");return e}();let S;e:{if(!("path"in c)){S=void 0;break e}let e;r[8]!==c.id||r[9]!==E?(e=E.find((e=>e._id===c.id))?.title,r[8]=c.id,r[9]=E,r[10]=e):e=r[10],S=e}const _=S;let M;e:{if(!("path"in c)){M=void 0;break e}if(!b||!g){M=void 0;break e}const e=b.value.type,t=!!s;let n;r[11]!==i||r[12]!==b||r[13]!==c||r[14]!==w||r[15]!==g||r[16]!==t||r[17]!==e?(n={document:g,element:i,field:b,focused:t,node:c,parent:w,type:e},r[11]=i,r[12]=b,r[13]=c,r[14]=w,r[15]=g,r[16]=t,r[17]=e,r[18]=n):n=r[18],M=n}const I=M,P=function(e,n){const r=t.c(4);let i;e:{if(!e){i=void 0;break e}let t;if(r[0]!==e||r[1]!==n){const a=n?.(e);if(!a){i=void 0;break e}if(s=a,o.isValidElement(s)){i=a;break e}t=(Array.isArray(a)?a:[a]).map(W),r[0]=e,r[1]=n,r[2]=t,r[3]=i}else t=r[2],i=r[3];i=t}var s;return i}(I,a);let $;r[19]!==g?($=g?.icon?e.jsx("div",{dangerouslySetInnerHTML:{__html:g.icon}}):e.jsx(d.D,{}),r[19]=g,r[20]=$):$=r[20];const R=$;let T,D,q,A;return r[21]!==k||r[22]!==l?(T=l?e.jsx(F,{gap:1,paddingBottom:1,"data-sanity-overlay-element":!0,children:e.jsx(G,{href:k})}):null,r[21]=k,r[22]=l,r[23]=T):T=r[23],r[24]!==u||r[25]!==R||r[26]!==_?(D=_&&e.jsx(C,{gap:1,paddingBottom:1,children:e.jsxs(L,{gap:2,padding:2,children:[u&&e.jsx(d.j,{marginRight:1,children:e.jsx(d.T,{className:"drag-handle",size:0,children:e.jsx(d.r,{})})}),e.jsx(d.T,{size:0,children:R}),e.jsx(d.T,{size:1,weight:"medium",children:_})]})}),r[24]=u,r[25]=R,r[26]=_,r[27]=D):D=r[27],r[28]!==I||r[29]!==P?(q=Array.isArray(P)?P.map(((t,n)=>{const{component:r,props:o}=t;return e.jsx(r,{PointerEvents:d.P,...I,...o},n)})):P,r[28]=I,r[29]=P,r[30]=q):q=r[30],r[31]!==T||r[32]!==D||r[33]!==q?(A=e.jsxs(e.Fragment,{children:[T,D,q]}),r[31]=T,r[32]=D,r[33]=q,r[34]=A):A=r[34],A},O=o.memo((function(n){const r=t.c(17),{focused:i,hovered:s,rect:a,wasMaybeCollapsed:c,enableScrollIntoView:l}=n,d=o.useRef(null),u=o.useRef(!1);let p;const f=`${a.w}px`,m=`${a.h}px`,v=`translate(${a.x}px, ${a.y}px)`;let g;r[0]!==f||r[1]!==m||r[2]!==v?(g={width:f,height:m,transform:v},r[0]=f,r[1]=m,r[2]=v,r[3]=g):g=r[3],p=g;const y=p;let b,w;r[4]!==l||r[5]!==i||r[6]!==c?(b=()=>{if(!u.current&&!c&&!0===i&&d.current&&l){const e=d.current;h.default(d.current,{behavior:t=>{0!==t.length&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},scrollMode:"if-needed",block:"center",inline:"nearest"})}u.current=!0===i},w=[i,c,l],r[4]=l,r[5]=i,r[6]=c,r[7]=b,r[8]=w):(b=r[7],w=r[8]),o.useEffect(b,w);const x=i?"":void 0,j=s?"":void 0;let k,E;return r[9]!==s||r[10]!==n?(k=s&&e.jsx(N,{...n}),r[9]=s,r[10]=n,r[11]=k):k=r[11],r[12]!==y||r[13]!==x||r[14]!==j||r[15]!==k?(E=e.jsx(q,{"data-focused":x,"data-hovered":j,ref:d,style:y,children:k}),r[12]=y,r[13]=x,r[14]=j,r[15]=k,r[16]=E):E=r[16],E}));function W(e){return"object"==typeof e&&"component"in e?e:{component:e,props:{}}}const G=o.memo((function(n){const r=t.c(3),i=o.useSyncExternalStore(U,B),s=function(e,t){return o.useMemo((()=>{try{const n=new URL(e,typeof location>"u"?void 0:location.origin);return n.searchParams.set("preview",t),n.toString()}catch{return e}}),[e,t])}(n.href,i);let a,c;return r[0]===Symbol.for("react.memo_cache_sentinel")?(a=e.jsx(A,{padding:2,children:e.jsx(d.T,{size:1,weight:"medium",children:"Open in Studio"})}),r[0]=a):a=r[0],r[1]!==s?(c=e.jsx(d.j,{as:"a",href:s,target:"_blank",rel:"noopener noreferrer",children:a}),r[1]=s,r[2]=c):c=r[2],c}));function U(e){const t=()=>e();return window.addEventListener("popstate",t),()=>window.removeEventListener("popstate",t)}function B(){return window.location.href}const V=n=>{const r=t.c(5),{dragGroupRect:o}=n,i=`${o.y}px`,s=`${o.x}px`,a=o.w-1+"px",c=o.h-1+"px";let l;return r[0]!==i||r[1]!==s||r[2]!==a||r[3]!==c?(l=e.jsx("div",{style:{position:"absolute",top:i,left:s,width:a,height:c,border:"1px dashed #f0709b",pointerEvents:"none"}}),r[0]=i,r[1]=s,r[2]=a,r[3]=c,r[4]=l):l=r[4],l};function K(e,t,n){return e*(1-n)+t*n}const Y=({dragInsertPosition:t})=>{if(null===t)return;let n=0,r=0,o=0,i=0;const s=.0125;if("horizontal"===(t?.left||t?.right?"horizontal":"vertical")){const{left:e,right:a}=t;if(o=6,a&&e){const t=e.rect.x+e.rect.w,o=a.rect.x,c=Math.min(a.rect.h,e.rect.h)*s;n=K(t,o,.5)-3,r=e.rect.y+c,i=Math.min(a.rect.h,e.rect.h)-2*c}else if(a&&!e){const e=a.rect.h*s;n=a.rect.x-3,r=a.rect.y+e,i=a.rect.h-2*e}else if(e&&!a){const t=e.rect.h*s;n=e.rect.x+e.rect.w-3,r=e.rect.y+t,i=e.rect.h-2*t}}else{const{bottom:e,top:a}=t;if(e&&a){const t=Math.min(a.rect.x,e.rect.x),c=a.rect.y+a.rect.h,l=e.rect.y,d=Math.min(e.rect.w,a.rect.w)*s;i=6,n=t+d,r=K(c,l,.5)-3,o=Math.max(e.rect.w,a.rect.w)-2*d}else if(e&&!a){const t=e.rect.w*s;n=e.rect.x+t,r=e.rect.y-3,o=e.rect.w-2*t,i=6}else if(a&&!e){const e=a.rect.w*s;n=a.rect.x+e,r=a.rect.y+a.rect.h-3,o=a.rect.w-2*e,i=6}}return e.jsx("div",{style:{position:"absolute",width:`${o}px`,height:`${i}px`,transform:`translate(${n}px, ${r}px)`,background:"#556bfc",border:"2px solid white",borderRadius:"999px",zIndex:"999999"}})},H=d.d.div`
  --drag-preview-opacity: 0.98;
  --drag-preview-skeleton-stroke: #ffffff;

  @media (prefers-color-scheme: dark) {
    --drag-preview-skeleton-stroke: #383d51;
  }

  position: fixed;
  display: grid;
  transform: ${({$scaleFactor:e,$width:t,$height:n})=>`translate(calc(var(--drag-preview-x) - ${t/2}px), calc(var(--drag-preview-y) - ${n/2}px)) scale(${e})`};
  width: ${({$width:e})=>`${e}px`};
  height: ${({$height:e})=>`${e}px`};
  z-index: 9999999;
  opacity: var(--drag-preview-opacity);
  cursor: move;

  .drag-preview-content-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    container-type: inline-size;
  }

  [data-ui='card'] {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .drag-preview-skeleton {
    position: absolute;
    inset: 0;

    rect {
      stroke: var(--drag-preview-skeleton-stroke);
    }
  }

  .drag-preview-handle {
    position: absolute;
    top: 4cqmin;
    left: 4cqmin;
    width: 6cqmin;
    fill: var(--drag-preview-handle-fill);
  }
`;const X=n=>{const r=t.c(24),{skeleton:o}=n,i=Math.min(o.maxWidth,window.innerWidth/2),s=o.w>i?i/o.w:1,a=o.offsetX*s,c=o.offsetY*s,l=d.u(),u=d.s(),p=u.radius[(f=o.w,m=0,h=1920,v=1,g=u.radius.length-2,~~function(e,t,n){return e<t?t:e>n?n:e}((f-m)*(g-v)/(h-m)+v,v,g))];var f,m,h,v,g;let y;r[0]!==o.childRects?(y=o.childRects.filter(Z),r[0]=o.childRects,r[1]=y):y=r[1];const b=y;let w;r[2]!==o.childRects?(w=o.childRects.filter(J),r[2]=o.childRects,r[3]=w):w=r[3];const x=w,j=o.w,k=o.h,E=l?"dark":"light",S=`0 0 ${o.w} ${o.h}`;let _,M,I,P,$;return r[4]!==b||r[5]!==x?(_=[...b,...x],r[4]=b,r[5]=x,r[6]=_):_=r[6],r[7]!==_||r[8]!==u.color.skeleton.from?(M=_.map(((t,n)=>e.jsx("rect",{x:t.x,y:t.y,width:t.w,height:t.h,fill:u.color.skeleton.from},n))),r[7]=_,r[8]=u.color.skeleton.from,r[9]=M):M=r[9],r[10]!==S||r[11]!==M?(I=e.jsx("div",{className:"drag-preview-content-wrapper",children:e.jsx("svg",{className:"drag-preview-skeleton",viewBox:S,children:M})}),r[10]=S,r[11]=M,r[12]=I):I=r[12],r[13]!==p||r[14]!==E||r[15]!==I?(P=e.jsx(d.q,{radius:p,shadow:4,overflow:"hidden",tone:"transparent",scheme:E,children:I}),r[13]=p,r[14]=E,r[15]=I,r[16]=P):P=r[16],r[17]!==a||r[18]!==c||r[19]!==s||r[20]!==o.h||r[21]!==o.w||r[22]!==P?($=e.jsx(H,{$width:j,$height:k,$offsetX:a,$offsetY:c,$scaleFactor:s,children:P}),r[17]=a,r[18]=c,r[19]=s,r[20]=o.h,r[21]=o.w,r[22]=P,r[23]=$):$=r[23],$};function Z(e){return"IMG"===e.tagName}function J(e){return"IMG"!==e.tagName}const Q=d.d(d.q)`
  position: fixed;
  bottom: 2rem;
  left: 2rem;
`,ee=()=>{const n=t.c(2);let r,o;return n[0]===Symbol.for("react.memo_cache_sentinel")?(r={zIndex:"999999"},n[0]=r):r=n[0],n[1]===Symbol.for("react.memo_cache_sentinel")?(o=e.jsx(Q,{padding:2,shadow:2,radius:2,style:r,children:e.jsxs(d.F,{align:"center",gap:2,children:[e.jsx(d.H,{keys:["Shift"]}),e.jsx(d.T,{size:1,children:"Zoom Out"}),e.jsx(d.E,{})]})}),n[1]=o):o=n[1],o},te=(e,t)=>{const{type:n}=t;switch(n){case"element/register":return e.find((e=>e.id===t.id))?e:[...e,{id:t.id,activated:!1,element:t.element,focused:!1,hovered:!1,rect:t.rect,sanity:t.sanity,dragDisabled:t.dragDisabled}];case"element/activate":return e.map((e=>e.id===t.id?{...e,activated:!0}:e));case"element/update":return e.map((e=>e.id===t.id?{...e,sanity:t.sanity,rect:t.rect}:e));case"element/unregister":return e.filter((e=>e.id!==t.id));case"element/deactivate":return e.map((e=>e.id===t.id?{...e,activated:!1,hovered:!1}:e));case"element/mouseenter":return e.map((e=>e.id===t.id?{...e,rect:t.rect,hovered:!0}:{...e,hovered:!1}));case"element/mouseleave":return e.map((e=>e.id===t.id?{...e,hovered:!1}:e));case"element/updateRect":return e.map((e=>e.id===t.id?{...e,rect:t.rect}:e));case"element/click":return e.map((e=>({...e,focused:e.id===t.id&&"clicked"})));case"overlay/blur":case"presentation/blur":return e.map((e=>({...e,focused:!1})));case"presentation/focus":{const n=e.find((e=>"clicked"===e.focused));return e.map((e=>{const r="path"in e.sanity&&e.sanity.id===t.data.id&&e.sanity.path===t.data.path;return n&&e===n&&r?e:{...e,focused:r&&n?"duplicate":r}}))}default:return e}};function ne(e,t){const{type:n}=t;let{contextMenu:r,focusPath:o,perspective:i,isDragging:s,dragInsertPosition:a,dragShowMinimap:c,dragShowMinimapPrompt:l,dragSkeleton:d,dragMinimapTransition:u,dragGroupRect:p}=e,f=!1;if("presentation/focus"===n){const n=e.focusPath;o=t.data.path,n!==o&&(f=n.slice(o.length).startsWith("["))}return"presentation/perspective"===n&&(i=t.data.perspective),"element/contextmenu"===n&&(r="sanity"in t?{node:t.sanity,position:t.position}:null),("element/click"===n||"element/mouseleave"===n||"overlay/blur"===n||"presentation/blur"===n||"presentation/focus"===n)&&(r=null),"overlay/dragUpdateInsertPosition"===n&&(a=t.insertPosition),"overlay/dragStart"===n&&(s=!0),"overlay/dragUpdateSkeleton"===t.type&&(d=t.skeleton),"overlay/dragEnd"===n&&(s=!1),"overlay/dragToggleMinimapPrompt"===t.type&&(l=t.display),"overlay/dragStartMinimapTransition"===n&&(u=!0),"overlay/dragEndMinimapTransition"===n&&(u=!1),"overlay/dragUpdateGroupRect"===n&&(p=t.groupRect),"overlay/dragToggleMinimap"===n&&(c=t.display),{...e,contextMenu:r,elements:te(e.elements,t),dragInsertPosition:a,dragSkeleton:d,dragGroupRect:p,isDragging:s,focusPath:o,perspective:i,wasMaybeCollapsed:f,dragShowMinimap:c,dragShowMinimapPrompt:l,dragMinimapTransition:u}}const re=function(n){const r=t.c(7),{comlink:i,children:s}=n;let a;r[0]===Symbol.for("react.memo_cache_sentinel")?(a=[],r[0]=a):a=r[0];const[c,l]=o.useState(a);let d,u,p;r[1]!==i?(d=()=>i?.on("presentation/preview-snapshots",(e=>{l(e.snapshots)})),u=[i],r[1]=i,r[2]=d,r[3]=u):(d=r[2],u=r[3]),o.useEffect(d,u),p=c;const f=p;let m;return r[4]!==s||r[5]!==f?(m=e.jsx(z.Provider,{value:f,children:s}),r[4]=s,r[5]=f,r[6]=m):m=r[6],m};function oe(e){return"path"in e}function ie(e){return"document"===e.type}function se(e){return"type"===e.type}const ae=function(n){const r=t.c(26),{comlink:i,children:s,elements:a}=n;let c;r[0]===Symbol.for("react.memo_cache_sentinel")?(c=new Map,r[0]=c):c=r[0];const[l,d]=o.useState(c),[u,p]=o.useState(null);let f;r[1]!==i?(f=async e=>{if(i)try{const t=await i.fetch("visual-editing/schema",void 0,{signal:e,suppressWarnings:!0});p(t.schema)}catch{}},r[1]=i,r[2]=f):f=r[2];const m=f;let h,v,g;r[3]!==m?(h=()=>{const e=new AbortController;return m(e.signal),()=>e.abort()},v=[m],r[3]=m,r[4]=h,r[5]=v):(h=r[4],v=r[5]),o.useEffect(h,v),r[6]===Symbol.for("react.memo_cache_sentinel")?(g=[],r[6]=g):g=r[6];const y=o.useRef(g);let b,w,j;r[7]!==i||r[8]!==a?(b=()=>{const e=new AbortController,t=function(e){return e.reduce(((e,t)=>{const{sanity:n}=t;if(!("id"in n)||!n.path.includes("[_key=="))return e;const r=function(e){return e.split(".").toReversed().reduce(((e,t)=>e.length?[t,...e]:t.includes("[_key==")?[t]:[]),[]).join(".")}(n.path);return e.find((e=>e.id===n.id&&e.path===r))||e.push({id:n.id,path:r}),e}),[])}(a);return t.some((e=>!y.current.find((t=>{const{id:n,path:r}=t;return n===e.id&&r===e.path}))))&&(async(e,t)=>{if(e.length&&i)try{const n=await i.fetch("visual-editing/schema-union-types",{paths:e},{signal:t,suppressWarnings:!0});d(n.types),y.current=e}catch{}})(t,e.signal),()=>e.abort()},w=[i,a],r[7]=i,r[8]=a,r[9]=b,r[10]=w):(b=r[9],w=r[10]),o.useEffect(b,w),r[11]!==u?(j=(e,t)=>{const n=t||"document";if(!u||"string"!=typeof e&&(!oe(e)||!Array.isArray(u)))return;const r="string"==typeof e?e:e.type,o="document"===n?ie:se;return u.filter(o).find((e=>e.name===r))},r[11]=u,r[12]=j):j=r[12];const k=j;let E;r[13]!==k||r[14]!==l?(E=e=>{if(!oe(e))return{field:void 0,parent:void 0};const t=k(e);if(!t)return{field:void 0,parent:void 0};const n=e.path.split(".").flatMap(ce);try{return function t(n,r,o,i){const s=void 0===i?[]:i;if(!n)return{field:void 0,parent:void 0};const[a,...c]=r;if("fields"in n){const e=n.fields[a];if(!e&&"rest"in n)return t(n.rest,r,n,s);if(!c.length)return{field:e,parent:o};if(!e)throw new Error(`[@sanity/visual-editing] No field could be resolved at path: "${[...s,...r].join(".")}"`);return t(e.value,c,n,[...s,a])}if("array"===n.type)return t(n.of,r,n,s);if("arrayItem"===n.type)return c.length?t(n.value,c,n,[...s,a]):{field:n,parent:o};if("union"===n.type){const r=a.startsWith("[_key==")?l?.get(e.id)?.get([s.join("."),a].filter(Boolean).join("")):a;return t(n.of.find((e=>"unionOption"===e.type?e.name===r:e)),c,n,[...s,a])}if("unionOption"===n.type)return a?t(n.value,r,n,s):{field:n,parent:o};if("inline"===n.type)return t(k(n.name,"type").value,r,n,s);throw new Error(`[@sanity/visual-editing] No field could be resolved at path: "${[...s,...r].join(".")}"`)}(t,n,void 0)}catch(e){const t=e;return t instanceof Error&&console.warn(t.message),{field:void 0,parent:void 0}}},r[13]=k,r[14]=l,r[15]=E):E=r[15];const S=E;let _,M,I;r[16]!==u?(M=u||[],r[16]=u,r[17]=M):M=r[17],r[18]!==S||r[19]!==k||r[20]!==l||r[21]!==M?(I={getField:S,getType:k,resolvedTypes:l,schema:M},r[18]=S,r[19]=k,r[20]=l,r[21]=M,r[22]=I):I=r[22],_=I;const P=_;let $;return r[23]!==s||r[24]!==P?($=e.jsx(x.Provider,{value:P,children:s}),r[23]=s,r[24]=P,r[25]=$):$=r[25],$};function ce(e){return e.includes("[")?e.split(/(\[.+\])/,2):[e]}const le=(e=>{let t=e;const n=new Set;return{getState:()=>t,setState:e=>{t=e(t),n.forEach((e=>e()))},subscribe:e=>(n.add(e),()=>n.delete(e))}})({}),de=n=>{const r=t.c(11),{comlink:i,children:s}=n;let a,c,l,d,p,f;r[0]!==i?(a=()=>i?.on("presentation/shared-state",ue),c=[i],r[0]=i,r[1]=a,r[2]=c):(a=r[1],c=r[2]),o.useEffect(a,c),r[3]!==i?(l=()=>{(async function(){const e=await(i?.fetch("visual-editing/shared-state",void 0,{suppressWarnings:!0}));e&&le.setState((()=>e.state))})().catch(pe)},d=[i],r[3]=i,r[4]=l,r[5]=d):(l=r[4],d=r[5]),o.useEffect(l,d),r[6]!==i?(f={comlink:i,store:le},r[6]=i,r[7]=f):f=r[7],p=f;const m=p;let h;return r[8]!==s||r[9]!==m?(h=e.jsx(u.S.Provider,{value:m,children:s}),r[8]=s,r[9]=m,r[10]=h):h=r[10],h};function ue(e){"value"in e?le.setState((t=>({...t,[e.key]:e.value}))):le.setState((t=>Object.fromEntries(Object.entries(t).filter((t=>{const[n]=t;return n!==e.key})))))}function pe(e){console.debug(e),console.warn("[@sanity/visual-editing]: Failed to fetch shared state. Check your version of `@sanity/presentation` is up-to-date")}function fe(){}function me(e){return e.id}function he(e){return!!e}function ve(e){const{sanity:t}=e;return"id"in t?{...t,id:"isDraft"in t?`${f.D}${t.id}`:t.id}:null}const ge=d.d.div`
  background-color: transparent;
  direction: ltr;
  inset: 0;
  pointer-events: none;
  position: absolute;
  width: 100%;
  height: 100%;
  z-index: ${({$zIndex:e})=>e??"9999999"};
`;function ye(e){let t,n;return t=requestAnimationFrame((()=>{n=requestAnimationFrame(e)})),()=>{void 0!==t&&cancelAnimationFrame(t),void 0!==n&&cancelAnimationFrame(n)}}const be=e=>{const n=t.c(8),{documentIds:r}=e;let i;n[0]===Symbol.for("react.memo_cache_sentinel")?(i=[],n[0]=i):i=n[0];const[s,a]=o.useState(i);let l,d;n[1]!==r?(l=()=>{a((e=>{const t=Array.from(new Set(r));return e.length===t.length&&0===e.reduce(je,t)?.length?e:t}))},d=[r],n[1]=r,n[2]=l,n[3]=d):(l=n[2],d=n[3]),o.useEffect(l,d);const u=c.u();let p,f;return n[4]!==u||n[5]!==s?(p=()=>{for(const e of s)u.send({type:"observe",documentId:c.k(e)}),u.send({type:"observe",documentId:c.g(e)});return()=>{for(const e of s)u.send({type:"unobserve",documentId:c.k(e)}),u.send({type:"unobserve",documentId:c.g(e)})}},f=[u,s],n[4]=u,n[5]=s,n[6]=p,n[7]=f):(p=n[6],f=n[7]),o.useEffect(p,f),null},we=e=>{const n=t.c(11),{comlink:r,dispatch:i,inFrame:a,onDrag:l,overlayEnabled:d,rootElement:p}=e,{dispatchDragEndEvent:f}=function(){const e=t.c(4),{getDocument:n}=c.a();let r,i;e[0]!==n?(r=()=>{const e=e=>{const{insertPosition:t,target:r,preventInsertDefault:o}=e.detail;if(o)return;const i=function(e){if(e){const{top:t,right:n,bottom:r,left:o}=e;if(o||t)return{node:(o??t).sanity,position:"after"};if(n||r)return{node:(n??r).sanity,position:"before"}}}(t);if(i){const e=n(r.id),{node:t,position:o}=i,{key:a,hasExplicitKey:l}=c.b(r),{path:d,key:u}=c.b(t);d&&u&&u!==a&&e.patch((async e=>{const{getSnapshot:t}=e,n=await t(),i=c.d(n,r.path);return l?[s.at(d,s.remove({_key:a})),s.at(d,s.insert(i,o,{_key:u}))]:[s.at(d,s.remove(~~a)),s.at(d,s.insert(i,o,u>a?~~u-1:~~u))]}))}};return window.addEventListener("sanity/dragEnd",e),()=>{window.removeEventListener("sanity/dragEnd",e)}},i=[n],e[0]=n,e[1]=r,e[2]=i):(r=e[1],i=e[2]),o.useEffect(r,i);const a=w;let l;return e[3]===Symbol.for("react.memo_cache_sentinel")?(l={dispatchDragEndEvent:a},e[3]=l):l=e[3],l}();let m;n[0]!==r||n[1]!==i||n[2]!==f||n[3]!==l?(m=e=>{if("element/click"===e.type){const{sanity:t}=e;r?.post("visual-editing/focus",t)}else if("overlay/activate"===e.type)r?.post("visual-editing/toggle",{enabled:!0});else if("overlay/deactivate"===e.type)r?.post("visual-editing/toggle",{enabled:!1});else if("overlay/dragEnd"===e.type){const{insertPosition:t,target:n,dragGroup:r,flow:o,preventInsertDefault:i}=e;f({insertPosition:t,target:n,dragGroup:r,flow:o,preventInsertDefault:i})}else{if("overlay/dragUpdateCursorPosition"===e.type)return void l(e.x,e.y);if("overlay/setCursor"===e.type){const{element:t,cursor:n}=e;n?t.style.cursor=n:t.style.removeProperty("cursor")}}i(e)},n[0]=r,n[1]=i,n[2]=f,n[3]=l,n[4]=m):m=n[4];const h=function(e,n,r){const i=t.c(6),s=o.useRef(),a=c.j();let l,d;return i[0]!==e||i[1]!==n||i[2]!==r||i[3]!==a?(l=()=>{if(e)return s.current=u.c({handler:n,overlayElement:e,inFrame:r,optimisticActorReady:a}),()=>{s.current?.destroy(),s.current=void 0}},d=[e,n,r,a],i[0]=e,i[1]=n,i[2]=r,i[3]=a,i[4]=l,i[5]=d):(l=i[4],d=i[5]),o.useEffect(l,d),s}(p,m,a);let v,g;return n[5]!==h.current||n[6]!==d?(v=()=>{d?h.current?.activate():h.current?.deactivate()},n[5]=h.current,n[6]=d,n[7]=v):v=n[7],n[8]!==h||n[9]!==d?(g=[h,d],n[8]=h,n[9]=d,n[10]=g):g=n[10],o.useEffect(v,g),null},xe=r=>{const i=t.c(70),{comlink:s,componentResolver:a,inFrame:l,zIndex:p}=r,[f,m]=o.useState(),h=d.u();let v;i[0]===Symbol.for("react.memo_cache_sentinel")?(v={contextMenu:null,dragInsertPosition:null,dragShowMinimap:!1,dragShowMinimapPrompt:!1,dragSkeleton:null,elements:[],focusPath:"",isDragging:!1,perspective:"published",wasMaybeCollapsed:!1,dragMinimapTransition:!1,dragGroupRect:null},i[0]=v):v=i[0];const[g,y]=o.useReducer(ne,v),{contextMenu:b,dragInsertPosition:w,dragShowMinimap:x,dragShowMinimapPrompt:j,dragSkeleton:k,elements:E,isDragging:S,perspective:_,wasMaybeCollapsed:M,dragMinimapTransition:I,dragGroupRect:P}=g,[$,R]=o.useState(null),[T,z]=o.useState(!0);let q,F,A;i[1]!==s?(q=()=>{const e=[s?.on("presentation/focus",(e=>{y({type:"presentation/focus",data:e})})),s?.on("presentation/blur",(e=>{y({type:"presentation/blur",data:e})})),s?.on("presentation/toggle-overlay",(()=>{z(ke)})),s?.onStatus((e=>{m(e)}))].filter(Boolean);return()=>e.forEach(Ee)},F=[s],i[1]=s,i[2]=q,i[3]=F):(q=i[2],F=i[3]),o.useEffect(q,F),function(e,n){const r=t.c(4);let i,s;r[0]!==e||r[1]!==n?(i=()=>{const t=new AbortController;e?.fetch("visual-editing/fetch-perspective",void 0,{signal:t.signal,suppressWarnings:!0}).then((e=>{n({type:"presentation/perspective",data:e})})).catch(fe);const r=e?.on("presentation/perspective",(e=>{n({type:"presentation/perspective",data:e})}));return()=>{r?.(),t.abort()}},s=[e,n],r[0]=e,r[1]=n,r[2]=i,r[3]=s):(i=r[2],s=r[3]),o.useEffect(i,s)}(s,y),function(e,n,r){const i=t.c(7),s=o.useRef(void 0);let a;i[0]!==e?(a=(t,n)=>{e?.post("visual-editing/documents",{documents:t,perspective:n})},i[0]=e,i[1]=a):a=i[1];const c=a;let l,d;i[2]!==n||i[3]!==r||i[4]!==c?(l=()=>{const e=n.map(ve).filter(he),t=new Set(e.map(me));if(!s.current||!function(e,t){if(e===t)return!0;if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}(t,s.current.nodeIds)||r!==s.current.perspective){const n=Array.from(t).map((t=>{const n=e.find((e=>e.id===t)),{type:r,projectId:o,dataset:i}=n;return o&&i?{_id:t,_type:r,_projectId:o,_dataset:i}:{_id:t,_type:r}}));s.current={nodeIds:t,perspective:r},c(n,r)}},d=[n,r,c],i[2]=n,i[3]=r,i[4]=c,i[5]=l,i[6]=d):(l=i[5],d=i[6]),o.useEffect(l,d)}(s,E,_),i[4]!==$?(A=(e,t)=>{$&&($.style.setProperty("--drag-preview-x",`${e}px`),$.style.setProperty("--drag-preview-y",t-window.scrollY+"px"))},i[4]=$,i[5]=A):A=i[5];const C=A;let L,N;i[6]===Symbol.for("react.memo_cache_sentinel")?(L=()=>{const e=Se,t=e=>{n.i(e)&&z(_e)},r=e=>{n.i(e)&&z(Me),n.a(["mod","\\"],e)&&z(Ie)};return window.addEventListener("click",e),window.addEventListener("keydown",r),window.addEventListener("keyup",t),()=>{window.removeEventListener("click",e),window.removeEventListener("keydown",r),window.removeEventListener("keyup",t)}},N=[z],i[6]=L,i[7]=N):(L=i[6],N=i[7]),o.useEffect(L,N);const[W,G]=o.useState(!1),[U,B]=o.useState(!1),K=o.useRef(void 0);let H,Z,J,Q;i[8]!==T?(H=()=>{if(T)return ye((()=>{G(!0),ye((()=>{B(!0),K.current=setTimeout((()=>{B(!1),G(!1)}),1500)}))}));K.current&&(clearTimeout(K.current),G(!1),B(!1))},Z=[T],i[8]=T,i[9]=H,i[10]=Z):(H=i[9],Z=i[10]),o.useEffect(H,Z),i[11]!==E?(Q=E.flatMap(Pe),i[11]=E,i[12]=Q):Q=i[12],J=Q;const te=J;let oe;i[13]===Symbol.for("react.memo_cache_sentinel")?(oe=()=>{y({type:"overlay/blur"})},i[13]=oe):oe=i[13];const ie=oe,se=c.j();let ce;ce=se?a:void 0;const le=ce;let ue;e:{if(l&&"connected"!==f||S){let e;i[14]===Symbol.for("react.memo_cache_sentinel")?(e=[],i[14]=e):e=i[14],ue=e;break e}let t;i[15]!==le||i[16]!==I||i[17]!==x||i[18]!==E||i[19]!==l||i[20]!==S||i[21]!==se||i[22]!==M?(t=E.filter($e).map((t=>{const{id:n,element:r,focused:o,hovered:i,rect:s,sanity:a,dragDisabled:c}=t,d=!c&&!!r.getAttribute("data-sanity")&&se&&E.some((e=>"id"in e.sanity&&"id"in a&&(u.s(e.sanity,a)&&e.sanity.path!==a.path)));return e.jsx(O,{componentResolver:le,element:r,enableScrollIntoView:!S&&!I&&!x,focused:o,hovered:i,node:a,rect:s,showActions:!l,draggable:d,isDragging:S||I,wasMaybeCollapsed:o&&M},n)})),i[15]=le,i[16]=I,i[17]=x,i[18]=E,i[19]=l,i[20]=S,i[21]=se,i[22]=M,i[23]=t):t=i[23],ue=t}const pe=ue,xe=h?"dark":"light",je=U?"":void 0,Re=W?"":void 0;let Te,De,ze,qe,Fe,Ae,Ce,Le,Ne,Oe,We;return i[24]!==te||i[25]!==_?(Te=e.jsx(be,{documentIds:te,perspective:_}),i[24]=te,i[25]=_,i[26]=Te):Te=i[26],i[27]!==s||i[28]!==l||i[29]!==T||i[30]!==$||i[31]!==C?(De=e.jsx(we,{comlink:s,dispatch:y,inFrame:l,onDrag:C,overlayEnabled:T,rootElement:$}),i[27]=s,i[28]=l,i[29]=T,i[30]=$,i[31]=C,i[32]=De):De=i[32],i[33]!==b?(ze=b&&e.jsx(D,{...b,onDismiss:ie}),i[33]=b,i[34]=ze):ze=i[34],i[35]!==P||i[36]!==w||i[37]!==I||i[38]!==j||i[39]!==S?(qe=S&&!I&&e.jsxs(e.Fragment,{children:[w&&e.jsx(Y,{dragInsertPosition:w}),j&&e.jsx(ee,{}),P&&e.jsx(V,{dragGroupRect:P})]}),i[35]=P,i[36]=w,i[37]=I,i[38]=j,i[39]=S,i[40]=qe):qe=i[40],i[41]!==k||i[42]!==S?(Fe=S&&k&&e.jsx(X,{skeleton:k}),i[41]=k,i[42]=S,i[43]=Fe):Fe=i[43],i[44]!==pe||i[45]!==je||i[46]!==Re||i[47]!==Te||i[48]!==De||i[49]!==ze||i[50]!==qe||i[51]!==Fe||i[52]!==p?(Ae=e.jsxs(ge,{"data-fading-out":je,"data-overlays":Re,ref:R,$zIndex:p,children:[Te,De,ze,pe,qe,Fe]}),i[44]=pe,i[45]=je,i[46]=Re,i[47]=Te,i[48]=De,i[49]=ze,i[50]=qe,i[51]=Fe,i[52]=p,i[53]=Ae):Ae=i[53],i[54]!==s||i[55]!==Ae?(Ce=e.jsx(de,{comlink:s,children:Ae}),i[54]=s,i[55]=Ae,i[56]=Ce):Ce=i[56],i[57]!==s||i[58]!==Ce?(Le=e.jsx(re,{comlink:s,children:Ce}),i[57]=s,i[58]=Ce,i[59]=Le):Le=i[59],i[60]!==s||i[61]!==E||i[62]!==Le?(Ne=e.jsx(ae,{comlink:s,elements:E,children:Le}),i[60]=s,i[61]=E,i[62]=Le,i[63]=Ne):Ne=i[63],i[64]!==$||i[65]!==Ne?(Oe=e.jsx(d.L,{children:e.jsx(d.t,{element:$,children:Ne})}),i[64]=$,i[65]=Ne,i[66]=Oe):Oe=i[66],i[67]!==xe||i[68]!==Oe?(We=e.jsx(d.v,{scheme:xe,theme:d.w,tone:"transparent",children:Oe}),i[67]=xe,i[68]=Oe,i[69]=We):We=i[69],We};function je(e,t){return e.filter((e=>e!==t))}function ke(e){return!e}function Ee(e){return e()}function Se(e){const t=e.target;if((d.x(t)||d.y(t)&&t.closest("a"))&&e.altKey){e.preventDefault(),e.stopPropagation();const t=new MouseEvent(e.type,{...e,altKey:!1,bubbles:!0,cancelable:!0});e.target?.dispatchEvent(t)}}function _e(e){return!e}function Me(e){return!e}function Ie(e){return!e}function Pe(e){return"id"in e.sanity?[e.sanity.id]:[]}function $e(e){return e.activated||e.focused}const Re=e=>{const n=t.c(4),{comlink:r,refresh:i}=e,s=o.useRef(0),a=o.useRef(0);let c,l;return n[0]!==r||n[1]!==i?(c=()=>r.on("presentation/refresh",(e=>{if("manual"===e.source){clearTimeout(s.current);const t=i(e);if(!1===t)return;let n;r.post("visual-editing/refreshing",e),n=!1,s.current=window.setTimeout((()=>{r.post("visual-editing/refreshed",e),n=!0}),3e3),t?.finally?.((()=>{n||(clearTimeout(s.current),r.post("visual-editing/refreshed",e))}))}else if("mutation"===e.source){clearTimeout(a.current);const t=i(e);if(!1===t)return;r.post("visual-editing/refreshing",e),a.current=window.setTimeout((()=>{const t=i(e);!1!==t&&(r.post("visual-editing/refreshing",e),t?.finally?.((()=>{r.post("visual-editing/refreshed",e)}))||r.post("visual-editing/refreshed",e))}),1e3),t?.finally?.((()=>{r.post("visual-editing/refreshed",e)}))||r.post("visual-editing/refreshed",e)}})),l=[r,i],n[0]=r,n[1]=i,n[2]=c,n[3]=l):(c=n[2],l=n[3]),o.useEffect(c,l),null},Te=s=>{const a=t.c(13),{components:d,history:u,refresh:p,zIndex:f}=s,m=window.self!==window.top||window.opener,[h,w]=o.useState(void 0);let x,j,k,E,S;return a[0]===Symbol.for("react.memo_cache_sentinel")?(x=()=>{if(!m)return;const e=r.createNode({name:"visual-editing",connectTo:"presentation"},r.createNodeMachine().provide({actors:n.b()}));w(e);const t=function(e){const t=new l.ReplaySubject(1),n=new l.Subject;return e.fetch("visual-editing/snapshot-welcome",void 0,{suppressWarnings:!0}).then((e=>{t.next(e.event)})).catch((()=>{})),e.on("presentation/snapshot-event",(e=>{"reconnect"===e.event.type&&t.next(e.event),"mutation"===e.event.type&&n.next(e.event)})),l.merge(t,n)}(e),o=(d=e,v.provide({actors:{documentMutatorMachine:g(d)}})),s=i.createActor(o,{input:{client:{withConfig:De},sharedListener:t}}),a=new AbortController;var d;return e.fetch("visual-editing/features",void 0,{signal:a.signal,suppressWarnings:!0}).then((e=>{e.features.optimistic&&c.s(s)})).catch(ze),s.start(),e.start(),()=>{a.abort(),s.stop(),e.stop()}},j=[m],a[0]=x,a[1]=j):(x=a[0],j=a[1]),o.useEffect(x,j),a[2]!==h||a[3]!==d||a[4]!==f?(k=e.jsx(xe,{comlink:h,componentResolver:d,inFrame:m,zIndex:f}),a[2]=h,a[3]=d,a[4]=f,a[5]=k):k=a[5],a[6]!==h||a[7]!==u||a[8]!==p?(E=h&&e.jsxs(e.Fragment,{children:[e.jsx(y,{comlink:h,history:u}),e.jsx(b,{comlink:h}),p&&e.jsx(Re,{comlink:h,refresh:p})]}),a[6]=h,a[7]=u,a[8]=p,a[9]=E):E=a[9],a[10]!==k||a[11]!==E?(S=e.jsxs(e.Fragment,{children:[k,E]}),a[10]=k,a[11]=E,a[12]=S):S=a[12],S};function De(){}function ze(){console.warn("[@sanity/visual-editing] Package version mismatch detected: Please update your Sanity studio to prevent potential compatibility issues.")}Te.displayName="VisualEditing",exports.createDataAttribute=n.c,exports.VisualEditing=Te;//# sourceMappingURL=index.cjs.map
