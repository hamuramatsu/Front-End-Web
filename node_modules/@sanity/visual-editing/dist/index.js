import{S as t}from"./_chunks-es/SharedStateContext.js";import{c as e}from"./_chunks-es/SharedStateContext.js";import{e as r}from"./_chunks-es/enableVisualEditing.js";import{u as s,g as o,i as n}from"./_chunks-es/mutations.js";import{b as a,a as i}from"./_chunks-es/mutations.js";import{c as u}from"react-compiler-runtime";import{useState as c,useEffect as m,startTransition as d,useContext as l,useSyncExternalStore as f}from"react";import{useEffectEvent as h}from"use-effect-event";import{c as p}from"./_chunks-es/create-data-attribute.js";function b(t,e){const r=u(16),[a,i]=c(!0),[l,f]=c(t),[p,b]=c(null),[S,g]=c(t),y=s();let j;r[0]!==e?(j=(t,r)=>(Array.isArray(e)?e:[e]).reduce(((e,r)=>r(e,{document:t.document,id:o(t.id),originalId:t.id,type:t.type})),r),r[0]=e,r[1]=j):j=r[1];const k=h(j);let w;r[2]!==t?(w=()=>g(t),r[2]=t,r[3]=w):w=r[3];const _=h(w);let A,v,E,x;return r[4]!==y||r[5]!==k||r[6]!==_?(A=()=>{if(n(y))return;let t;const e=y.on("rebased.local",(e=>{const r={document:e.document,id:e.id,originalId:o(e.id),type:"mutate"};f((t=>k(r,t))),b(r),_(),i(!1),clearTimeout(t)})),r=y.on("pristine",(()=>{t=setTimeout((()=>{d((()=>i(!0)))}),15e3)}));return()=>{e.unsubscribe(),r.unsubscribe()}},v=[y,k,_],r[4]=y,r[5]=k,r[6]=_,r[7]=A,r[8]=v):(A=r[7],v=r[8]),m(A,v),r[9]!==p||r[10]!==S||r[11]!==t||r[12]!==a||r[13]!==k?(E=()=>{if(!a){if(!p)throw new Error("No last event found when syncing passthrough");S!==t&&d((()=>{f(k(p,t)),g(t)}))}},x=[p,S,t,a,k],r[9]=p,r[10]=S,r[11]=t,r[12]=a,r[13]=k,r[14]=E,r[15]=x):(E=r[14],x=r[15]),m(E,x),a?t:l}function S(e){const r=u(3),s=l(t);if(!s)throw new Error("useSharedState must be used within a SharedStateProvider");const{store:o}=s;let n;return r[0]!==e||r[1]!==o?(n=()=>o.getState()[e],r[0]=e,r[1]=o,r[2]=n):n=r[2],f(o.subscribe,n)}export{p as createDataAttribute,e as createOverlayController,r as enableVisualEditing,a as getArrayItemKeyAndParentPath,i as useDocuments,b as useOptimistic,S as useSharedState};//# sourceMappingURL=index.js.map
